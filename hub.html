<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í—ˆë¸Œ â€” í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ ì •ë³´ë¶€</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header class="site-header"><div class="container"><a href="index.html" class="site-title"><span class="logo-icon">T</span>í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ ì •ë³´ë¶€</a><button class="btn" onclick="App.goFullscreen()">ğŸ–¥ï¸</button></div></header>
<div class="container" style="padding-top:4px;padding-bottom:60px;">
  <nav class="breadcrumb" id="breadcrumb"></nav>
  <section class="hero" id="hero">
    <h1 id="hero-title">ë¡œë”© ì¤‘...</h1>
    <p id="hero-desc"></p>
    <div id="hero-extra" style="font-size:.85rem;color:var(--sub);margin-top:8px;max-width:640px;line-height:1.5;"></div>
  </section>
  <div class="search-bar"><input type="text" id="search" placeholder="ğŸ” ê²€ìƒ‰..."></div>
  <div class="tag-filter" id="tag-filter"></div>
  <div class="card-grid" id="cards">ë¡œë”© ì¤‘...</div>
</div>
<script src="app.js"></script>
<script>
(async()=>{
  const params = new URLSearchParams(location.search);
  const mode = params.get('mode'); // 'category' or 'unit'
  const id = params.get('id');

  if(mode === 'unit' && id){
    // === ë‹¨ì› í—ˆë¸Œ: ì½˜í…ì¸  ëª©ë¡ ===
    const units = await App.loadJSON('units.json');
    const unitInfo = units?.units?.find(u=>u.slug===id);
    const data = await App.loadJSON('unit-'+id+'.json');

    document.title = (unitInfo?.title||id) + ' â€” í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ ì •ë³´ë¶€';
    document.getElementById('hero-title').textContent = unitInfo?.title || id;
    document.getElementById('hero-desc').textContent = unitInfo?.subtitle || '';
    document.getElementById('hero-extra').textContent = data?.achievementStandard || '';

    // ë¸Œë ˆë“œí¬ëŸ¼: ì–´ëŠ ì¹´í…Œê³ ë¦¬ ì†Œì†ì¸ì§€ ì°¾ê¸°
    const site = await App.loadJSON('site.json');
    const cat = site?.categories?.find(c=> {
      // units.jsonì—ì„œ categoryId ë§¤ì¹­
      return unitInfo?.categoryId === c.id;
    });
    const crumbs = [];
    if(cat) crumbs.push({label: cat.icon+' '+cat.title, href:'hub.html?mode=category&id='+cat.id});
    crumbs.push({label: unitInfo?.title || id});
    App.renderBreadcrumb(crumbs);

    if(data && data.contents && data.contents.length){
      App.renderContentCards(data.contents, document.getElementById('cards'));
      App.initSearch('#search','#cards');
      const allTags = [...new Set(data.contents.flatMap(c=>c.tags||[]))];
      document.getElementById('tag-filter').innerHTML = allTags.map(t=>'<button class="tag-btn" data-tag="'+t+'">'+t+'</button>').join('');
      App.initTagFilter('#tag-filter','#cards');
    } else {
      document.getElementById('cards').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>ì½˜í…ì¸  ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ğŸš§</p></div>';
    }

  } else if(mode === 'category' && id){
    // === ì¹´í…Œê³ ë¦¬ í—ˆë¸Œ: ë‹¨ì› ëª©ë¡ ===
    const site = await App.loadJSON('site.json');
    const cat = site?.categories?.find(c=>c.id===id);
    const units = await App.loadJSON('units.json');

    document.title = (cat?.title||id) + ' â€” í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ ì •ë³´ë¶€';
    document.getElementById('hero-title').textContent = (cat?.icon||'') + ' ' + (cat?.title||id);
    document.getElementById('hero-desc').textContent = cat?.desc || '';
    App.renderBreadcrumb([{label: (cat?.icon||'')+' '+(cat?.title||id)}]);

    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ë‹¨ì›ë§Œ í•„í„°ë§
    const filtered = (units?.units||[]).filter(u=>u.categoryId===id);

    if(filtered.length){
      // ë‹¨ì› ì¹´ë“œ ë Œë” (ë§í¬ë¥¼ hub.html?mode=unit&id=slug ìœ¼ë¡œ)
      const container = document.getElementById('cards');
      container.innerHTML = filtered.map(u=>{
        return '<a href="hub.html?mode=unit&id='+u.slug+'" class="card" data-tags="'+u.tags.join(' ')+'" data-title="'+u.title+'">'+
          '<div class="card-icon" style="font-size:1.5rem;background:var(--primary-lt);">'+u.code+'</div>'+
          '<div class="card-title">'+u.title+'</div>'+
          '<div class="card-desc">'+u.subtitle+'</div>'+
          '<div class="card-meta">'+u.tags.map(t=>'<span class="tag">'+t+'</span>').join('')+'<span class="tag code">ì½˜í…ì¸  '+u.contentCount+'ê°œ</span></div>'+
          '<span class="card-arrow">â†’</span></a>';
      }).join('');
      App.initSearch('#search','#cards');
    } else {
      document.getElementById('cards').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>ì½˜í…ì¸  ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ğŸš§<br>ê³§ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤!</p></div>';
    }

  } else {
    // fallback
    document.getElementById('hero-title').textContent = 'í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
    document.getElementById('cards').innerHTML = '<div class="empty-state"><p><a href="index.html">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p></div>';
  }
})();
</script>
</body>
</html>
