<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ˜ï¸ ì¬ë‚œ ì‹œì¥ â€” ìš°ë¦¬ ë§ˆì„ì„ ì§€ì¼œë¼</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@300;400;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Noto Sans KR',sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh;overflow-x:hidden}
.jua{font-family:'Jua',sans-serif}
.screen{display:none;animation:fadeUp .5s ease-out forwards;min-height:100vh}
.screen.active{display:flex;flex-direction:column}
@keyframes fadeUp{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(245,158,11,0.3)}50%{box-shadow:0 0 40px rgba(245,158,11,0.6)}}
.start-bg{background:linear-gradient(135deg,#1e3a5f 0%,#0f172a 50%,#1a0a2e 100%)}
.budget-btn{background:rgba(30,41,59,0.8);border:2px solid #334155;border-radius:1rem;padding:1rem;cursor:pointer;transition:all .3s;text-align:left;backdrop-filter:blur(10px)}
.budget-btn:hover{border-color:#f59e0b;background:rgba(245,158,11,0.1);transform:translateY(-2px)}
.budget-btn.selected{border-color:#f59e0b;background:rgba(245,158,11,0.15)}
.budget-btn.disabled{opacity:.4;pointer-events:none}
.stat-bar{height:10px;background:#1e293b;border-radius:99px;overflow:hidden}
.stat-fill{height:100%;border-radius:99px;transition:width .8s cubic-bezier(.4,0,.2,1)}
.disaster-card{background:rgba(15,23,42,0.95);border:2px solid #dc2626;border-radius:1.5rem;padding:2rem;text-align:center;animation:shake .5s}
.result-card{background:white;color:#1e293b;border-radius:1.5rem;max-width:580px;margin:0 auto;overflow:hidden}
.choice-card{background:rgba(30,41,59,0.8);border:2px solid #334155;border-radius:1rem;padding:1.2rem;cursor:pointer;transition:all .3s;text-align:center}
.choice-card:hover{border-color:#60a5fa;transform:translateY(-3px);box-shadow:0 8px 25px rgba(59,130,246,0.2)}
@media(max-width:640px){.budget-btn{padding:.8rem}}

/* ì „ì²´í™”ë©´ ì´íƒˆ ê²½ê³  ì˜¤ë²„ë ˆì´ */
.fs-warning-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.92);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem;animation:fadeIn .3s}
.fs-warning-overlay .warn-icon{font-size:4rem;animation:shake .5s}
.fs-warning-overlay .warn-title{font-size:1.5rem;font-weight:900;color:#fbbf24}
.fs-warning-overlay .warn-msg{font-size:1rem;color:#94a3b8;text-align:center;max-width:320px;line-height:1.6}
.fs-warning-overlay .warn-btn{padding:14px 40px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border:none;border-radius:12px;color:#fff;font-size:1.1rem;font-weight:700;cursor:pointer;transition:transform .2s}
.fs-warning-overlay .warn-btn:hover{transform:scale(1.05)}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
/* ë¸”ë¡œê·¸ ë§í¬ ë°°ì§€ */
.blog-badge{position:fixed;bottom:12px;right:12px;z-index:100;background:rgba(15,23,42,0.85);border:1px solid #334155;border-radius:10px;padding:6px 14px;font-size:0.75rem;color:#94a3b8;text-decoration:none;backdrop-filter:blur(8px);transition:all .3s;display:flex;align-items:center;gap:6px}
.blog-badge:hover{background:rgba(59,130,246,0.2);border-color:#3b82f6;color:#60a5fa}
</style>
</head>
<body>

<!-- ===== START ===== -->
<div class="screen active start-bg" id="s-start">
  <div class="flex-1 flex flex-col items-center justify-center p-6 text-center">
    <div style="font-size:6rem;animation:float 3s ease-in-out infinite">ğŸ˜ï¸</div>
    <h1 class="jua text-4xl md:text-5xl text-white mb-3 mt-4">ì¬ë‚œ ì‹œì¥</h1>
    <p class="text-amber-200 text-lg mb-1">ìš°ë¦¬ ë§ˆì„ì„ ì§€ì¼œë¼!</p>
    <p class="text-slate-400 text-sm mb-6 max-w-sm">ë‹¹ì‹ ì€ í•´ì•ˆ ë„ì‹œì˜ ì‹œì¥ì…ë‹ˆë‹¤. ì œí•œëœ ì˜ˆì‚°ìœ¼ë¡œ ì¬ë‚œì— ëŒ€ë¹„í•˜ê³ , ì£¼ë¯¼ë“¤ì„ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤.</p>
    <div class="w-full max-w-xs space-y-3 mb-6">
      <div class="flex gap-2">
        <input type="text" id="input-grade" placeholder="í•™ë…„" maxlength="1" class="flex-1 text-center py-3 rounded-xl bg-white/10 text-white placeholder-slate-500 border border-white/20 font-bold outline-none focus:border-amber-400">
        <input type="text" id="input-class" placeholder="ë°˜" maxlength="2" class="flex-1 text-center py-3 rounded-xl bg-white/10 text-white placeholder-slate-500 border border-white/20 font-bold outline-none focus:border-amber-400">
        <input type="text" id="input-number" placeholder="ë²ˆí˜¸" maxlength="2" class="flex-1 text-center py-3 rounded-xl bg-white/10 text-white placeholder-slate-500 border border-white/20 font-bold outline-none focus:border-amber-400">
      </div>
      <input type="text" id="input-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10" class="w-full text-center py-3 rounded-xl bg-white/10 text-white placeholder-slate-500 border border-white/20 font-bold text-lg outline-none focus:border-amber-400">
    </div>
    <button onclick="startGame()" class="py-4 px-12 bg-amber-600 hover:bg-amber-500 text-white rounded-2xl font-bold text-lg transition-all hover:scale-105 shadow-lg" style="animation:glow 2s infinite">
      ğŸ›ï¸ ì·¨ì„í•˜ê¸°
    </button>
    <p class="text-slate-600 text-xs mt-4">â± ì•½ 12~15ë¶„ Â· ì˜ˆì‚° ë°°ë¶„ + ì¬ë‚œ ëŒ€ì‘ 5ë¼ìš´ë“œ</p>
  </div>
  <div class="text-center pb-4 text-slate-600 text-xs">í†µí•©ì‚¬íšŒ III. ìì—°í™˜ê²½ê³¼ ì¸ê°„ Â· [10í†µì‚¬1-03-02]</div>
</div>

<!-- ===== BRIEFING ===== -->
<div class="screen" id="s-brief">
  <div class="flex-1 p-4 flex flex-col items-center justify-center">
    <div class="max-w-2xl w-full">
      <div class="text-center mb-6">
        <div class="text-5xl mb-3">ğŸ“‹</div>
        <h2 class="jua text-2xl text-amber-300 mb-2">ì‹œì¥ ë¸Œë¦¬í•‘</h2>
        <p class="text-slate-400 text-sm" id="brief-student"></p>
      </div>
      <div class="bg-slate-800/60 rounded-2xl p-5 mb-6 border border-slate-700 space-y-4 text-sm leading-relaxed">
        <p>ğŸ˜ï¸ <b class="text-white">í•´ì•ˆë„ì‹œ 'ë°”ë‹¤ë§ˆì„'</b>ì˜ ì‹œì¥ìœ¼ë¡œ ì·¨ì„í•˜ì‹  ê²ƒì„ ì¶•í•˜í•©ë‹ˆë‹¤!</p>
        <p>ğŸ“Š í˜„ì¬ ìƒí™©: ì¸êµ¬ <b class="text-amber-300">50,000ëª…</b>, ì£¼ìš” ì‚°ì—…ì€ ìˆ˜ì‚°ì—…ê³¼ ê´€ê´‘ì—…ì…ë‹ˆë‹¤.</p>
        <p>ğŸ’° ì˜¬í•´ <b class="text-amber-300">ë°©ì¬ ì˜ˆì‚°ì€ 100í¬ì¸íŠ¸</b>ì…ë‹ˆë‹¤. ëª¨ë“  ëŒ€ë¹„ë¥¼ í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.</p>
        <p>âš ï¸ ê¸°ìƒì²­ì— ë”°ë¥´ë©´ ì˜¬í•´ <b class="text-red-400">ìì—°ì¬í•´ ë°œìƒ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.</b></p>
        <div class="bg-slate-900/60 rounded-xl p-4 border border-slate-600">
          <p class="text-amber-400 font-bold mb-2">ğŸ“š ì°¸ê³ : ìì—°ì¬í•´ ëŒ€ì‘ 4ë‹¨ê³„</p>
          <p class="text-slate-300">â‘  <b>ì˜ˆë°©</b> â€” ì¬í•´ ë°œìƒ ìì²´ë¥¼ ì¤„ì´ëŠ” ë…¸ë ¥ (ë°©íŒŒì œ, ìˆ² ë³µì›)</p>
          <p class="text-slate-300">â‘¡ <b>ëŒ€ë¹„</b> â€” ì¬í•´ ë°œìƒ ì‹œë¥¼ ìœ„í•œ ì¤€ë¹„ (ê²½ë³´ì‹œìŠ¤í…œ, êµìœ¡)</p>
          <p class="text-slate-300">â‘¢ <b>ëŒ€ì‘</b> â€” ì¬í•´ ë°œìƒ ì¤‘ í–‰ë™ (ëŒ€í”¼, ì‘ê¸‰ì˜ë£Œ)</p>
          <p class="text-slate-300">â‘£ <b>ë³µêµ¬</b> â€” ì¬í•´ ì´í›„ íšŒë³µ (ê²½ì œì§€ì›, ì¬ê±´)</p>
        </div>
      </div>
      <div class="text-center">
        <button onclick="showBudget()" class="py-3 px-10 bg-amber-600 hover:bg-amber-500 text-white rounded-xl font-bold transition-all hover:scale-105">ì˜ˆì‚° ë°°ë¶„ ì‹œì‘ â†’</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== BUDGET ===== -->
<div class="screen" id="s-budget">
  <div class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 px-4 py-3">
    <div class="max-w-2xl mx-auto flex items-center justify-between">
      <div class="text-sm"><span class="text-amber-400 font-bold">ğŸ’° ë‚¨ì€ ì˜ˆì‚°:</span> <span class="jua text-2xl text-white" id="budget-remain">100</span><span class="text-slate-400">pt</span></div>
      <div class="text-sm text-slate-400">ì„ íƒ: <span id="budget-count">0</span>ê°œ</div>
    </div>
  </div>
  <div class="flex-1 p-4 pb-24">
    <div class="max-w-2xl mx-auto">
      <h2 class="jua text-xl text-amber-300 mb-2 text-center">ì˜ˆì‚°ì„ ë°°ë¶„í•˜ì„¸ìš”</h2>
      <p class="text-slate-400 text-sm text-center mb-6">100í¬ì¸íŠ¸ë¡œ ëª¨ë“  ê²ƒì„ ì‚´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ì„¸ìš”!</p>
      <div class="space-y-3" id="budget-list"></div>
      <div class="text-center mt-6">
        <button onclick="confirmBudget()" class="py-3 px-10 bg-amber-600 hover:bg-amber-500 text-white rounded-xl font-bold transition-all hover:scale-105" id="btn-confirm">ë°°ë¶„ ì™„ë£Œ â†’ ì¬ë‚œ ì‹œì‘</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== DISASTER ROUND ===== -->
<div class="screen" id="s-disaster">
  <div class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 px-4 py-3">
    <div class="max-w-2xl mx-auto">
      <div class="flex justify-between items-center mb-2">
        <span class="text-sm font-bold text-red-400">âš ï¸ ROUND <span id="d-round">1</span>/5</span>
        <span class="text-sm text-slate-400" id="d-year">1ë…„ì°¨</span>
      </div>
      <div class="grid grid-cols-3 gap-3">
        <div><div class="flex justify-between text-xs mb-1"><span>ğŸ‘¥ ì¸êµ¬</span><span class="font-bold text-green-400" id="d-pop">50,000</span></div><div class="stat-bar"><div class="stat-fill bg-green-500" id="d-pop-bar" style="width:100%"></div></div></div>
        <div><div class="flex justify-between text-xs mb-1"><span>ğŸ’° ê²½ì œ</span><span class="font-bold text-amber-400" id="d-econ">100%</span></div><div class="stat-bar"><div class="stat-fill bg-amber-500" id="d-econ-bar" style="width:100%"></div></div></div>
        <div><div class="flex justify-between text-xs mb-1"><span>ğŸ  ì¸í”„ë¼</span><span class="font-bold text-blue-400" id="d-infra">100%</span></div><div class="stat-bar"><div class="stat-fill bg-blue-500" id="d-infra-bar" style="width:100%"></div></div></div>
      </div>
    </div>
  </div>
  <div class="flex-1 p-4 flex items-center justify-center" id="d-content"></div>
</div>

<!-- ===== RESPONSE CHOICE ===== -->
<div class="screen" id="s-response">
  <div class="flex-1 p-4 flex items-center justify-center">
    <div class="max-w-2xl w-full" id="resp-content"></div>
  </div>
</div>

<!-- ===== RESULT ===== -->
<div class="screen" id="s-result">
  <div class="flex-1 p-4 py-8">
    <div class="result-card" id="result-card">
      <div class="p-6 text-center" id="res-header" style="background:linear-gradient(135deg,#1e40af,#7c3aed)">
        <div class="text-5xl mb-2" id="res-icon">ğŸ˜ï¸</div>
        <h1 class="jua text-2xl text-white" id="res-title">5ë…„ í›„ ë°”ë‹¤ë§ˆì„</h1>
        <p class="text-blue-200 text-sm" id="res-subtitle"></p>
      </div>
      <div class="p-5" id="res-body"></div>
    </div>
    <div class="flex flex-wrap justify-center gap-3 mt-6 max-w-lg mx-auto">
      <button onclick="saveImg()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition-all hover:scale-105">ğŸ“„ ê²°ê³¼ ì €ì¥</button>
      <button onclick="location.reload()" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold transition-all hover:scale-105">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
      <button onclick="exitToBlog()" class="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold transition-all hover:scale-105">ğŸ“ ë¸”ë¡œê·¸ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
</div>

<script>
// ===== DATA =====
let stu={name:'',grade:'',cls:'',num:''};
let budget=100, purchased=[], round=0;
let pop=50000, econ=100, infra=100;
let log=[];

const ITEMS=[
  {id:'seawall',name:'ğŸ§± ë°©íŒŒì œ ê±´ì„¤',cost:30,desc:'í•´ì•ˆì— ì½˜í¬ë¦¬íŠ¸ ë°©ë²½ì„ ì„¤ì¹˜. í•´ì¼Â·íƒœí’ í”¼í•´ë¥¼ í¬ê²Œ ì¤„ì„.',effects:{tsunami:-70,typhoon:-50,flood:-20},category:'ì˜ˆë°©'},
  {id:'mangrove',name:'ğŸŒ³ ë§¹ê·¸ë¡œë¸Œ ìˆ² ë³µì›',cost:20,desc:'ìì—° ë°©ë²½ì¸ ë§¹ê·¸ë¡œë¸Œë¥¼ ë³µì›. í•´ì¼ ì™„í™” + ìƒíƒœê³„ ë³´ì „.',effects:{tsunami:-40,typhoon:-30,heatwave:-10},category:'ì˜ˆë°©'},
  {id:'hospital',name:'ğŸ¥ ì‘ê¸‰ì˜ë£Œ ì‹œìŠ¤í…œ',cost:25,desc:'ì¬ë‚œ ì „ìš© ì‘ê¸‰ì„¼í„°. ì‚¬ìƒìë¥¼ í¬ê²Œ ì¤„ì„.',effects:{ALL_CASUALTIES:-50},category:'ëŒ€ì‘'},
  {id:'warning',name:'ğŸ“¡ ì¡°ê¸°ê²½ë³´ ì‹œìŠ¤í…œ',cost:15,desc:'ì§€ì§„Â·í•´ì¼ ê°ì§€ í›„ 5ë¶„ ë‚´ ì „ ì£¼ë¯¼ì—ê²Œ ê²½ë³´.',effects:{ALL_CASUALTIES:-30,tsunami:-20},category:'ëŒ€ë¹„'},
  {id:'education',name:'ğŸ« ë°©ì¬ êµìœ¡ í”„ë¡œê·¸ë¨',cost:10,desc:'ì „ ì£¼ë¯¼ ëŒ€ìƒ ëŒ€í”¼ í›ˆë ¨. ì¬í•´ ì¢…ë¥˜ì— ê´€ê³„ì—†ì´ íš¨ê³¼.',effects:{ALL:-15},category:'ëŒ€ë¹„'},
  {id:'economy',name:'ğŸ’° ê²½ì œ ë³µêµ¬ ê¸°ê¸ˆ',cost:20,desc:'ì¬ë‚œ í›„ ë¹ ë¥¸ ê²½ì œ íšŒë³µì„ ìœ„í•œ ë¹„ì¶• ê¸°ê¸ˆ.',effects:{ECON_RECOVERY:+40},category:'ë³µêµ¬'},
  {id:'shelter',name:'ğŸ•ï¸ ëŒ€í”¼ì†Œ ë„¤íŠ¸ì›Œí¬',cost:15,desc:'ë§ˆì„ ê³³ê³³ì— ë‚´ì§„ ì„¤ê³„ ëŒ€í”¼ì†Œ ë°°ì¹˜.',effects:{earthquake:-40,ALL_CASUALTIES:-20},category:'ëŒ€ë¹„'},
  {id:'drain',name:'ğŸš° ë°°ìˆ˜ ì‹œìŠ¤í…œ í™•ì¥',cost:20,desc:'ë„ì‹œ ì¹¨ìˆ˜ë¥¼ ë°©ì§€í•˜ëŠ” ëŒ€í˜• ë°°ìˆ˜ê´€.',effects:{flood:-60,typhoon:-30},category:'ì˜ˆë°©'}
];

const DISASTERS=[
  {id:'tsunami',name:'ğŸŒŠ ëŒ€ê·œëª¨ í•´ì¼',desc:'í•´ì € ì§€ì§„ìœ¼ë¡œ ë†’ì´ 8mì˜ í•´ì¼ì´ ë°€ë ¤ì˜µë‹ˆë‹¤!',baseDmg:{pop:-8000,econ:-35,infra:-40},
   knowledge:'í•´ì¼(ì“°ë‚˜ë¯¸)ì€ í•´ì € ì§€ì§„Â·í™”ì‚° í­ë°œë¡œ ë°œìƒí•©ë‹ˆë‹¤. ê¹Šì€ ë°”ë‹¤ì—ì„œëŠ” ë¹ ë¥´ì§€ë§Œ ë‚®ê³ , í•´ì•ˆì— ê°€ê¹Œì›Œì§€ë©´ ë†’ì•„ì§‘ë‹ˆë‹¤. ì¼ë³¸ ë™ì¼ë³¸ ëŒ€ì§€ì§„(2011)ì—ì„œ ë°©íŒŒì œê°€ ìˆë˜ í›„ë‹¤ì´ ë§ˆì„ì€ ì‚¬ë§ì 0ëª…ì´ì—ˆìŠµë‹ˆë‹¤.',
   responses:[
    {text:'ğŸƒ ê³ ì§€ëŒ€ ì¦‰ì‹œ ëŒ€í”¼ ëª…ë ¹',effect:{pop:+2000},desc:'ê²½ë³´ ì‹œìŠ¤í…œì´ ìˆìœ¼ë©´ íš¨ê³¼ 2ë°°'},
    {text:'ğŸš¤ í•´ì•ˆ ì£¼ë¯¼ ë³´íŠ¸ ëŒ€í”¼',effect:{pop:+1000,infra:-5},desc:'ë¹ ë¥´ì§€ë§Œ ìœ„í—˜ì´ ë™ë°˜'},
    {text:'ğŸ§± ë°©íŒŒì œ ê¸´ê¸‰ ë³´ê°•',effect:{infra:+10},desc:'ì´ë¯¸ ìˆìœ¼ë©´ ì¶”ê°€ íš¨ê³¼'}
   ]},
  {id:'typhoon',name:'ğŸŒ€ ì´ˆê°•ë ¥ íƒœí’',desc:'ì¤‘ì‹¬ê¸°ì•• 920hPa, í’ì† 55m/sì˜ íƒœí’ì´ ì§ê²©í•©ë‹ˆë‹¤!',baseDmg:{pop:-3000,econ:-30,infra:-35},
   knowledge:'íƒœí’ì€ ì—´ëŒ€ ë°”ë‹¤ì—ì„œ ë°œìƒí•˜ëŠ” ê°•ë ¥í•œ ì €ê¸°ì••ì…ë‹ˆë‹¤. ê¸°í›„ë³€í™”ë¡œ í•´ìˆ˜ë©´ ì˜¨ë„ê°€ ì˜¬ë¼ê°€ë©´ì„œ ê°•ë ¥í•œ íƒœí’ì´ ë” ìì£¼ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. 2020ë…„ íƒœí’ í•˜ì´ì„ ì€ í•œë°˜ë„ì— í° í”¼í•´ë¥¼ ì¤¬ìŠµë‹ˆë‹¤.',
   responses:[
    {text:'ğŸ  ì „ ê°€êµ¬ ì‹¤ë‚´ ëŒ€í”¼ ëª…ë ¹',effect:{pop:+1500},desc:'ëŒ€í”¼ì†Œê°€ ìˆìœ¼ë©´ íš¨ê³¼ 2ë°°'},
    {text:'âš¡ ì „ë ¥ë§ ì‚¬ì „ ì°¨ë‹¨',effect:{infra:+15,econ:-5},desc:'2ì°¨ í”¼í•´ë¥¼ ë§‰ì§€ë§Œ ê²½ì œ ì†ì‹¤'},
    {text:'ğŸš í•´ì•ˆ ì§€ì—­ ê°•ì œ ì´ì£¼',effect:{pop:+2000,econ:-10},desc:'ì¸ëª…ì€ ì‚´ë¦¬ì§€ë§Œ ë¹„ìš© í¼'}
   ]},
  {id:'flood',name:'ğŸŒ§ï¸ ê¸°ë¡ì  í­ìš°Â·ì‚°ì‚¬íƒœ',desc:'3ì¼ê°„ 700mm í­ìš°! ì‚°ì‚¬íƒœì™€ ë„ì‹¬ ì¹¨ìˆ˜ê°€ ë™ì‹œì— ë°œìƒí•©ë‹ˆë‹¤.',baseDmg:{pop:-2000,econ:-25,infra:-30},
   knowledge:'ì§‘ì¤‘í˜¸ìš°ëŠ” ì§§ì€ ì‹œê°„ì— ì¢ì€ ì§€ì—­ì— ë§ì€ ë¹„ê°€ ë‚´ë¦¬ëŠ” í˜„ìƒì…ë‹ˆë‹¤. ë„ì‹œí™”ë¡œ ì•„ìŠ¤íŒ”íŠ¸ê°€ ëŠ˜ì–´ë‚˜ë©´ ë¹—ë¬¼ì´ í¡ìˆ˜ë˜ì§€ ì•Šì•„ ì¹¨ìˆ˜ê°€ ì‹¬í•´ì§‘ë‹ˆë‹¤. 2022ë…„ ì„œìš¸ ê°•ë‚¨ ì¹¨ìˆ˜ ì‚¬íƒœê°€ ëŒ€í‘œì  ì‚¬ë¡€ì…ë‹ˆë‹¤.',
   responses:[
    {text:'ğŸš° ë¹„ìƒ ë°°ìˆ˜ íŒí”„ ê°€ë™',effect:{infra:+10},desc:'ë°°ìˆ˜ì‹œìŠ¤í…œ ìˆìœ¼ë©´ íš¨ê³¼ 2ë°°'},
    {text:'ğŸ”ï¸ ì‚°ì‚¬íƒœ ìœ„í—˜ ì§€ì—­ ëŒ€í”¼',effect:{pop:+1000},desc:'ê²½ë³´ì‹œìŠ¤í…œ ìˆìœ¼ë©´ ì‹ ì† ëŒ€ì‘'},
    {text:'ğŸ—ï¸ ì„ì‹œ ì œë°© ì„¤ì¹˜',effect:{infra:+5,econ:-5},desc:'ê¸‰ì¡°í•˜ì§€ë§Œ íš¨ê³¼ëŠ” ì œí•œì '}
   ]},
  {id:'heatwave',name:'ğŸ¥µ ì‚´ì¸ì  í­ì—¼',desc:'40Â°C ì´ìƒ í­ì—¼ì´ 3ì£¼ì§¸ ê³„ì†ë©ë‹ˆë‹¤. ì˜¨ì—´ í™˜ìê°€ í­ì¦!',baseDmg:{pop:-1500,econ:-20,infra:-10},
   knowledge:'í­ì—¼ì€ ê¸°í›„ë³€í™”ì˜ ê°€ì¥ ì§ì ‘ì ì¸ ì˜í–¥ì…ë‹ˆë‹¤. IPCCì— ë”°ë¥´ë©´ ì§€êµ¬ í‰ê· ê¸°ì˜¨ì´ 1.5Â°C ì˜¤ë¥´ë©´ í­ì—¼ ë¹ˆë„ê°€ 4ë°° ì¦ê°€í•©ë‹ˆë‹¤. 2018ë…„ í•œêµ­ í­ì—¼ìœ¼ë¡œ 48ëª…ì´ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.',
   responses:[
    {text:'â„ï¸ ë¬´ë”ìœ„ ì‰¼í„° ì „ë©´ ê°œë°©',effect:{pop:+800},desc:'ëŒ€í”¼ì†Œ ë„¤íŠ¸ì›Œí¬ ìˆìœ¼ë©´ íš¨ê³¼ 2ë°°'},
    {text:'ğŸ’§ ê¸‰ìˆ˜ì°¨ ë§ˆì„ ìˆœíšŒ',effect:{pop:+500,econ:-5},desc:'ê¸°ë³¸ì ì´ì§€ë§Œ í™•ì‹¤í•œ ëŒ€ì‘'},
    {text:'ğŸ­ ê³µì¥Â·ê³µì‚¬ ì¼ì‹œ ì¤‘ë‹¨',effect:{pop:+400,econ:-15},desc:'ì¸ëª… ë³´í˜¸í•˜ì§€ë§Œ ê²½ì œ íƒ€ê²©'}
   ]},
  {id:'earthquake',name:'ğŸ«¨ ê·œëª¨ 6.5 ì§€ì§„',desc:'ë‚´ë¥™ ì–•ì€ ê³³ì—ì„œ ê°•ì§„ì´ ë°œìƒ! ê±´ë¬¼ ë¶•ê´´ê°€ ì´ì–´ì§‘ë‹ˆë‹¤.',baseDmg:{pop:-4000,econ:-30,infra:-45},
   knowledge:'í•œë°˜ë„ë„ ì§€ì§„ ì•ˆì „ì§€ëŒ€ê°€ ì•„ë‹™ë‹ˆë‹¤. 2016ë…„ ê²½ì£¼ ì§€ì§„(ê·œëª¨ 5.8), 2017ë…„ í¬í•­ ì§€ì§„(ê·œëª¨ 5.4)ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‚´ì§„ ì„¤ê³„ì™€ ëŒ€í”¼ í›ˆë ¨ì´ í”¼í•´ë¥¼ í¬ê²Œ ì¤„ì…ë‹ˆë‹¤.',
   responses:[
    {text:'ğŸ” ë§¤ëª°ì êµ¬ì¡° ì¦‰ì‹œ íˆ¬ì…',effect:{pop:+2000},desc:'ì‘ê¸‰ì˜ë£Œ ìˆìœ¼ë©´ êµ¬ì¡°ìœ¨ ìƒìŠ¹'},
    {text:'ğŸ—ï¸ ìœ„í—˜ ê±´ë¬¼ ì ‘ê·¼ ê¸ˆì§€',effect:{pop:+1000,infra:-5},desc:'2ì°¨ ë¶•ê´´ ë°©ì§€'},
    {text:'ğŸ“¡ ì—¬ì§„ ê²½ë³´ ë°œë ¹',effect:{pop:+500},desc:'ê²½ë³´ì‹œìŠ¤í…œ ìˆìœ¼ë©´ ì¦‰ì‹œ ë°œë™'}
   ]}
];

// ===== FUNCTIONS =====
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}

function startGame(){
  stu.name=document.getElementById('input-name').value.trim()||'ìµëª…';
  stu.grade=document.getElementById('input-grade').value.trim();
  stu.cls=document.getElementById('input-class').value.trim();
  stu.num=document.getElementById('input-number').value.trim();
  document.documentElement.requestFullscreen().catch(()=>{});
  document.getElementById('brief-student').textContent=`${stu.grade?stu.grade+'í•™ë…„ ':''}${stu.cls?stu.cls+'ë°˜ ':''}${stu.name} ì‹œì¥ë‹˜`;
  show('s-brief');
}

function showBudget(){
  const list=document.getElementById('budget-list');
  list.innerHTML=ITEMS.map(it=>`
    <div class="budget-btn flex items-start gap-3" id="item-${it.id}" onclick="toggleItem('${it.id}')">
      <div class="flex-1">
        <div class="flex items-center justify-between mb-1">
          <span class="font-bold text-white text-sm">${it.name}</span>
          <span class="text-amber-400 font-bold text-sm">${it.cost}pt</span>
        </div>
        <p class="text-slate-400 text-xs leading-relaxed">${it.desc}</p>
        <span class="inline-block mt-1 text-xs px-2 py-0.5 rounded-full bg-slate-700 text-slate-300">${it.category}</span>
      </div>
    </div>
  `).join('');
  show('s-budget');
}

function toggleItem(id){
  const item=ITEMS.find(i=>i.id===id);
  const idx=purchased.indexOf(id);
  if(idx>=0){purchased.splice(idx,1);budget+=item.cost;}
  else{if(budget<item.cost)return;purchased.push(id);budget-=item.cost;}
  updateBudgetUI();
}

function updateBudgetUI(){
  document.getElementById('budget-remain').textContent=budget;
  document.getElementById('budget-count').textContent=purchased.length;
  ITEMS.forEach(it=>{
    const el=document.getElementById('item-'+it.id);
    const bought=purchased.includes(it.id);
    el.classList.toggle('selected',bought);
    if(!bought&&budget<it.cost)el.classList.add('disabled');
    else el.classList.remove('disabled');
  });
}

function confirmBudget(){
  log.push({type:'budget',items:purchased.map(id=>ITEMS.find(i=>i.id===id).name)});
  nextRound();
}

function nextRound(){
  if(round>=5){showResult();return;}
  round++;
  // pick random disaster (no repeat in a row)
  const d=DISASTERS[Math.floor(Math.random()*DISASTERS.length)];
  
  document.getElementById('d-round').textContent=round;
  document.getElementById('d-year').textContent=round+'ë…„ì°¨';
  updateStats();
  
  // calculate damage
  let dmg={pop:d.baseDmg.pop,econ:d.baseDmg.econ,infra:d.baseDmg.infra};
  
  // apply purchased item effects
  purchased.forEach(pid=>{
    const item=ITEMS.find(i=>i.id===pid);
    if(item.effects[d.id]) {
      const red=item.effects[d.id]/100;
      dmg.pop=Math.round(dmg.pop*(1+red));
      dmg.econ=Math.round(dmg.econ*(1+red));
      dmg.infra=Math.round(dmg.infra*(1+red));
    }
    if(item.effects.ALL){
      const red=item.effects.ALL/100;
      dmg.pop=Math.round(dmg.pop*(1+red));
      dmg.econ=Math.round(dmg.econ*(1+red));
      dmg.infra=Math.round(dmg.infra*(1+red));
    }
    if(item.effects.ALL_CASUALTIES){
      dmg.pop=Math.round(dmg.pop*(1+item.effects.ALL_CASUALTIES/100));
    }
  });
  
  // apply damage
  pop=Math.max(0,pop+dmg.pop);
  econ=Math.max(0,Math.min(100,econ+dmg.econ));
  infra=Math.max(0,Math.min(100,infra+dmg.infra));
  
  log.push({type:'disaster',name:d.name,dmg:dmg});
  
  // show disaster
  document.getElementById('d-content').innerHTML=`
    <div class="disaster-card max-w-lg w-full">
      <div class="text-6xl mb-4">${d.name.split(' ')[0]}</div>
      <h2 class="jua text-2xl text-red-400 mb-3">${d.name}</h2>
      <p class="text-slate-300 mb-4">${d.desc}</p>
      <div class="grid grid-cols-3 gap-3 mb-4 text-center text-sm">
        <div class="bg-red-900/30 rounded-lg p-2"><span class="text-red-400 font-bold">${dmg.pop.toLocaleString()}</span><div class="text-xs text-slate-500">ì¸ëª… í”¼í•´</div></div>
        <div class="bg-amber-900/30 rounded-lg p-2"><span class="text-amber-400 font-bold">${dmg.econ}%</span><div class="text-xs text-slate-500">ê²½ì œ í”¼í•´</div></div>
        <div class="bg-blue-900/30 rounded-lg p-2"><span class="text-blue-400 font-bold">${dmg.infra}%</span><div class="text-xs text-slate-500">ì¸í”„ë¼ í”¼í•´</div></div>
      </div>
      <div class="bg-slate-800/60 rounded-xl p-3 mb-4 text-left text-xs text-slate-300 leading-relaxed border border-slate-700">
        <span class="text-amber-400 font-bold">ğŸ“š ì•Œì•„ë‘ì„¸ìš”:</span> ${d.knowledge}
      </div>
      <button onclick="showResponse(${DISASTERS.indexOf(d)})" class="py-3 px-8 bg-red-600 hover:bg-red-500 text-white rounded-xl font-bold transition-all hover:scale-105">ê¸´ê¸‰ ëŒ€ì‘ ì„ íƒ â†’</button>
    </div>
  `;
  updateStats();
  show('s-disaster');
}

function showResponse(dIdx){
  const d=DISASTERS[dIdx];
  const ct=document.getElementById('resp-content');
  ct.innerHTML=`
    <div class="text-center mb-6">
      <h2 class="jua text-xl text-amber-300 mb-2">ê¸´ê¸‰ ëŒ€ì‘ì„ ì„ íƒí•˜ì„¸ìš”</h2>
      <p class="text-slate-400 text-sm">${d.name} ë°œìƒ! ì¦‰ê°ì ì¸ ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      ${d.responses.map((r,i)=>`
        <div class="choice-card" onclick="chooseResponse(${dIdx},${i})">
          <div class="text-3xl mb-2">${r.text.split(' ')[0]}</div>
          <div class="font-bold text-white text-sm mb-1">${r.text}</div>
          <div class="text-slate-400 text-xs">${r.desc}</div>
        </div>
      `).join('')}
    </div>
  `;
  show('s-response');
}

function chooseResponse(dIdx,rIdx){
  const d=DISASTERS[dIdx];
  const r=d.responses[rIdx];
  let eff={...r.effect};
  
  // synergy with purchased items
  if(r.desc.includes('ê²½ë³´ì‹œìŠ¤í…œ')&&purchased.includes('warning')){if(eff.pop)eff.pop*=2;}
  if(r.desc.includes('ëŒ€í”¼ì†Œ')&&purchased.includes('shelter')){if(eff.pop)eff.pop*=2;}
  if(r.desc.includes('ì‘ê¸‰ì˜ë£Œ')&&purchased.includes('hospital')){if(eff.pop)eff.pop=Math.round(eff.pop*1.5);}
  if(r.desc.includes('ë°°ìˆ˜ì‹œìŠ¤í…œ')&&purchased.includes('drain')){if(eff.infra)eff.infra*=2;}
  
  pop=Math.max(0,pop+(eff.pop||0));
  econ=Math.max(0,Math.min(100,econ+(eff.econ||0)));
  infra=Math.max(0,Math.min(100,infra+(eff.infra||0)));
  
  // economic recovery from fund
  if(purchased.includes('economy')){econ=Math.min(100,econ+8);}
  
  log.push({type:'response',text:r.text});
  updateStats();
  
  setTimeout(()=>nextRound(),500);
}

function updateStats(){
  document.getElementById('d-pop').textContent=pop.toLocaleString();
  document.getElementById('d-pop-bar').style.width=(pop/50000*100)+'%';
  document.getElementById('d-econ').textContent=econ+'%';
  document.getElementById('d-econ-bar').style.width=econ+'%';
  document.getElementById('d-infra').textContent=infra+'%';
  document.getElementById('d-infra-bar').style.width=infra+'%';
}

function showResult(){
  const score=Math.round((pop/50000*40)+(econ/100*30)+(infra/100*30));
  let grade,icon,desc,bg;
  if(score>=80){grade='Së“±ê¸‰: ëª…ì‹œì¥';icon='ğŸŒŸ';desc='í›Œë¥­í•©ë‹ˆë‹¤! ì²´ê³„ì ì¸ ëŒ€ë¹„ë¡œ ë§ˆì„ì„ ì§€ì¼œëƒˆìŠµë‹ˆë‹¤.';bg='linear-gradient(135deg,#059669,#0d9488)';}
  else if(score>=60){grade='Aë“±ê¸‰: ìœ ëŠ¥í•œ ì‹œì¥';icon='ğŸ‘';desc='ì¢‹ì€ íŒë‹¨ì´ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¯¼ë“¤ì´ ì‹ ë¢°í•©ë‹ˆë‹¤.';bg='linear-gradient(135deg,#2563eb,#059669)';}
  else if(score>=40){grade='Bë“±ê¸‰: ì•„ì‰¬ìš´ ëŒ€ì‘';icon='ğŸ˜°';desc='í”¼í•´ë¥¼ ì¤„ì˜€ì§€ë§Œ ë” ë‚˜ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.';bg='linear-gradient(135deg,#d97706,#2563eb)';}
  else if(score>=20){grade='Cë“±ê¸‰: ìœ„ê¸°ì˜ ë§ˆì„';icon='ğŸ†˜';desc='í° í”¼í•´ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë³µêµ¬ì— ìˆ˜ë…„ì´ ê±¸ë¦´ ê²ƒì…ë‹ˆë‹¤.';bg='linear-gradient(135deg,#dc2626,#d97706)';}
  else{grade='Dë“±ê¸‰: ë§ˆì„ ë¶•ê´´';icon='ğŸ’”';desc='ë§ˆì„ ê¸°ëŠ¥ì´ ë§ˆë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¯¼ë“¤ì´ ì´ì£¼ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.';bg='linear-gradient(135deg,#7f1d1d,#dc2626)';}
  
  document.getElementById('res-header').style.background=bg;
  document.getElementById('res-icon').textContent=icon;
  document.getElementById('res-subtitle').textContent=`${stu.grade?stu.grade+'í•™ë…„ ':''}${stu.cls?stu.cls+'ë°˜ ':''}${stu.name} ì‹œì¥ì˜ 5ë…„`;
  
  const survived=pop, dead=50000-pop;
  
  document.getElementById('res-body').innerHTML=`
    <div class="text-center mb-5">
      <div class="jua text-xl mb-1" style="color:${score>=60?'#059669':'#dc2626'}">${grade}</div>
      <p class="text-sm text-slate-500">${desc}</p>
    </div>
    <div class="grid grid-cols-3 gap-3 mb-5 text-center">
      <div class="bg-green-50 rounded-xl p-3"><div class="text-2xl">ğŸ‘¥</div><div class="font-black text-green-700">${survived.toLocaleString()}</div><div class="text-xs text-green-600">ìƒì¡´ ì¸êµ¬</div></div>
      <div class="bg-amber-50 rounded-xl p-3"><div class="text-2xl">ğŸ’°</div><div class="font-black text-amber-700">${econ}%</div><div class="text-xs text-amber-600">ê²½ì œë ¥</div></div>
      <div class="bg-blue-50 rounded-xl p-3"><div class="text-2xl">ğŸ </div><div class="font-black text-blue-700">${infra}%</div><div class="text-xs text-blue-600">ì¸í”„ë¼</div></div>
    </div>
    <div class="bg-red-50 rounded-xl p-3 mb-5 text-center"><span class="text-red-600 font-bold text-sm">âš°ï¸ ì´ ì‚¬ìƒì: ${dead.toLocaleString()}ëª…</span></div>
    
    <h3 class="font-bold text-sm mb-2">ğŸ›¡ï¸ ë‚´ê°€ íˆ¬ìí•œ ë°©ì¬</h3>
    <div class="flex flex-wrap gap-1 mb-4">${purchased.length?purchased.map(id=>`<span class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded-full font-bold">${ITEMS.find(i=>i.id===id).name}</span>`).join(''):'<span class="text-xs text-slate-400">íˆ¬ì ì—†ìŒ</span>'}</div>
    
    <h3 class="font-bold text-sm mb-2">ğŸ“œ 5ë…„ê°„ì˜ ê¸°ë¡</h3>
    <div class="space-y-1 mb-5">${log.filter(l=>l.type==='disaster').map((l,i)=>`<div class="text-xs bg-slate-50 p-2 rounded-lg"><b>${i+1}ë…„ì°¨</b> ${l.name} â†’ ì¸ëª… ${l.dmg.pop.toLocaleString()}</div>`).join('')}</div>
    
    <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4">
      <h3 class="font-bold text-sm text-amber-800 mb-2">ğŸ’¡ ì‹œì¥ë‹˜ì„ ìœ„í•œ í”¼ë“œë°±</h3>
      <p class="text-xs text-amber-900 leading-relaxed">${getFeedback()}</p>
    </div>
    
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
      <h3 class="font-bold text-sm text-blue-800 mb-2">ğŸ“š êµê³¼ì„œ ì—°ê²°</h3>
      <div class="text-xs text-blue-700 space-y-1">
        <p><b>ë‹¨ì›:</b> í†µí•©ì‚¬íšŒ III. ìì—°í™˜ê²½ê³¼ ì¸ê°„</p>
        <p><b>ì„±ì·¨ê¸°ì¤€:</b> [10í†µì‚¬1-03-02] ìì—°ì¬í•´ ë° í™˜ê²½ ë¬¸ì œì˜ í•´ê²°ì„ ìœ„í•œ ë‹¤ì–‘í•œ ë…¸ë ¥ì„ íƒêµ¬í•œë‹¤.</p>
        <p><b>í•µì‹¬ ê°œë…:</b> ìì—°ì¬í•´ì— ëŒ€í•œ 'ì˜ˆë°©-ëŒ€ë¹„-ëŒ€ì‘-ë³µêµ¬' 4ë‹¨ê³„ ëŒ€ì‘ ì²´ê³„. ê°™ì€ ì¬í•´ë¼ë„ ì‚¬ì „ ëŒ€ë¹„ ìˆ˜ì¤€ì— ë”°ë¼ í”¼í•´ ê·œëª¨ê°€ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì¼ë³¸ í›„ë‹¤ì´ ë§ˆì„ì€ ë°©íŒŒì œ ë•ë¶„ì— 2011ë…„ ëŒ€ì§€ì§„ í•´ì¼ì—ë„ ì‚¬ë§ìê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.</p>
        <p><b>í™•ì¥:</b> ê¸°í›„ë³€í™”ë¡œ ìì—°ì¬í•´ì˜ ë¹ˆë„Â·ê°•ë„ê°€ ì¦ê°€í•˜ê³  ìˆìœ¼ë©°, ì´ì— ëŒ€í•œ êµ­ì œì  í˜‘ë ¥(íŒŒë¦¬í˜‘ì •)ê³¼ ì§€ì—­ ì°¨ì›ì˜ ë°©ì¬ ê³„íšì´ ëª¨ë‘ í•„ìš”í•©ë‹ˆë‹¤.</p>
      </div>
    </div>
    
    <div class="text-center text-xs text-slate-400 mt-3"><p>ì¬ë‚œ ì‹œì¥ Â· í†µí•©ì‚¬íšŒ Â· ê¹€ìŠ¤ë°ë°˜ T</p><p>${new Date().toLocaleDateString('ko-KR')}</p></div>
  `;
  missionComplete=true;
  if(document.fullscreenElement)document.exitFullscreen().catch(()=>{});
  show('s-result');
}

function getFeedback(){
  const tips=[];
  if(!purchased.includes('warning'))tips.push('ì¡°ê¸°ê²½ë³´ì‹œìŠ¤í…œ(15pt)ì€ ê°€ì„±ë¹„ê°€ ê°€ì¥ ë†’ì€ íˆ¬ìì…ë‹ˆë‹¤. ëª¨ë“  ì¬ë‚œì—ì„œ ëŒ€í”¼ ì‹œê°„ì„ í™•ë³´í•´ì¤ë‹ˆë‹¤.');
  if(!purchased.includes('education'))tips.push('ë°©ì¬êµìœ¡(10pt)ì€ ì €ë ´í•˜ì§€ë§Œ ëª¨ë“  ì¬ë‚œì— -15% íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.');
  if(purchased.includes('seawall')&&purchased.includes('mangrove'))tips.push('ë°©íŒŒì œ+ë§¹ê·¸ë¡œë¸Œ ì¡°í•©ì€ í•´ì•ˆ ì¬í•´ì— ìµœê°•ì…ë‹ˆë‹¤. ì¢‹ì€ ì„ íƒ!');
  if(!purchased.includes('hospital'))tips.push('ì‘ê¸‰ì˜ë£Œ ì—†ì´ëŠ” ì¬ë‚œ í›„ 2ì°¨ ì‚¬ë§ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.');
  if(purchased.includes('economy'))tips.push('ê²½ì œ ë³µêµ¬ ê¸°ê¸ˆ ë•ë¶„ì— ë§¤ ë¼ìš´ë“œ ê²½ì œë ¥ì´ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.');
  if(tips.length===0)tips.push('ê· í˜• ì¡íŒ íˆ¬ìì˜€ìŠµë‹ˆë‹¤! ë‹¤ì–‘í•œ ì¬ë‚œì— ê³¨ê³ ë£¨ ëŒ€ë¹„í•˜ì…¨ë„¤ìš”.');
  return tips.join(' ');
}

function saveImg(){
  html2canvas(document.getElementById('result-card'),{scale:2,backgroundColor:'#fff'}).then(c=>{
    const a=document.createElement('a');a.download=`ì¬ë‚œì‹œì¥_${stu.name}_${new Date().toISOString().slice(0,10)}.png`;a.href=c.toDataURL('image/png');a.click();
  }).catch(()=>alert('ì €ì¥ ì‹¤íŒ¨'));
}

function exitToBlog(){
  missionComplete = true;
  if(document.fullscreenElement)document.exitFullscreen().catch(()=>{});
  if(document.referrer&&document.referrer.includes('blogspot'))window.location.href=document.referrer;
  else window.history.back();
}
// ===== ì „ì²´í™”ë©´ ê°€ë“œ =====
let missionComplete = false;
let isReEntering = false;

function reEnterFullscreen(){
  isReEntering = true;
  document.getElementById('fs-warning').style.display = 'none';
  document.documentElement.requestFullscreen().catch(()=>{isReEntering=false;});
}

document.addEventListener('fullscreenchange', () => {
  if(!document.fullscreenElement && !missionComplete && !isReEntering){
    const cur = document.querySelector('.screen.active');
    if(cur && cur.id !== 's-start' && cur.id !== 's-intro'){
      document.getElementById('fs-warning').style.display = 'flex';
    }
  }
  if(document.fullscreenElement){
    isReEntering = false;
    document.getElementById('fs-warning').style.display = 'none';
  }
});

</script>
<!-- ì „ì²´í™”ë©´ ì´íƒˆ ê²½ê³  ì˜¤ë²„ë ˆì´ -->
<div class="fs-warning-overlay" id="fs-warning" style="display:none">
  <div class="warn-icon">âš ï¸</div>
  <div class="warn-title">ë¯¸ì…˜ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤!</div>
  <div class="warn-msg">ì „ì²´í™”ë©´ì„ ìœ ì§€í•´ì•¼ ë¯¸ì…˜ì„ ê³„ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ì „ì²´í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì„¸ìš”.</div>
  <button class="warn-btn" onclick="reEnterFullscreen()">ğŸ”’ ì „ì²´í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>
<!-- ë¸”ë¡œê·¸ ë§í¬ ë°°ì§€ -->
<a href="https://ssam-ssong.blogspot.com" target="_blank" class="blog-badge">âœï¸ í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™</a>
</body>
</html>
