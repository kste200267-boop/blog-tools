<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0f1117;--sf:#1a1d27;--sf2:#242836;--bd:#2e3345;--tx:#e2e5f0;--sub:#8b90a5;--pr:#6366f1;--prl:#818cf820;--gr:#22c55e;--rd:#ef4444;--yw:#eab308;--r:12px;--f:'Pretendard','Noto Sans KR',sans-serif}
*{box-sizing:border-box;margin:0;padding:0}body{font-family:var(--f);background:var(--bg);color:var(--tx);min-height:100vh}button{font-family:var(--f);cursor:pointer}
input,select,textarea{font-family:var(--f);background:var(--sf2);color:var(--tx);border:1px solid var(--bd);border-radius:8px;padding:10px 14px;font-size:.9rem;width:100%;outline:none}input:focus,select:focus,textarea:focus{border-color:var(--pr)}textarea{resize:vertical;min-height:60px}code{background:var(--sf2);padding:2px 6px;border-radius:4px;font-size:.85em;color:var(--yw)}
.login{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px}.login .logo{font-size:3rem}.login h2{font-weight:800}.login input{max-width:280px;text-align:center;font-size:1.1rem;letter-spacing:4px}.login .lb{padding:12px 40px;background:var(--pr);color:#fff;border:none;border-radius:10px;font-size:1rem;font-weight:700}.login .err{color:var(--rd);font-size:.85rem;min-height:20px}
.top{background:var(--sf);border-bottom:1px solid var(--bd);padding:14px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}.top h1{font-size:1.05rem;font-weight:800}.top .act{display:flex;gap:8px}.main{max-width:1000px;margin:0 auto;padding:24px 16px 80px}
.tabs{display:flex;gap:2px;margin-bottom:24px;border-bottom:2px solid var(--bd);overflow-x:auto}.tb{padding:12px 16px;background:none;border:none;color:var(--sub);font-size:.85rem;font-weight:600;border-bottom:2px solid transparent;margin-bottom:-2px;white-space:nowrap}.tb.on{color:var(--pr);border-bottom-color:var(--pr)}.tb:hover{color:var(--tx)}.tp{display:none}.tp.on{display:block}
.b{padding:8px 18px;border:1px solid var(--bd);border-radius:8px;background:var(--sf2);color:var(--tx);font-size:.85rem;font-weight:600;display:inline-flex;align-items:center;gap:6px}.b:hover{background:var(--bd)}.bp{background:var(--pr);border-color:var(--pr);color:#fff}.bd{background:var(--rd);border-color:var(--rd);color:#fff}.bg{background:var(--gr);border-color:var(--gr);color:#fff}.bs{padding:6px 12px;font-size:.8rem}.by{background:var(--yw);border-color:var(--yw);color:#000}
.cd{background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:18px;margin-bottom:12px}.cd:hover{border-color:var(--pr)}.ch{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;gap:8px}.ch h3{font-size:1rem;font-weight:700}.badge{font-size:.75rem;padding:3px 10px;border-radius:20px;background:var(--prl);color:var(--pr);white-space:nowrap}.cb{font-size:.88rem;color:var(--sub);line-height:1.6}.ca{display:flex;gap:6px;margin-top:12px;flex-wrap:wrap}.tag{display:inline-block;font-size:.72rem;padding:2px 8px;border-radius:10px;background:var(--sf2);color:var(--sub);margin-right:4px}
.dz{border:2px dashed var(--bd);border-radius:16px;padding:40px 20px;text-align:center;cursor:pointer;margin-bottom:20px;transition:all .3s}.dz.over{border-color:var(--pr);background:var(--prl)}.dz .di{font-size:3rem;margin-bottom:12px}.dz .dt{font-size:1.05rem;font-weight:700;margin-bottom:6px}.dz .ds{font-size:.85rem;color:var(--sub)}.dz input{display:none}
.qi{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:14px;margin-bottom:10px}.qh{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.qo{font-size:.8rem;color:var(--sub)}.qa{color:var(--pr);font-size:.8rem;margin:0 6px}.qn{font-size:.85rem;color:var(--gr);font-weight:600}.qr{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}.qr input,.qr select{padding:8px 10px;font-size:.83rem}.qr label{font-size:.75rem;color:var(--sub);display:block;margin-bottom:3px}
.fg{margin-bottom:16px}.fg label{display:block;font-size:.82rem;font-weight:600;color:var(--sub);margin-bottom:6px}.fr{display:grid;grid-template-columns:1fr 1fr;gap:12px}.fr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.mo{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;display:none;align-items:center;justify-content:center;padding:16px}.mo.show{display:flex}.ml{background:var(--sf);border:1px solid var(--bd);border-radius:16px;padding:28px;max-width:560px;width:100%;max-height:85vh;overflow-y:auto}.ml h2{font-size:1.15rem;font-weight:800;margin-bottom:20px}.ma{display:flex;justify-content:flex-end;gap:8px;margin-top:24px}
.dlz{background:var(--sf);border:2px dashed var(--bd);border-radius:16px;padding:32px;text-align:center;margin-top:20px}.dlz h3{font-size:1.1rem;font-weight:700;margin-bottom:12px}.dlz p{color:var(--sub);font-size:.88rem;margin-bottom:16px;line-height:1.5}.dlb{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.empty{text-align:center;padding:40px;color:var(--sub)}.empty .icon{font-size:2.5rem;margin-bottom:12px}.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--gr);color:#fff;padding:12px 28px;border-radius:10px;font-weight:600;font-size:.9rem;transition:transform .3s;z-index:999}.toast.show{transform:translateX(-50%) translateY(0)}
.sb{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}.si{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:12px 18px;flex:1;min-width:100px;text-align:center}.sn{font-size:1.5rem;font-weight:800;color:var(--pr)}.sl{font-size:.75rem;color:var(--sub);margin-top:2px}
.steps{display:flex;gap:16px;margin-top:16px;flex-wrap:wrap}.step{flex:1;min-width:130px;background:var(--sf2);border-radius:10px;padding:16px;text-align:center}.step .num{width:28px;height:28px;border-radius:50%;background:var(--pr);color:#fff;font-size:.8rem;font-weight:800;display:inline-flex;align-items:center;justify-content:center;margin-bottom:8px}.step p{font-size:.82rem;color:var(--sub);line-height:1.4}.step strong{display:block;font-size:.88rem;color:var(--tx);margin-bottom:4px}
@media(max-width:640px){.fr,.fr3,.qr{grid-template-columns:1fr}.steps{flex-direction:column}.top{flex-direction:column;gap:10px;align-items:flex-start}.sb{flex-direction:column}}
</style>
</head>
<body>
<div class="login" id="LG"><div class="logo">ğŸ”§</div><h2>ê´€ë¦¬ì ëª¨ë“œ</h2><input type="password" id="pw" placeholder="ë¹„ë°€ë²ˆí˜¸" maxlength="20" autofocus><button class="lb" onclick="doLogin()">ë¡œê·¸ì¸</button><div class="err" id="lerr"></div></div>
<div class="top" id="TB" style="display:none"><h1>ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ</h1><div class="act"><button class="b bs" onclick="window.open('index.html','_blank')">ğŸ  ì‚¬ì´íŠ¸</button><button class="b bs bd" onclick="location.reload()">ë¡œê·¸ì•„ì›ƒ</button></div></div>
<div class="main" id="MA" style="display:none">
<div class="sb" id="SB"></div>
<div class="tabs">
<button class="tb on" data-t="upload" onclick="tab('upload')">ğŸ“¤ ì—…ë¡œë“œ</button>
<button class="tb" data-t="cat" onclick="tab('cat')">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</button>
<button class="tb" data-t="unit" onclick="tab('unit')">ğŸ“š ë‹¨ì›</button>
<button class="tb" data-t="cont" onclick="tab('cont')">ğŸ“„ ì½˜í…ì¸ </button>
<button class="tb" data-t="exp" onclick="tab('exp')">ğŸ“¦ ë‚´ë³´ë‚´ê¸°</button>
<button class="tb" data-t="help" onclick="tab('help')">â“ ë„ì›€ë§</button>
</div>
<div class="tp on" id="p-upload">
<div class="dz" id="DZ"><div class="di">ğŸ“</div><div class="dt">HTML íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div><div class="ds">ë˜ëŠ” í´ë¦­ Â· í•œê¸€ íŒŒì¼ëª… ìë™ ì˜ë¬¸ ë³€í™˜</div><input type="file" id="FI" accept=".html,.htm" multiple></div>
<div id="UQ"></div>
<div id="UA" style="display:none;text-align:center;margin-top:16px"><button class="b bg" onclick="regAll()" style="padding:14px 40px;font-size:1rem">âœ… ì „ë¶€ ë“±ë¡</button> <button class="b bs" onclick="clrQ()">ğŸ—‘ ì´ˆê¸°í™”</button></div>
</div>
<div class="tp" id="p-cat"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h2 style="font-size:1rem;font-weight:700">ì¹´í…Œê³ ë¦¬</h2><button class="b bp" onclick="openCM()">+ ì¶”ê°€</button></div><div id="CL"></div></div>
<div class="tp" id="p-unit"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h2 style="font-size:1rem;font-weight:700">ë‹¨ì›</h2><button class="b bp" onclick="openUM()">+ ì¶”ê°€</button></div><div id="UL"></div></div>
<div class="tp" id="p-cont"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px"><div style="display:flex;align-items:center;gap:10px"><h2 style="font-size:1rem;font-weight:700">ì½˜í…ì¸ </h2><select id="CF" onchange="rCont()" style="width:auto;padding:6px 12px;font-size:.85rem"><option value="">ì „ì²´</option></select></div><button class="b bp" onclick="openCoM()">+ ìˆ˜ë™ ì¶”ê°€</button></div><div id="CoL"></div></div>
<div class="tp" id="p-exp">
<div class="dlz"><h3>ğŸ“¦ JSON ë‚´ë³´ë‚´ê¸°</h3><p>ë‹¤ìš´ë¡œë“œ í›„ HTMLê³¼ í•¨ê»˜ GitHub ì—…ë¡œë“œ</p><div class="dlb"><button class="b bp" onclick="dlAll()">ğŸ“¥ ì „ì²´ JSON ë‹¤ìš´ë¡œë“œ</button></div></div>
<div class="dlz" style="margin-top:16px;border-color:var(--yw)"><h3>ğŸ”„ ê°€ì ¸ì˜¤ê¸°</h3><p>GitHub Pagesì—ì„œ ê¸°ì¡´ ë°ì´í„° ë³µì›</p><div class="dlb"><button class="b by" onclick="impSite()">ğŸŒ ì‚¬ì´íŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button><button class="b" onclick="document.getElementById('IF').click()">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</button><input type="file" id="IF" accept=".json" multiple style="display:none" onchange="impF(event)"></div></div>
</div>
<div class="tp" id="p-help">
<div class="cd" style="border-color:var(--pr)"><h3 style="font-weight:800;margin-bottom:16px">ğŸ“– ì‚¬ìš© ë°©ë²•</h3><div class="steps"><div class="step"><div class="num">1</div><strong>íŒŒì¼ ì—…ë¡œë“œ</strong><p>ğŸ“¤íƒ­ì— HTML ë“œë˜ê·¸â†’ìë™ ì˜ë¬¸ ë³€í™˜</p></div><div class="step"><div class="num">2</div><strong>ì •ë³´ ì…ë ¥</strong><p>ë‹¨ì›, ì œëª©, ìœ í˜•</p></div><div class="step"><div class="num">3</div><strong>JSON ë‚´ë³´ë‚´ê¸°</strong><p>ğŸ“¦íƒ­ì—ì„œ ë‹¤ìš´ë¡œë“œ</p></div><div class="step"><div class="num">4</div><strong>GitHub ì—…ë¡œë“œ</strong><p>JSON+HTML ë ˆí¬ ë“œë˜ê·¸</p></div></div></div>
<div class="cd" style="margin-top:12px"><h3 style="font-weight:800;margin-bottom:12px">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3><div style="display:flex;gap:8px"><input type="password" id="NP" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" style="max-width:200px"><button class="b bp bs" onclick="chPW()">ë³€ê²½</button></div></div>
</div>
</div>
<!-- ì¹´í…Œê³ ë¦¬ ëª¨ë‹¬ -->
<div class="mo" id="CM"><div class="ml"><h2 id="CMT">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</h2><input type="hidden" id="CI" value="-1">
<div class="fr"><div class="fg"><label>ID(ì˜ë¬¸)</label><input id="ci"></div><div class="fg"><label>ì•„ì´ì½˜</label><input id="ck" style="text-align:center;font-size:1.5rem"></div></div>
<div class="fg"><label>ì´ë¦„</label><input id="ct"></div><div class="fg"><label>ì„¤ëª…</label><input id="cd"></div>
<div class="fr"><div class="fg"><label>ìƒ‰ìƒ</label><input id="cc" type="color" value="#2563eb" style="height:42px;padding:4px"></div><div class="fg"><label>ë§í¬</label><input id="cl" placeholder="hub-social.html"></div></div>
<div class="ma"><button class="b" onclick="clM('CM')">ì·¨ì†Œ</button><button class="b bp" onclick="svC()">ì €ì¥</button></div></div></div>
<!-- ë‹¨ì› ëª¨ë‹¬ -->
<div class="mo" id="UM"><div class="ml"><h2 id="UMT">ğŸ“š ë‹¨ì›</h2><input type="hidden" id="UI" value="-1">
<div class="fg"><label>ì¹´í…Œê³ ë¦¬</label><select id="uca"><option value="">ì„ íƒ</option></select></div>
<div class="fr"><div class="fg"><label>ì½”ë“œ</label><input id="uco"></div><div class="fg"><label>slug</label><input id="usl"></div></div>
<div class="fg"><label>ë‹¨ì›ëª…</label><input id="uti"></div><div class="fg"><label>ë¶€ì œ</label><input id="usb"></div>
<div class="fg"><label>ì„±ì·¨ê¸°ì¤€</label><textarea id="uac"></textarea></div>
<div class="fg"><label>íƒœê·¸(ì‰¼í‘œ)</label><input id="utg"></div>
<div class="ma"><button class="b" onclick="clM('UM')">ì·¨ì†Œ</button><button class="b bp" onclick="svU()">ì €ì¥</button></div></div></div>
<!-- ì½˜í…ì¸  ëª¨ë‹¬ -->
<div class="mo" id="CoM"><div class="ml"><h2 id="CoMT">ğŸ“„ ì½˜í…ì¸ </h2><input type="hidden" id="ceu" value=""><input type="hidden" id="cei" value="-1">
<div class="fg"><label>ë‹¨ì›</label><select id="cun"><option value="">ì„ íƒ</option></select></div>
<div class="fr"><div class="fg"><label>slug</label><input id="csl"></div><div class="fg"><label>íŒŒì¼ëª…</label><input id="cfi"></div></div>
<div class="fg"><label>ì œëª©</label><input id="ctt"></div><div class="fg"><label>ì„¤ëª…</label><input id="cde"></div>
<div class="fr3"><div class="fg"><label>ìœ í˜•</label><select id="cty"><option>ì›¹êµêµ¬</option><option>ìˆ˜ì—…ìë£Œ</option><option>í•™ìŠµì§€</option><option>í™œë™ì§€</option><option>ë¬¸í•­</option><option>êµì‚¬ìš©</option></select></div><div class="fg"><label>ë‚œì´ë„</label><select id="cdi"><option>ë³´í†µ</option><option>ì‰¬ì›€</option><option>ì‹¬í™”</option></select></div><div class="fg"><label>ì†Œìš”ì‹œê°„</label><input id="cdu" placeholder="15ë¶„"></div></div>
<div class="fg"><label>íƒœê·¸(ì‰¼í‘œ)</label><input id="ctg"></div>
<div class="ma"><button class="b" onclick="clM('CoM')">ì·¨ì†Œ</button><button class="b bp" onclick="svCo()">ì €ì¥</button></div></div></div>
<div class="toast" id="T"></div>
<script>
const KO2EN={'í†µí•©ì‚¬íšŒ':'social','í†µì‚¬':'social','ê²½ì œ':'economy','ì‚¬íšŒ':'social','ë¬¸í™”':'culture','í–‰ë³µ':'happiness','ì¸ê¶Œ':'human-rights','í™˜ê²½':'env','ì •ì¹˜':'politics','ì°¨ì‹œ':'lesson','í•™ìŠµì§€':'worksheet','í•™ìŠµ':'worksheet','í™œë™ì§€':'activity','ìˆ˜ì—…':'class','í€´ì¦ˆ':'quiz','ì‹œí—˜':'test','í‰ê°€':'eval','ë¬¸í•­':'quiz','êµì‚¬ìš©':'teacher','ìˆ˜ì—…íë¦„':'lesson-flow','í•µì‹¬ê°œë…':'key-concepts','ìƒí™œì‚¬ë¡€':'life-activity','ìì‚°ê´€ë¦¬':'asset','ê¸ˆìœµ':'finance','í¬íŠ¸í´ë¦¬ì˜¤':'portfolio','íˆ¬ì':'invest','ê¸°í›„ë³€í™”':'climate','ì¬ë‚œ':'disaster','ë¶ˆí‰ë“±':'inequality','ì‹œë®¬ë ˆì´ì…˜':'sim','í™”ì„±':'mars','ë„ì‹œ':'city','ë²”ì£„':'crime','ìˆ˜ì‚¬':'investigation','ê²Œì„':'game','ì§„ë‹¨':'diagnosis','ì„œë°”ì´ë²Œ':'survival','ë§ˆì„':'town','ë²•ì •':'court','ì™¸êµê´€':'diplomat','ë ˆì´ë”':'radar','ì†Œì„¤':'novel','ì¸ìƒ':'life'};
function k2s(fn){let n=fn.replace(/\.(html?|htm)$/i,'').replace(/[_\s]+/g,'-');if(/^[a-z0-9-]+$/.test(n))return n;let r=n;Object.entries(KO2EN).sort((a,b)=>b[0].length-a[0].length).forEach(([k,v])=>{r=r.split(k).join(v)});return r.replace(/[^a-z0-9-]/gi,'').replace(/-+/g,'-').replace(/^-|-$/g,'').toLowerCase()||'content-'+Date.now().toString(36)}
function autoFN(o,u){const s=k2s(o);const p=u?'c-'+u+'-':'w-';return(s.startsWith('c-')||s.startsWith('w-'))?s+'.html':p+s+'.html'}
function exTitle(h){const m=h.match(/<title[^>]*>([^<]+)<\/title>/i);return m?m[1].replace(/\s*[\|â€”â€“].*/,'').trim():''}
const SK='admin_v2',DP='1234';let D={pw:DP,cat:[],units:[],uc:{}},Q=[];
function ld(){try{const d=localStorage.getItem(SK);if(d)D=JSON.parse(d)}catch(e){}if(!D.pw)D.pw=DP;if(!D.cat)D.cat=[];if(!D.units)D.units=[];if(!D.uc)D.uc={}}
function sv(){localStorage.setItem(SK,JSON.stringify(D))}
function doLogin(){if(document.getElementById('pw').value===D.pw){document.getElementById('LG').style.display='none';document.getElementById('TB').style.display='';document.getElementById('MA').style.display='';rAll()}else document.getElementById('lerr').textContent='ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜'}
function chPW(){const v=document.getElementById('NP').value.trim();if(v.length<2){toast('2ì ì´ìƒ','r');return}D.pw=v;sv();toast('ë³€ê²½ ì™„ë£Œ')}
document.getElementById('pw').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin()});
function tab(t){document.querySelectorAll('.tb').forEach(b=>b.classList.toggle('on',b.dataset.t===t));document.querySelectorAll('.tp').forEach(p=>p.classList.toggle('on',p.id==='p-'+t))}
function rStats(){const tc=Object.values(D.uc).reduce((s,u)=>s+(u.contents||[]).length,0);document.getElementById('SB').innerHTML='<div class="si"><div class="sn">'+D.cat.length+'</div><div class="sl">ì¹´í…Œê³ ë¦¬</div></div><div class="si"><div class="sn">'+D.units.length+'</div><div class="sl">ë‹¨ì›</div></div><div class="si"><div class="sn">'+tc+'</div><div class="sl">ì½˜í…ì¸ </div></div>'}
function rAll(){rStats();rCat();rUnit();rCont();rSel()}
// ì¹´í…Œê³ ë¦¬
function rCat(){const el=document.getElementById('CL');if(!D.cat.length){el.innerHTML='<div class="empty"><div class="icon">ğŸ·ï¸</div><p>ì—†ìŒ</p></div>';return}el.innerHTML=D.cat.map((c,i)=>'<div class="cd"><div class="ch"><h3>'+c.icon+' '+c.title+'</h3><span class="badge">'+c.link+'</span></div><div class="cb">'+c.desc+'</div><div class="ca"><button class="b bs" onclick="eC('+i+')">âœï¸</button><button class="b bs bd" onclick="dC('+i+')">ğŸ—‘</button></div></div>').join('')}
function openCM(){document.getElementById('CI').value=-1;['ci','ck','ct','cd','cl'].forEach(x=>document.getElementById(x).value='');document.getElementById('cc').value='#2563eb';opM('CM')}
function eC(i){const c=D.cat[i];document.getElementById('CI').value=i;document.getElementById('ci').value=c.id;document.getElementById('ck').value=c.icon;document.getElementById('ct').value=c.title;document.getElementById('cd').value=c.desc;document.getElementById('cc').value=c.color;document.getElementById('cl').value=c.link;opM('CM')}
function svC(){const i=+document.getElementById('CI').value;const c={id:document.getElementById('ci').value.trim(),icon:document.getElementById('ck').value.trim(),title:document.getElementById('ct').value.trim(),desc:document.getElementById('cd').value.trim(),color:document.getElementById('cc').value,link:document.getElementById('cl').value.trim()||'#'};if(!c.title){toast('ì´ë¦„ í•„ìˆ˜','r');return}if(!c.id)c.id=k2s(c.title);if(i===-1)D.cat.push(c);else D.cat[i]=c;sv();clM('CM');rAll();toast('ì €ì¥')}
function dC(i){if(!confirm('ì‚­ì œ?'))return;D.cat.splice(i,1);sv();rAll();toast('ì‚­ì œ')}
// ë‹¨ì›
function rUnit(){const el=document.getElementById('UL');if(!D.units.length){el.innerHTML='<div class="empty"><div class="icon">ğŸ“š</div><p>ì—†ìŒ</p></div>';return}el.innerHTML=D.units.map((u,i)=>{const cc=(D.uc[u.slug]?.contents||[]).length;return'<div class="cd"><div class="ch"><h3>'+u.code+'. '+u.title+'</h3><span class="badge">'+cc+'ê°œ</span></div><div class="cb">'+(u.subtitle||'')+' '+u.tags.map(t=>'<span class="tag">'+t+'</span>').join('')+'</div><div class="ca"><button class="b bs" onclick="eU('+i+')">âœï¸</button><button class="b bs bd" onclick="dU('+i+')">ğŸ—‘</button></div></div>'}).join('')}
function openUM(){document.getElementById('UI').value=-1;['uco','usl','uti','usb','uac','utg'].forEach(x=>document.getElementById(x).value='');opM('UM')}
function eU(i){const u=D.units[i];document.getElementById('UI').value=i;document.getElementById('uco').value=u.code;document.getElementById('usl').value=u.slug;document.getElementById('uti').value=u.title;document.getElementById('usb').value=u.subtitle||'';document.getElementById('uac').value=D.uc[u.slug]?.achievementStandard||'';document.getElementById('utg').value=u.tags.join(', ');if(u.categoryId)document.getElementById('uca').value=u.categoryId;opM('UM')}
function svU(){const i=+document.getElementById('UI').value;const sl=document.getElementById('usl').value.trim().toLowerCase().replace(/[^a-z0-9-]/g,'');const ti=document.getElementById('uti').value.trim();if(!sl||!ti){toast('slug/ì´ë¦„ í•„ìˆ˜','r');return}const u={slug:sl,code:document.getElementById('uco').value.trim(),title:ti,subtitle:document.getElementById('usb').value.trim(),tags:document.getElementById('utg').value.split(',').map(t=>t.trim()).filter(Boolean),contentCount:0,categoryId:document.getElementById('uca').value};const ac=document.getElementById('uac').value.trim();if(i===-1){if(D.units.find(x=>x.slug===sl)){toast('slug ì¤‘ë³µ','r');return}D.units.push(u);D.uc[sl]={unit:ti,unitSlug:sl,achievementStandard:ac,contents:[]}}else{const old=D.units[i].slug;D.units[i]=u;if(old!==sl){D.uc[sl]=D.uc[old]||{unit:ti,unitSlug:sl,achievementStandard:ac,contents:[]};delete D.uc[old]}D.uc[sl].unit=ti;D.uc[sl].unitSlug=sl;D.uc[sl].achievementStandard=ac}uCnt();sv();clM('UM');rAll();toast('ì €ì¥')}
function dU(i){if(!confirm('ì‚­ì œ?'))return;delete D.uc[D.units[i].slug];D.units.splice(i,1);sv();rAll();toast('ì‚­ì œ')}
// ì½˜í…ì¸ 
function rCont(){const el=document.getElementById('CoL');const f=document.getElementById('CF').value;let items=[];for(const s in D.uc){if(f&&s!==f)continue;(D.uc[s].contents||[]).forEach((c,i)=>items.push({...c,us:s,ut:D.uc[s].unit,idx:i}))}if(!items.length){el.innerHTML='<div class="empty"><div class="icon">ğŸ“„</div><p>ì—†ìŒ</p></div>';return}el.innerHTML=items.map(c=>'<div class="cd"><div class="ch"><h3>'+c.title+'</h3><span class="badge">'+c.type+'</span></div><div class="cb"><span class="tag">'+c.ut+'</span><span class="tag">'+c.difficulty+'</span><span class="tag">â±'+c.duration+'</span> <code>'+c.file+'</code></div><div class="ca"><button class="b bs" onclick="eCo(\''+c.us+'\','+c.idx+')">âœï¸</button><button class="b bs bd" onclick="dCo(\''+c.us+'\','+c.idx+')">ğŸ—‘</button></div></div>').join('')}
function openCoM(){document.getElementById('ceu').value='';document.getElementById('cei').value=-1;['csl','cfi','ctt','cde','cdu','ctg'].forEach(x=>document.getElementById(x).value='');document.getElementById('cun').value=document.getElementById('CF').value||'';opM('CoM')}
function eCo(us,i){const c=D.uc[us].contents[i];document.getElementById('ceu').value=us;document.getElementById('cei').value=i;document.getElementById('cun').value=us;document.getElementById('csl').value=c.slug;document.getElementById('cfi').value=c.file;document.getElementById('ctt').value=c.title;document.getElementById('cde').value=c.desc||'';document.getElementById('cty').value=c.type;document.getElementById('cdi').value=c.difficulty;document.getElementById('cdu').value=c.duration;document.getElementById('ctg').value=(c.tags||[]).join(', ');opM('CoM')}
function svCo(){const eu=document.getElementById('ceu').value;const ei=+document.getElementById('cei').value;const us=document.getElementById('cun').value;if(!us){toast('ë‹¨ì› ì„ íƒ','r');return}const c={slug:document.getElementById('csl').value.trim().toLowerCase().replace(/[^a-z0-9-]/g,''),file:document.getElementById('cfi').value.trim(),title:document.getElementById('ctt').value.trim(),desc:document.getElementById('cde').value.trim(),type:document.getElementById('cty').value,difficulty:document.getElementById('cdi').value,duration:document.getElementById('cdu').value.trim(),tags:document.getElementById('ctg').value.split(',').map(t=>t.trim()).filter(Boolean)};if(!c.slug||!c.title||!c.file){toast('í•„ìˆ˜ê°’','r');return}if(!D.uc[us])D.uc[us]={unit:'',unitSlug:us,achievementStandard:'',contents:[]};if(ei===-1)D.uc[us].contents.push(c);else{if(eu&&eu!==us){D.uc[eu].contents.splice(ei,1);D.uc[us].contents.push(c)}else D.uc[us].contents[ei]=c}uCnt();sv();clM('CoM');rAll();toast('ì €ì¥')}
function dCo(us,i){if(!confirm('ì‚­ì œ?'))return;D.uc[us].contents.splice(i,1);uCnt();sv();rAll();toast('ì‚­ì œ')}
function uCnt(){D.units.forEach(u=>{u.contentCount=(D.uc[u.slug]?.contents||[]).length})}
function rSel(){const o=D.units.map(u=>'<option value="'+u.slug+'">'+u.code+'. '+u.title+'</option>').join('');document.getElementById('CF').innerHTML='<option value="">ì „ì²´</option>'+o;document.getElementById('cun').innerHTML='<option value="">ì„ íƒ</option>'+o;document.getElementById('uca').innerHTML='<option value="">ì„ íƒ</option>'+D.cat.map(c=>'<option value="'+c.id+'">'+c.icon+' '+c.title+'</option>').join('')}
// ì—…ë¡œë“œ
const dz=document.getElementById('DZ'),fi=document.getElementById('FI');
dz.addEventListener('click',()=>fi.click());dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('over')});dz.addEventListener('dragleave',()=>dz.classList.remove('over'));dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('over');hFiles(e.dataTransfer.files)});fi.addEventListener('change',e=>hFiles(e.target.files));
function hFiles(fs){Array.from(fs).forEach(f=>{if(!f.name.match(/\.html?$/i))return;const r=new FileReader();r.onload=function(e){const t=exTitle(e.target.result)||f.name.replace(/\.html?$/i,'');const du=D.units.length?D.units[0].slug:'';Q.push({on:f.name,nn:autoFN(f.name,du),title:t,us:du,type:'ì›¹êµêµ¬',diff:'ë³´í†µ',dur:'15ë¶„',desc:'',tags:''});rQ()};r.readAsText(f)})}
function rQ(){const el=document.getElementById('UQ');document.getElementById('UA').style.display=Q.length?'':'none';if(!Q.length){el.innerHTML='';return}el.innerHTML=Q.map((q,i)=>{const uo=D.units.map(u=>'<option value="'+u.slug+'" '+(u.slug===q.us?'selected':'')+'>'+u.code+'. '+u.title+'</option>').join('');return'<div class="qi"><div class="qh"><div><span class="qo">'+q.on+'</span><span class="qa">â†’</span><span class="qn">'+q.nn+'</span></div><button class="b bs bd" onclick="Q.splice('+i+',1);rQ()">âœ•</button></div><div class="qr"><div><label>ë‹¨ì›</label><select onchange="Q['+i+'].us=this.value;Q['+i+'].nn=autoFN(Q['+i+'].on,this.value);rQ()"><option value="">ì„ íƒ</option>'+uo+'</select></div><div><label>íŒŒì¼ëª…</label><input value="'+q.nn+'" onchange="Q['+i+'].nn=this.value"></div></div><div class="qr"><div><label>ì œëª©</label><input value="'+q.title+'" onchange="Q['+i+'].title=this.value"></div><div><label>ì„¤ëª…</label><input value="'+q.desc+'" onchange="Q['+i+'].desc=this.value"></div></div><div class="qr" style="grid-template-columns:1fr 1fr 1fr"><div><label>ìœ í˜•</label><select onchange="Q['+i+'].type=this.value">'+['ì›¹êµêµ¬','ìˆ˜ì—…ìë£Œ','í•™ìŠµì§€','í™œë™ì§€','ë¬¸í•­','êµì‚¬ìš©'].map(t=>'<option '+(t===q.type?'selected':'')+'>'+t+'</option>').join('')+'</select></div><div><label>ë‚œì´ë„</label><select onchange="Q['+i+'].diff=this.value">'+['ë³´í†µ','ì‰¬ì›€','ì‹¬í™”'].map(t=>'<option '+(t===q.diff?'selected':'')+'>'+t+'</option>').join('')+'</select></div><div><label>ì†Œìš”ì‹œê°„</label><input value="'+q.dur+'" onchange="Q['+i+'].dur=this.value"></div></div><div style="margin-top:8px"><label style="font-size:.75rem;color:var(--sub)">íƒœê·¸(ì‰¼í‘œ)</label><input value="'+q.tags+'" onchange="Q['+i+'].tags=this.value"></div></div>'}).join('')}
function regAll(){let c=0;Q.forEach(q=>{if(!q.us)return;if(!D.uc[q.us])D.uc[q.us]={unit:'',unitSlug:q.us,achievementStandard:'',contents:[]};const sl=q.nn.replace(/\.html?$/i,'').replace(/^(c|w)-[a-z-]+-/,'');D.uc[q.us].contents.push({slug:sl||'item',file:q.nn,title:q.title,desc:q.desc,type:q.type,difficulty:q.diff,duration:q.dur,tags:q.tags?q.tags.split(',').map(t=>t.trim()).filter(Boolean):[]});c++});uCnt();sv();Q=[];rQ();rAll();toast(c+'ê°œ ë“±ë¡ ì™„ë£Œ! ë‹¤ ëë‚˜ë©´ ğŸ“¦íƒ­ì—ì„œ ë‹¤ìš´ë¡œë“œ')}
function clrQ(){Q=[];rQ()}
// ëª¨ë‹¬
function opM(id){document.getElementById(id).classList.add('show')}
function clM(id){document.getElementById(id).classList.remove('show')}
document.querySelectorAll('.mo').forEach(m=>{m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('show')})});
// ë‚´ë³´ë‚´ê¸°
function gSite(){const cats=D.cat.map(c=>({...c,link:'hub.html?mode=category&id='+c.id}));return JSON.stringify({siteName:"í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ ì •ë³´ë¶€",categories:cats},null,2)}
function gUnits(){return JSON.stringify({_comment:"admin ìë™ìƒì„±",subject:"í†µí•©ì‚¬íšŒ",curriculum:"2022 ê°œì • êµìœ¡ê³¼ì •",units:D.units.map(u=>({slug:u.slug,code:u.code,title:u.title,subtitle:u.subtitle,tags:u.tags,contentCount:u.contentCount,categoryId:u.categoryId}))},null,2)}
function gUnit(s){const u=D.uc[s];if(!u)return null;return JSON.stringify({unit:u.unit,unitSlug:u.unitSlug,achievementStandard:u.achievementStandard,contents:u.contents},null,2)}
function dlF(n,c){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:'application/json'}));a.download=n;a.click();URL.revokeObjectURL(a.href)}
function dl(ms){return new Promise(r=>setTimeout(r,ms))}
async function dlAll(){dlF('site.json',gSite());await dl(200);dlF('units.json',gUnits());for(const u of D.units){await dl(200);const j=gUnit(u.slug);if(j)dlF('unit-'+u.slug+'.json',j)}toast('ì „ì²´ JSON ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!')}
async function impSite(){try{toast('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');try{const r=await fetch('site.json');if(r.ok){const d=await r.json();D.cat=d.categories||[]}}catch(e){}const r2=await fetch('units.json');if(!r2.ok)throw new Error('units.json ì—†ìŒ');const ud=await r2.json();D.units=ud.units||[];for(const u of D.units){try{const r3=await fetch('unit-'+u.slug+'.json');if(r3.ok)D.uc[u.slug]=await r3.json()}catch(e){}}uCnt();sv();rAll();toast('ì™„ë£Œ! '+D.cat.length+'ì¹´í…Œê³ ë¦¬, '+D.units.length+'ë‹¨ì›')}catch(e){toast('ì‹¤íŒ¨: '+e.message,'r')}}
function impF(e){let c=0;Array.from(e.target.files).forEach(f=>{const r=new FileReader();r.onload=function(ev){try{const j=JSON.parse(ev.target.result);if(j.categories){D.cat=j.categories;c++}else if(j.units){D.units=j.units;c++}else if(j.unitSlug){D.uc[j.unitSlug]=j;c++}uCnt();sv();rAll();toast(c+'ê°œ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ')}catch(err){toast('ì‹¤íŒ¨','r')}};r.readAsText(f)});e.target.value=''}
function toast(m,c){const el=document.getElementById('T');el.textContent=m;el.style.background=c==='r'?'var(--rd)':'var(--gr)';el.classList.add('show');setTimeout(()=>el.classList.remove('show'),3000)}
ld();
</script>
</body>
</html>
