
<html lang="ko">
<head>
  <meta charset="utf-8"></meta>
  <meta content="width=device-width,initial-scale=1" name="viewport"></meta>
  <title>ìˆ˜ìš”Â·ê³µê¸‰ ê·¸ë˜í”„ ìƒì„±ê¸° PRO (êµì‚¬ìš©) | PNG ì €ì¥</title>
  <link href="https://fonts.googleapis.com/css2?family=Jua&amp;family=Noto+Sans+KR:wght@300;400;600;700&amp;display=swap" rel="stylesheet"></link>
  <style>
    :root{
      --bg:#0b1220; --panel:#101a33; --card:#0f172a; --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.70);
      --primary:#7dd3fc; --accent:#a78bfa; --ok:#22c55e; --warn:#f59e0b; --danger:#fb7185;
      --chip:rgba(255,255,255,.08);
      --radius:18px;

      --ink:#111827;
      --grid:rgba(17,24,39,.10);
      --gridLight:rgba(17,24,39,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Noto Sans KR",system-ui,Segoe UI,Arial,sans-serif;
      background:radial-gradient(1100px 700px at 20% 10%, rgba(125,211,252,.18), transparent 55%),
                 radial-gradient(900px 600px at 80% 20%, rgba(167,139,250,.16), transparent 60%),
                 var(--bg);
      color:var(--text);
    }
    header{
      padding:18px 18px 10px;
      display:flex; gap:12px; align-items:flex-end; justify-content:space-between;
      border-bottom:1px solid var(--line);
      position:sticky; top:0; background:rgba(11,18,32,.72); backdrop-filter: blur(10px);
      z-index:10;
    }
    .title{display:flex; flex-direction:column; gap:2px;}
    .title h1{margin:0; font-family:"Jua",sans-serif; font-weight:400; letter-spacing:.2px; font-size:22px;}
    .title small{color:var(--muted)}
    .top-actions{display:flex; gap:10px; flex-wrap:wrap}
    button, select, input[type="number"], input[type="text"], input[type="color"]{font:inherit;}

    .btn{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      display:inline-flex; gap:8px; align-items:center; justify-content:center;
      box-shadow:0 10px 26px rgba(0,0,0,.22);
      transition:.15s transform, .15s filter;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.06)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{border-color:rgba(125,211,252,.35); background:linear-gradient(180deg, rgba(125,211,252,.22), rgba(125,211,252,.12));}
    .btn.ok{border-color:rgba(34,197,94,.35); background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.10));}

    .wrap{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:14px;
      padding:14px;
      max-width:1400px;
      margin:0 auto;
    }
    @media (max-width: 1100px){
      .wrap{grid-template-columns:1fr;}
      header{position:relative}
    }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:0 18px 40px rgba(0,0,0,.28);
    }
    .panel h2{
      margin:0 0 10px; font-family:"Jua",sans-serif; font-weight:400;
      font-size:16px; letter-spacing:.2px;
      display:flex; align-items:center; justify-content:space-between;
    }

    .grid{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    label{font-size:12px; color:var(--muted); display:flex; flex-direction:column; gap:6px; width:100%;}
    .field{
      display:flex; align-items:center; gap:8px;
      background:rgba(255,255,255,.05);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px;
      position:relative;
    }
    .field > span{color:var(--muted); font-size:12px; white-space:nowrap}
    input[type="number"], input[type="text"]{
      width:100%;
      border:none; outline:none;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }

    /* âœ… ì…€ë ‰íŠ¸/ì˜µì…˜ ê¸€ì ì•ˆë³´ì„ í•´ê²° */
    .selectWrap{width:100%; position:relative;}
    .selectWrap::after{
      content:"â–¾";
      position:absolute;
      right:12px; top:50%;
      transform:translateY(-50%);
      color:rgba(255,255,255,.75);
      pointer-events:none;
      font-size:12px;
    }
    select{
      width:100%;
      border:none; outline:none;
      background:transparent;
      color:var(--text);
      font-size:14px;
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      padding-right:28px;
    }
    option{background-color:#0f172a; color:rgba(255,255,255,.92);}
    select:focus{outline:2px solid rgba(125,211,252,.35); outline-offset:2px; border-radius:10px;}

    input[type="color"]{width:40px; height:28px; border:none; background:transparent; padding:0; cursor:pointer;}

    .chip{
      display:inline-flex; gap:8px; align-items:center;
      padding:7px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      font-size:12px; color:var(--muted);
    }

    .canvasWrap{display:flex; flex-direction:column; gap:10px;}
    .canvasCard{
      background:#ffffff;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      box-shadow:0 18px 45px rgba(0,0,0,.35);
    }
    .canvasTop{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 12px;
      background:rgba(0,0,0,.68);
      color:#fff;
      font-size:12px;
    }
    .canvasTop .left{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .kbd{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:11px; padding:3px 6px; border-radius:8px;
      background:rgba(255,255,255,.14); border:1px solid rgba(255,255,255,.20)
    }
    canvas{display:block; width:100%; height:auto; background:transparent;}

    .note{color:var(--muted); font-size:12px; line-height:1.45; white-space:pre-line;}
    .divider{height:1px; background:var(--line); margin:10px 0}
    .miniActions{display:flex; gap:10px; flex-wrap:wrap}
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(15,23,42,.92);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      box-shadow:0 20px 55px rgba(0,0,0,.45);
      font-size:13px;
      display:none;
      z-index:999;
      max-width:min(720px, calc(100% - 28px));
      white-space:pre-line;
    }
    .toast.show{display:block}
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(255,255,255,.05);
      font-size:12px; color:var(--muted);
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <h1>ìˆ˜ìš”Â·ê³µê¸‰ ê·¸ë˜í”„ ìƒì„±ê¸° PRO (êµì‚¬ìš©)</h1>
      <small>ì •ë¶€ ê°œì…(ìƒí•œÂ·í•˜í•œÂ·ì„¸ê¸ˆÂ·ë³´ì¡°ê¸ˆ) + ë°°ê²½(í°/íˆ¬ëª…) + ì„  ìƒ‰ìƒ + CS/PS ì‰ì—¬(ë©´ì ) + ì •ì‚¬ê°/ê°€ë¡œ PNG ì €ì¥</small>
    </div>
    <div class="top-actions">
      <button class="btn primary" id="btnRender">ğŸ§  ê³„ì‚°Â·ê·¸ë¦¬ê¸°</button>
      <button class="btn ok" id="btnDownload">ğŸ–¼ï¸ PNG ì €ì¥</button>
      <button class="btn" id="btnReset">â†©ï¸ ê¸°ë³¸ê°’</button>
    </div>
  </header>

  <div class="wrap">
    <section class="panel">
      <h2>â‘  ê³¡ì„ (ì§ì„ ) ì„¤ì • <span class="badge">P = a + bQ</span></h2>

      <div class="grid">
        <label>ìˆ˜ìš”(D) ì‹
          <div class="field">
            <span>a</span><input id="Da" step="0.1" type="number" />
            <span>b</span><input id="Db" step="0.1" type="number" />
          </div>
          <div class="note">ì˜ˆ) D: P = 100 - 2Q â†’ a=100, b=-2</div>
        </label>

        <label>ê³µê¸‰(S) ì‹
          <div class="field">
            <span>a</span><input id="Sa" step="0.1" type="number" />
            <span>b</span><input id="Sb" step="0.1" type="number" />
          </div>
          <div class="note">ì˜ˆ) S: P = 10 + 1Q â†’ a=10, b=1</div>
        </label>

        <label>ì¶• ë²”ìœ„(í‘œì‹œìš©)
          <div class="field">
            <span>Qmax</span><input id="Qmax" step="1" type="number" />
            <span>Pmax</span><input id="Pmax" step="1" type="number" />
          </div>
          <div class="note">ì‹œí—˜ ë¬¸ì œìš©: ë²”ìœ„ ê³ ì •í•˜ë©´ ê·¸ë¦¼ì´ â€œê¹”ë”â€</div>
        </label>

        <label>ëˆˆê¸ˆ(ê²©ì)
          <div class="field">
            <span>Q step</span><input id="Qstep" step="1" type="number" />
            <span>P step</span><input id="Pstep" step="1" type="number" />
          </div>
          <div class="note">ë³´í†µ 5~10 ì¶”ì²œ</div>
        </label>
      </div>

      <div class="divider"></div>

      <h2>â‘¡ ì‹œê° ì„¤ì • <span class="badge">ì‹œí—˜ì§€ ìŠ¤íƒ€ì¼</span></h2>
      <div class="grid">
        <label>ë°°ê²½
          <div class="field"><div class="selectWrap">
            <select id="bgMode">
              <option value="white">í° ë°°ê²½ (ì‹œí—˜ì§€/í”„ë¦°íŠ¸)</option>
              <option value="transparent">íˆ¬ëª… ë°°ê²½ (ë¬¸ì„œ/ìŠ¬ë¼ì´ë“œ í•©ì„±)</option>
            </select>
          </div></div>
        </label>

        <label>í‘œì‹œ ìš”ì†Œ
          <div class="field"><div class="selectWrap">
            <select id="showPack">
              <option value="minimal">ë¯¸ë‹ˆë©€(ì¶•+ê³¡ì„ +ê· í˜•ì )</option>
              <option value="standard">í‘œì¤€(ê²©ì+ë¼ë²¨+ê· í˜•ì„ )</option>
              <option value="exam">ì‹œí—˜ìš©(ê²©ì ìµœì†Œ+ë¼ë²¨ ìµœì†Œ)</option>
            </select>
          </div></div>
        </label>

        <label>ì„  ìƒ‰ìƒ(ìˆ˜ìš”/ê³µê¸‰/ì •ë¶€ì„ )
          <div class="row">
            <span class="chip">D <input id="colD" type="color" /></span>
            <span class="chip">S <input id="colS" type="color" /></span>
            <span class="chip">ì •ë¶€ <input id="colGov" type="color" /></span>
          </div>
        </label>

        <label>ì„  êµµê¸°/ë¼ë²¨
          <div class="field">
            <span>êµµê¸°</span><input id="lineW" step="0.5" type="number" />
            <span>ê¸€ì</span>
            <div class="selectWrap" style="max-width: 110px;">
              <select id="fontSize">
                <option value="12">12</option>
                <option value="13">13</option>
                <option selected="" value="14">14</option>
                <option value="16">16</option>
              </select>
            </div>
          </div>
        </label>
      </div>

      <div class="divider"></div>

      <h2>â‘¢ ì •ë¶€ ê°œì…(ê²½ì œí•™ì  ê²½ìš°) <span class="badge">ìƒí•œÂ·í•˜í•œÂ·ì„¸ê¸ˆÂ·ë³´ì¡°ê¸ˆ</span></h2>

      <label>ê°œì… ì¢…ë¥˜
        <div class="field"><div class="selectWrap">
          <select id="policyType">
            <option value="none">ì—†ìŒ(ììœ ì‹œì¥)</option>
            <option value="ceiling">ê°€ê²© ìƒí•œì œ(Price Ceiling)</option>
            <option value="floor">ê°€ê²© í•˜í•œì œ(Price Floor)</option>
            <option value="tax">ë‹¨ìœ„ë‹¹ ì„¸ê¸ˆ(Per-unit Tax)</option>
            <option value="subsidy">ë‹¨ìœ„ë‹¹ ë³´ì¡°ê¸ˆ(Per-unit Subsidy)</option>
          </select>
        </div></div>
      </label>

      <div class="grid" style="margin-top: 10px;">
        <label id="policyPriceWrap">ì •ë¶€ê°€ê²©(ìƒí•œ/í•˜í•œ)
          <div class="field"><span>P<sub>g</sub></span><input id="policyPrice" step="0.1" type="number" /></div>
          <div class="note">ìƒí•œ: P<sub>g</sub> &lt; P* â†’ ì´ˆê³¼ìˆ˜ìš” / í•˜í•œ: P<sub>g</sub> &gt; P* â†’ ì´ˆê³¼ê³µê¸‰</div>
        </label>

        <label id="policyDeltaWrap">ì„¸ê¸ˆ/ë³´ì¡°ê¸ˆ í¬ê¸°(ë‹¨ìœ„ë‹¹)
          <div class="field"><span>t / s</span><input id="policyDelta" step="0.1" type="number" /></div>
          <div class="note">ì„¸ê¸ˆ: ê³µê¸‰ê³¡ì„  â†‘ / ë³´ì¡°ê¸ˆ: ê³µê¸‰ê³¡ì„  â†“</div>
        </label>

        <label>í‘œì‹œ ì˜µì…˜
          <div class="field"><div class="selectWrap">
            <select id="policyShow">
              <option value="auto">ìë™(ì˜ë¯¸ ìˆì„ ë•Œë§Œ)</option>
              <option value="always">í•­ìƒ í‘œì‹œ</option>
              <option value="off">í‘œì‹œ ì•ˆ í•¨</option>
            </select>
          </div></div>
        </label>

        <label>ì˜ì—­ ìŒì˜/ìˆ˜ì¹˜
          <div class="field"><div class="selectWrap">
            <select id="shadeMode">
              <option value="off">ì—†ìŒ(ì‹œí—˜ ê·¸ë¦¼ìš©)</option>
              <option value="csps">CS/PS(ì‰ì—¬) í‘œì‹œ + ìˆ˜ì¹˜</option>
              <option value="dwltax">ì„¸ìˆ˜/ë³´ì¡°ê¸ˆ ë°´ë“œ(ê°„ë‹¨)</option>
            </select>
          </div></div>
          <div class="note">â€» ì‰ì—¬ ìˆ˜ì¹˜ëŠ” â€œì§ì„ â€ ê¸°ì¤€ ì‚¼ê°í˜• ë©´ì </div>
        </label>
      </div>

      <div class="divider"></div>

      <h2>â‘£ PNG ì €ì¥ ì„¤ì • <span class="badge">ì •ì‚¬ê°/ê°€ë¡œí˜•</span></h2>
      <div class="grid">
        <label>ì €ì¥ ë¹„ìœ¨/í¬ê¸°
          <div class="field"><div class="selectWrap">
            <select id="exportPreset">
              <option value="square_1024">ì •ì‚¬ê° 1024Ã—1024</option>
              <option value="square_1500">ì •ì‚¬ê° 1500Ã—1500</option>
              <option selected="" value="land_1280">ê°€ë¡œí˜• 1280Ã—720</option>
              <option value="land_1600">ê°€ë¡œí˜• 1600Ã—900</option>
              <option value="land_1920">ê°€ë¡œí˜• 1920Ã—1080</option>
            </select>
          </div></div>
        </label>

        <label>íŒŒì¼ëª…(ìë™ ìƒì„± ê°€ëŠ¥)
          <div class="field"><input id="fileName" placeholder="ì˜ˆ: demand_supply_csps" type="text" /></div>
          <div class="note">ë¹„ìš°ë©´ ìë™ ìƒì„±</div>
        </label>
      </div>

      <div class="divider"></div>

      <div class="miniActions">
        <button class="btn" id="btnCopySummary">ğŸ“‹ ê²°ê³¼ ìš”ì•½ ë³µì‚¬</button>
        <button class="btn" id="btnExamHide">ğŸ§ª ì‹œí—˜ìš© ëª¨ë“œ(íŒíŠ¸ ìµœì†Œí™”)</button>
      </div>
    </section>

    <section class="canvasWrap">
      <div class="canvasCard">
        <div class="canvasTop">
          <div class="left">
            <span class="kbd">ë¯¸ë¦¬ë³´ê¸°</span>
            <span class="kbd" id="badgePolicy">ììœ ì‹œì¥</span>
            <span class="kbd" id="badgeEQ">P*=?, Q*=?</span>
            <span class="kbd" id="badgeSurplus">CS=?, PS=?</span>
          </div>
          <div class="right">
            <span class="kbd">ì¶•: P(ê°€ê²©) Â· Q(ìˆ˜ëŸ‰)</span>
          </div>
        </div>
        <canvas height="760" id="preview" width="1100"></canvas>
      </div>

      <div class="panel">
        <h2>ê²°ê³¼(ìë™ ê³„ì‚°)</h2>
        <div class="row" style="gap: 8px; margin-bottom: 8px;">
          <span class="chip" id="outEq">ê· í˜•: P*=?, Q*=?</span>
          <span class="chip" id="outPolicy">ì •ë¶€ê°œì…: -</span>
          <span class="chip" id="outQty">ê±°ë˜ëŸ‰(ê°œì… ì‹œ): -</span>
          <span class="chip" id="outSurplus">ì‰ì—¬: CS=?, PS=?</span>
        </div>
        <div class="note" id="outText">â€œê³„ì‚°Â·ê·¸ë¦¬ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ ê²°ê³¼ê°€ ì •ë¦¬ë©ë‹ˆë‹¤.</div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);
  const toastEl = $("toast");
  const toast = (msg) => {
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=>toastEl.classList.remove("show"), 1800);
  };

  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const isFiniteNum = (x)=>Number.isFinite(x) && !Number.isNaN(x);

  function solveIntersection(a1,b1,a2,b2){
    const denom = (b1 - b2);
    if (Math.abs(denom) < 1e-9) return null;
    const Q = (a2 - a1) / denom;
    const P = a1 + b1*Q;
    return {Q, P};
  }
  function QatP(a,b,P){
    if (Math.abs(b) < 1e-9) return null;
    return (P - a)/b;
  }
  const PatQ = (a,b,Q)=> a + b*Q;

  // âœ… ì‰ì—¬(ì§ì„  ê¸°ì¤€ ì‚¼ê°í˜• ë©´ì )
  // CS = 1/2 * Q* * (P_dIntercept - P*)
  // PS = 1/2 * Q* * (P* - P_sIntercept)
  function calcCSPS(Da,Db,Sa,Sb,Qe,Pe){
    const Pd0 = PatQ(Da,Db,0); // demand intercept at Q=0
    const Ps0 = PatQ(Sa,Sb,0); // supply intercept at Q=0
    const Q = Math.max(0, Qe);
    const CS = 0.5 * Q * Math.max(0, (Pd0 - Pe));
    const PS = 0.5 * Q * Math.max(0, (Pe - Ps0));
    return {CS, PS, Pd0, Ps0};
  }

  const defaults = {
    Da: 100, Db: -2,
    Sa: 10,  Sb:  1,
    Qmax: 60, Pmax: 120,
    Qstep: 10, Pstep: 20,
    bgMode: "white",
    showPack: "standard",
    colD: "#2563eb",
    colS: "#dc2626",
    colGov:"#111827",
    lineW: 3,
    fontSize: 14,
    policyType: "none",
    policyPrice: 60,
    policyDelta: 15,
    policyShow: "auto",
    shadeMode: "off",
    exportPreset: "land_1280",
    fileName: ""
  };

  const inputs = {
    Da:$("Da"), Db:$("Db"), Sa:$("Sa"), Sb:$("Sb"),
    Qmax:$("Qmax"), Pmax:$("Pmax"), Qstep:$("Qstep"), Pstep:$("Pstep"),
    bgMode:$("bgMode"), showPack:$("showPack"),
    colD:$("colD"), colS:$("colS"), colGov:$("colGov"),
    lineW:$("lineW"), fontSize:$("fontSize"),
    policyType:$("policyType"), policyPrice:$("policyPrice"), policyDelta:$("policyDelta"),
    policyShow:$("policyShow"), shadeMode:$("shadeMode"),
    exportPreset:$("exportPreset"), fileName:$("fileName")
  };

  function setDefaults(){
    for (const k in defaults){
      if (!inputs[k]) continue;
      inputs[k].value = defaults[k];
    }
    policyUI();
  }

  function policyUI(){
    const t = inputs.policyType.value;
    $("policyPriceWrap").style.display = (t==="ceiling" || t==="floor") ? "" : "none";
    $("policyDeltaWrap").style.display = (t==="tax" || t==="subsidy") ? "" : "none";
  }

  inputs.policyType.addEventListener("change", ()=>{policyUI(); render();});
  inputs.bgMode.addEventListener("change", ()=>{render();});
  inputs.showPack.addEventListener("change", ()=>{render();});

  [
    "Da","Db","Sa","Sb","Qmax","Pmax","Qstep","Pstep",
    "colD","colS","colGov","lineW","fontSize",
    "policyPrice","policyDelta","policyShow","shadeMode"
  ].forEach(id=>{
    $(id).addEventListener("input", ()=>render());
  });

  const canvas = $("preview");
  const ctx = canvas.getContext("2d");

  function drawAll(targetCtx, W, H, opts){
    const {
      bgMode, showPack, fontSize, lineW,
      colD, colS, colGov,
      Qmax, Pmax, Qstep, Pstep,
      Da, Db, Sa, Sb,
      policyType, policyPrice, policyDelta,
      policyShow, shadeMode
    } = opts;

    const pad = Math.round(Math.min(W,H)*0.10);
    const left = pad, top = pad, right = W - pad, bottom = H - pad;
    const plotW = right - left, plotH = bottom - top;

    const x = (Q)=> left + (Q / Qmax) * plotW;
    const y = (P)=> bottom - (P / Pmax) * plotH;

    targetCtx.clearRect(0,0,W,H);
    if (bgMode === "white"){
      targetCtx.save();
      targetCtx.fillStyle = "#ffffff";
      targetCtx.fillRect(0,0,W,H);
      targetCtx.restore();
    }

    const fs = parseInt(fontSize,10);
    const ink = getComputedStyle(document.documentElement).getPropertyValue("--ink").trim() || "#111827";
    const grid = getComputedStyle(document.documentElement).getPropertyValue("--grid").trim() || "rgba(17,24,39,.10)";
    const gridLight = getComputedStyle(document.documentElement).getPropertyValue("--gridLight").trim() || "rgba(17,24,39,.06)";

    const pack = showPack;
    const showGrid = (pack==="standard");
    const showFewGrid = (pack==="exam");
    const showLabels = (pack!=="exam");
    const showEqGuides = (pack==="standard");

    const drawGrid = () => {
      targetCtx.save();
      targetCtx.strokeStyle = grid;
      targetCtx.lineWidth = 1;
      for (let q=0; q<=Qmax+1e-9; q+=Qstep){
        const xx = x(q);
        targetCtx.beginPath(); targetCtx.moveTo(xx, top); targetCtx.lineTo(xx, bottom); targetCtx.stroke();
      }
      for (let p=0; p<=Pmax+1e-9; p+=Pstep){
        const yy = y(p);
        targetCtx.beginPath(); targetCtx.moveTo(left, yy); targetCtx.lineTo(right, yy); targetCtx.stroke();
      }
      targetCtx.restore();
    };

    const drawFewGrid = () => {
      targetCtx.save();
      targetCtx.strokeStyle = gridLight;
      targetCtx.lineWidth = 1;
      const qs = [0, Math.round(Qmax/2), Qmax].filter((v,i,a)=>a.indexOf(v)===i);
      const ps = [0, Math.round(Pmax/2), Pmax].filter((v,i,a)=>a.indexOf(v)===i);
      qs.forEach(q=>{
        const xx = x(q);
        targetCtx.beginPath(); targetCtx.moveTo(xx, top); targetCtx.lineTo(xx, bottom); targetCtx.stroke();
      });
      ps.forEach(p=>{
        const yy = y(p);
        targetCtx.beginPath(); targetCtx.moveTo(left, yy); targetCtx.lineTo(right, yy); targetCtx.stroke();
      });
      targetCtx.restore();
    };

    if (showGrid) drawGrid();
    else if (showFewGrid) drawFewGrid();

    // axes
    targetCtx.save();
    targetCtx.strokeStyle = ink;
    targetCtx.lineWidth = 2;
    targetCtx.beginPath();
    targetCtx.moveTo(left, top);
    targetCtx.lineTo(left, bottom);
    targetCtx.lineTo(right, bottom);
    targetCtx.stroke();
    targetCtx.restore();

    // axis labels
    targetCtx.save();
    targetCtx.fillStyle = ink;
    targetCtx.font = `${fs+1}px "Noto Sans KR", sans-serif`;
    targetCtx.fillText("P(ê°€ê²©)", left - 6, top - 12);
    targetCtx.fillText("Q(ìˆ˜ëŸ‰)", right - 52, bottom + 28);
    targetCtx.restore();

    // ticks
    const drawTicks = () => {
      targetCtx.save();
      targetCtx.fillStyle = "rgba(17,24,39,.75)";
      targetCtx.font = `${fs-1}px "Noto Sans KR", sans-serif`;
      for (let q=0; q<=Qmax+1e-9; q+=Qstep){
        const xx = x(q);
        targetCtx.beginPath(); targetCtx.moveTo(xx, bottom); targetCtx.lineTo(xx, bottom+6);
        targetCtx.strokeStyle = "rgba(17,24,39,.65)";
        targetCtx.lineWidth = 1.5;
        targetCtx.stroke();
        if (showLabels){
          const s = String(q);
          targetCtx.fillText(s, xx - (s.length*3), bottom + 22);
        }
      }
      for (let p=0; p<=Pmax+1e-9; p+=Pstep){
        const yy = y(p);
        targetCtx.beginPath(); targetCtx.moveTo(left-6, yy); targetCtx.lineTo(left, yy);
        targetCtx.strokeStyle = "rgba(17,24,39,.65)";
        targetCtx.lineWidth = 1.5;
        targetCtx.stroke();
        if (showLabels){
          const s = String(p);
          targetCtx.fillText(s, left - 28 - (s.length-1)*3, yy + 4);
        }
      }
      targetCtx.restore();
    };
    if (pack!=="minimal") drawTicks();

    const eq0 = solveIntersection(Da,Db,Sa,Sb);

    let effectiveSa = Sa, effectiveSb = Sb;
    let eq1 = eq0;
    let policyInfo = {type:policyType, binding:false, Qtrade:null, Ptrade:null, shortage:null, surplus:null, taxRevenue:null};

    if (policyType==="tax"){
      effectiveSa = Sa + policyDelta;
      eq1 = solveIntersection(Da,Db,effectiveSa,Sb);
      policyInfo.taxRevenue = (eq1 && isFiniteNum(eq1.Q)) ? Math.max(0, eq1.Q) * policyDelta : null;
    } else if (policyType==="subsidy"){
      effectiveSa = Sa - policyDelta;
      eq1 = solveIntersection(Da,Db,effectiveSa,Sb);
    }

    if ((policyType==="ceiling" || policyType==="floor") && eq0){
      const Pg = policyPrice;
      if (policyType==="ceiling"){
        policyInfo.binding = (Pg < eq0.P);
        if (policyInfo.binding){
          const Qd = QatP(Da,Db,Pg);
          const Qs = QatP(Sa,Sb,Pg);
          if (isFiniteNum(Qd) && isFiniteNum(Qs)){
            policyInfo.shortage = Math.max(0, Qd - Qs);
            policyInfo.Qtrade = Math.max(0, Math.min(Qd, Qs));
            policyInfo.Ptrade = Pg;
          }
        }
      } else {
        policyInfo.binding = (Pg > eq0.P);
        if (policyInfo.binding){
          const Qd = QatP(Da,Db,Pg);
          const Qs = QatP(Sa,Sb,Pg);
          if (isFiniteNum(Qd) && isFiniteNum(Qs)){
            policyInfo.surplus = Math.max(0, Qs - Qd);
            policyInfo.Qtrade = Math.max(0, Math.min(Qd, Qs));
            policyInfo.Ptrade = Pg;
          }
        }
      }
    }

    function drawLine(a,b,color,label){
      const P0 = PatQ(a,b,0);
      const P1 = PatQ(a,b,Qmax);
      targetCtx.save();
      targetCtx.strokeStyle = color;
      targetCtx.lineWidth = lineW;
      targetCtx.lineCap="round"; targetCtx.lineJoin="round";
      targetCtx.beginPath();
      targetCtx.moveTo(x(0), y(P0));
      targetCtx.lineTo(x(Qmax), y(P1));
      targetCtx.stroke();
      if (pack!=="exam"){
        const qLab = Qmax*0.72;
        const pLab = PatQ(a,b,qLab);
        targetCtx.fillStyle = color;
        targetCtx.font = `${fs}px "Noto Sans KR", sans-serif`;
        targetCtx.fillText(label, x(qLab)+8, y(pLab)-8);
      }
      targetCtx.restore();
    }

    drawLine(Da,Db,colD,"D");

    if (policyType==="tax" || policyType==="subsidy"){
      const show = (policyShow==="always") || (policyShow==="auto");
      if (show){
        targetCtx.save();
        targetCtx.globalAlpha = 0.35;
        targetCtx.setLineDash([6,6]);
        drawLine(Sa,Sb,colS,"S(ì›)");
        targetCtx.restore();
      }
      drawLine(effectiveSa,Sb,colS,"S");
    } else {
      drawLine(Sa,Sb,colS,"S");
    }

    const eq = (policyType==="tax" || policyType==="subsidy") ? eq1 : eq0;
    const inPlot = (Q,P)=> isFiniteNum(Q)&&isFiniteNum(P) && Q>=-1e-6 && Q<=Qmax+1e-6 && P>=-1e-6 && P<=Pmax+1e-6;

    function drawPoint(Q,P,label){
      targetCtx.save();
      targetCtx.fillStyle = ink;
      const r = Math.max(4, Math.round(lineW*1.2));
      targetCtx.beginPath();
      targetCtx.arc(x(Q), y(P), r, 0, Math.PI*2);
      targetCtx.fill();
      targetCtx.restore();

      if (pack!=="exam"){
        targetCtx.save();
        targetCtx.fillStyle = ink;
        targetCtx.font = `${fs}px "Noto Sans KR", sans-serif`;
        targetCtx.fillText(label, x(Q)+10, y(P)-10);
        targetCtx.restore();
      }
    }

    if (eq && inPlot(eq.Q, eq.P)){
      drawPoint(eq.Q, eq.P, "E");
      if (showEqGuides){
        targetCtx.save();
        targetCtx.strokeStyle = "rgba(17,24,39,.35)";
        targetCtx.lineWidth = 1.5;
        targetCtx.setLineDash([4,4]);
        targetCtx.beginPath(); targetCtx.moveTo(x(eq.Q), bottom); targetCtx.lineTo(x(eq.Q), y(eq.P)); targetCtx.stroke();
        targetCtx.beginPath(); targetCtx.moveTo(left, y(eq.P)); targetCtx.lineTo(x(eq.Q), y(eq.P)); targetCtx.stroke();
        targetCtx.restore();
      }
    }

    const shouldShowGovLine = (() => {
      if (policyType!=="ceiling" && policyType!=="floor") return false;
      if (policyShow==="off") return false;
      if (policyShow==="always") return true;
      return policyInfo.binding;
    })();

    if (shouldShowGovLine){
      targetCtx.save();
      targetCtx.strokeStyle = colGov;
      targetCtx.lineWidth = 2;
      targetCtx.setLineDash([10,6]);
      const Pg = policyPrice;
      targetCtx.beginPath();
      targetCtx.moveTo(left, y(Pg));
      targetCtx.lineTo(right, y(Pg));
      targetCtx.stroke();
      targetCtx.setLineDash([]);
      if (pack!=="exam"){
        targetCtx.fillStyle = colGov;
        targetCtx.fillText(policyType==="ceiling" ? "Pá¶œ" : "Pá¶ ", right-36, y(Pg)-6);
      }
      targetCtx.restore();
    }

    // âœ… ì‰ì—¬ ê³„ì‚° & ìŒì˜(ì„ íƒ)
    let CS=null, PS=null, Pd0=null, Ps0=null;
    if (eq && isFiniteNum(eq.Q) && isFiniteNum(eq.P)){
      const sur = calcCSPS(Da,Db,effectiveSa,effectiveSb,eq.Q,eq.P);
      CS = sur.CS; PS = sur.PS; Pd0=sur.Pd0; Ps0=sur.Ps0;

      function fillPoly(points, alpha, color){
        targetCtx.save();
        targetCtx.globalAlpha = alpha;
        targetCtx.fillStyle = color;
        targetCtx.beginPath();
        points.forEach((pt,i)=>{
          const [Q,P] = pt;
          if (i===0) targetCtx.moveTo(x(Q), y(P));
          else targetCtx.lineTo(x(Q), y(P));
        });
        targetCtx.closePath();
        targetCtx.fill();
        targetCtx.restore();
      }

      if (shadeMode==="csps" && inPlot(eq.Q, eq.P)){
        const Qe = clamp(eq.Q, 0, Qmax);
        const Pe = clamp(eq.P, 0, Pmax);
        const Pd0c = clamp(Pd0, 0, Pmax);
        const Ps0c = clamp(Ps0, 0, Pmax);

        // CS triangle: (0,Pd0) - (Qe,Pe) - (0,Pe)
        fillPoly([[0,Pd0c],[Qe,Pe],[0,Pe]], 0.12, "#60a5fa");
        // PS triangle: (0,Ps0) - (Qe,Pe) - (0,Pe)
        fillPoly([[0,Ps0c],[Qe,Pe],[0,Pe]], 0.12, "#fb7185");

        if (pack!=="exam"){
          targetCtx.save();
          targetCtx.fillStyle = "rgba(17,24,39,.70)";
          targetCtx.font = `${fs}px "Noto Sans KR", sans-serif`;
          targetCtx.fillText("CS", x(Qe*0.30), y((Pd0c+Pe)/2));
          targetCtx.fillText("PS", x(Qe*0.30), y((Ps0c+Pe)/2));
          targetCtx.restore();
        }
      }
    }

    if (pack==="standard"){
      targetCtx.save();
      targetCtx.fillStyle = "rgba(17,24,39,.85)";
      targetCtx.font = `${fs+2}px "Noto Sans KR", sans-serif`;
      targetCtx.fillText("ìˆ˜ìš”Â·ê³µê¸‰", left, top - 34);
      targetCtx.restore();
    }

    return {eq0, eq1, effectiveSa, effectiveSb, policyInfo, eqActive:eq, CS, PS};
  }

  function getOpts(){
    const toN = (el)=> Number(el.value);
    const opts = {
      Da: toN(inputs.Da), Db: toN(inputs.Db),
      Sa: toN(inputs.Sa), Sb: toN(inputs.Sb),
      Qmax: toN(inputs.Qmax), Pmax: toN(inputs.Pmax),
      Qstep: toN(inputs.Qstep), Pstep: toN(inputs.Pstep),
      bgMode: inputs.bgMode.value,
      showPack: inputs.showPack.value,
      colD: inputs.colD.value,
      colS: inputs.colS.value,
      colGov: inputs.colGov.value,
      lineW: toN(inputs.lineW),
      fontSize: inputs.fontSize.value,
      policyType: inputs.policyType.value,
      policyPrice: toN(inputs.policyPrice),
      policyDelta: toN(inputs.policyDelta),
      policyShow: inputs.policyShow.value,
      shadeMode: inputs.shadeMode.value
    };
    if (!isFiniteNum(opts.Qmax) || opts.Qmax<=0) opts.Qmax = 50;
    if (!isFiniteNum(opts.Pmax) || opts.Pmax<=0) opts.Pmax = 100;
    if (!isFiniteNum(opts.Qstep) || opts.Qstep<=0) opts.Qstep = Math.max(5, Math.round(opts.Qmax/5));
    if (!isFiniteNum(opts.Pstep) || opts.Pstep<=0) opts.Pstep = Math.max(5, Math.round(opts.Pmax/5));
    if (!isFiniteNum(opts.lineW) || opts.lineW<=0) opts.lineW = 3;
    return opts;
  }

  function fmt(n){
    if (!isFiniteNum(n)) return "?";
    const a = Math.abs(n);
    if (a>=1000) return n.toFixed(0);
    if (a>=100) return n.toFixed(1);
    if (a>=10) return n.toFixed(2);
    return n.toFixed(2);
  }

  function updateOutputs(drawRes, opts){
    const {eq0, eq1, policyInfo, eqActive, CS, PS} = drawRes;

    const typeLabel = {
      none:"ììœ ì‹œì¥", ceiling:"ê°€ê²© ìƒí•œì œ", floor:"ê°€ê²© í•˜í•œì œ", tax:"ë‹¨ìœ„ë‹¹ ì„¸ê¸ˆ", subsidy:"ë‹¨ìœ„ë‹¹ ë³´ì¡°ê¸ˆ"
    }[opts.policyType] || "ììœ ì‹œì¥";
    $("badgePolicy").textContent = typeLabel;

    const eqShow = eqActive;
    const eqText = (eqShow && isFiniteNum(eqShow.P) && isFiniteNum(eqShow.Q))
      ? `P*=${fmt(eqShow.P)}, Q*=${fmt(eqShow.Q)}`
      : `P*=?, Q*=?`;
    $("badgeEQ").textContent = eqText;
    $("outEq").textContent = `ê· í˜•: ${eqText}`;

    // ì‰ì—¬
    const cspsText = (opts.shadeMode==="csps" && isFiniteNum(CS) && isFiniteNum(PS))
      ? `CS=${fmt(CS)}, PS=${fmt(PS)}`
      : `CS=?, PS=?`;
    $("badgeSurplus").textContent = cspsText;
    $("outSurplus").textContent = `ì‰ì—¬: ${cspsText}`;

    let policyText = "ì •ë¶€ê°œì…: ì—†ìŒ";
    let tradeText = "ê±°ë˜ëŸ‰(ê°œì… ì‹œ): -";

    if (opts.policyType==="ceiling" || opts.policyType==="floor"){
      const Pg = opts.policyPrice;
      if (!eq0){
        policyText = `${typeLabel}: êµì  ì—†ìŒ(í‰í–‰)`;
      } else {
        const bind = policyInfo.binding;
        policyText = `${typeLabel}: P_g=${fmt(Pg)} (${bind ? "êµ¬ì†" : "ë¹„êµ¬ì†"})`;
      }
    }

    if (opts.policyType==="tax" || opts.policyType==="subsidy"){
      const d = opts.policyDelta;
      const eq = eq1;
      policyText = `${typeLabel}: ${opts.policyType==="tax" ? "t" : "s"}=${fmt(d)}`;
      if (eq && isFiniteNum(eq.Q) && isFiniteNum(eq.P)){
        tradeText = `ìƒˆ ê· í˜•: P=${fmt(eq.P)}, Q=${fmt(eq.Q)}`;
      }
      if (opts.policyType==="tax" && isFiniteNum(policyInfo.taxRevenue)){
        tradeText += ` Â· ì„¸ìˆ˜â‰ˆ${fmt(policyInfo.taxRevenue)}`;
      }
    }

    $("outPolicy").textContent = policyText;
    $("outQty").textContent = tradeText;

    $("outText").textContent =
`â€¢ ì‰ì—¬(CS/PS) ìˆ˜ì¹˜ëŠ” â€œì§ì„  ìˆ˜ìš”Â·ê³µê¸‰â€ ê¸°ì¤€ ì‚¼ê°í˜• ë©´ì ì…ë‹ˆë‹¤.
â€¢ ì‹œí—˜ ê·¸ë¦¼ì´ë©´: í‘œì‹œ ìš”ì†Œ=ì‹œí—˜ìš© + ì˜ì—­ ìŒì˜=ì—†ìŒ(íŒíŠ¸ ìµœì†Œí™”) ì¶”ì²œ.
â€¢ ìˆ˜ì—… ì„¤ëª…ì´ë©´: ì˜ì—­ ìŒì˜=CS/PSë¡œ ë°”ê¾¸ë©´ ì‹œê°ì ìœ¼ë¡œ ë°”ë¡œ ì¡í™ë‹ˆë‹¤.`;

    const summary = [
      `D: P = ${fmt(opts.Da)} + (${fmt(opts.Db)})Q`,
      `S: P = ${fmt(opts.Sa)} + (${fmt(opts.Sb)})Q`,
      `ë²”ìœ„: Qmax=${fmt(opts.Qmax)}, Pmax=${fmt(opts.Pmax)}`,
      `ê· í˜•: ${eqText}`,
      policyText,
      tradeText,
      (opts.shadeMode==="csps" ? `ì‰ì—¬: ${cspsText}` : `ì‰ì—¬: (í‘œì‹œ ì•ˆ í•¨)`)
    ].join("\n");
    $("btnCopySummary").dataset.summary = summary;
  }

  function render(){
    const opts = getOpts();
    const res = drawAll(ctx, canvas.width, canvas.height, opts);
    updateOutputs(res, opts);
  }

  function parsePreset(p){
    const [shape,size] = p.split("_");
    if (shape==="square"){
      const s = parseInt(size,10);
      return {w:s, h:s, label:`${s}x${s}`};
    }
    if (shape==="land"){
      const w = parseInt(size,10);
      const map = {1280:720, 1600:900, 1920:1080};
      const h = map[w] || Math.round(w*9/16);
      return {w, h, label:`${w}x${h}`};
    }
    return {w:1280, h:720, label:"1280x720"};
  }

  function buildFileName(opts){
    const base = inputs.fileName.value.trim();
    if (base) return base.replace(/[\\/:*?"<>|]/g,"-");
    const t = opts.policyType;
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `ìˆ˜ìš”ê³µê¸‰_${t}_${yyyy}-${mm}-${dd}`;
  }

  function downloadPNG(){
    const opts = getOpts();
    const {w,h,label} = parsePreset(inputs.exportPreset.value);

    const off = document.createElement("canvas");
    off.width = w; off.height = h;
    const octx = off.getContext("2d");

    drawAll(octx, w, h, opts);

    const url = off.toDataURL("image/png");
    const a = document.createElement("a");
    a.href = url;
    a.download = buildFileName(opts) + `_${label}` + (opts.bgMode==="transparent" ? "_íˆ¬ëª…" : "_í°ë°°ê²½") + ".png";
    document.body.appendChild(a);
    a.click();
    a.remove();

    toast(`PNG ì €ì¥ ì™„ë£Œ\n${a.download}`);
  }

  $("btnRender").addEventListener("click", ()=>{ render(); toast("ê³„ì‚°Â·ê·¸ë¦¬ê¸° ì™„ë£Œ"); });
  $("btnDownload").addEventListener("click", ()=>{
    const opts = getOpts();
    if (Math.abs(opts.Db - opts.Sb) < 1e-9){
      toast("âš ï¸ Dì™€ Sê°€ í‰í–‰ì¼ ìˆ˜ ìˆì–´ìš”(êµì  ì—†ìŒ).\nê·¸ë˜ë„ ì €ì¥ì€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }
    downloadPNG();
  });
  $("btnReset").addEventListener("click", ()=>{ setDefaults(); render(); toast("ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”"); });

  $("btnCopySummary").addEventListener("click", async ()=>{
    const txt = $("btnCopySummary").dataset.summary || "";
    if (!txt){ toast("ìš”ì•½ì´ ì•„ì§ ì—†ì–´ìš”. ë¨¼ì € ê·¸ë ¤ì£¼ì„¸ìš”."); return; }
    try{
      await navigator.clipboard.writeText(txt);
      toast("ê²°ê³¼ ìš”ì•½ ë³µì‚¬ë¨");
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = txt; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy"); ta.remove();
      toast("ê²°ê³¼ ìš”ì•½ ë³µì‚¬ë¨");
    }
  });

  $("btnExamHide").addEventListener("click", ()=>{
    $("showPack").value = "exam";
    $("shadeMode").value = "off";
    $("policyShow").value = "off";
    render();
    toast("ì‹œí—˜ìš© ëª¨ë“œ ì ìš©(íŒíŠ¸ ìµœì†Œí™”)");
  });

  window.addEventListener("keydown", (e)=>{
    const isMac = navigator.platform.toUpperCase().includes("MAC");
    if ((isMac ? e.metaKey : e.ctrlKey) && e.key.toLowerCase()==="s"){
      e.preventDefault();
      downloadPNG();
    }
  });

  setDefaults();
  render();
})();
</script>
</body>
</html>
<button id="btnOpenGuide" style="
  position: fixed; bottom: 20px; right: 20px;
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: white; border: 1px solid rgba(255,255,255,0.2);
  padding: 12px 20px; border-radius: 30px;
  font-family: 'Jua', sans-serif; font-size: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.5);
  cursor: pointer; z-index: 2000;
  display: flex; align-items: center; gap: 8px;
  transition: transform 0.2s, filter 0.2s;
">
  ğŸ“˜ ê°€ì´ë“œ & ì œì‘ ë™ê¸°
</button>

<div id="guideModal" style="
  display: none; opacity: 0; transition: opacity 0.3s ease;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
  z-index: 3000; align-items: center; justify-content: center;
  padding: 20px;
">
  <div style="
    background: #1e293b; border: 1px solid rgba(255,255,255,0.1);
    width: 100%; max-width: 800px; max-height: 90vh;
    border-radius: 20px; box-shadow: 0 25px 60px rgba(0,0,0,0.6);
    display: flex; flex-direction: column; overflow: hidden;
    transform: translateY(20px); transition: transform 0.3s ease;
    animation: slideUp 0.3s forwards;
  ">
    <div style="
      padding: 20px 24px; border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(255,255,255,0.03);
    ">
      <h2 style="margin:0; font-family:'Jua'; color:white; font-size:20px;">
        ğŸ“ ì œì‘ ë™ê¸° ë° êµìœ¡ì  í™œìš© ê°€ì´ë“œ
      </h2>
      <button id="btnCloseGuide" style="
        background: transparent; border: none; color: rgba(255,255,255,0.6);
        font-size: 24px; cursor: pointer; line-height: 1;
      ">Ã—</button>
    </div>

    <div style="
      padding: 24px; overflow-y: auto; color: rgba(255,255,255,0.9);
      font-size: 15px; line-height: 1.7; font-weight: 300;
    ">
      
      <h3 style="color:#7dd3fc; font-family:'Jua'; margin-top:0;">1. ì œì‘ ë™ê¸°: "ë³´ì´ì§€ ì•ŠëŠ” ì†ì„ ë³´ì´ê²Œ ë§Œë“¤ê¸°"</h3>
      <p>
        ê²½ì œí•™ ìˆ˜ì—… í˜„ì¥ì—ì„œ êµì‚¬ë“¤ì´ ê²ªëŠ” ê°€ì¥ í° ì–´ë ¤ì›€ ì¤‘ í•˜ë‚˜ëŠ” 'ì •í™•í•œ ê·¸ë˜í”„'ì˜ ë¶€ì¬ì…ë‹ˆë‹¤. ì¹ íŒì— ì†ìœ¼ë¡œ ê·¸ë¦° ê·¸ë˜í”„ëŠ” ê³¡ì„ ì˜ ê¸°ìš¸ê¸°ë‚˜ êµì°¨ì ì´ ë¶€ì •í™•í•˜ì—¬, í•™ìƒë“¤ì´ <strong>'ìˆ˜í•™ì  ê· í˜•'</strong>ê³¼ <strong>'ê²½ì œì  ì§ê´€'</strong>ì„ ì—°ê²°í•˜ëŠ” ë° ë°©í•´ê°€ ë˜ê³¤ í•©ë‹ˆë‹¤. ë˜í•œ, ì‹œì¤‘ì˜ êµê³¼ì„œë‚˜ ë¬¸ì œì§‘ì˜ ê·¸ë¦¼ì€ ê³ ì •ë˜ì–´ ìˆì–´, "ìˆ˜ìš”ê°€ ì¦ê°€í•˜ë©´?", "ì„¸ê¸ˆì´ ë¶€ê³¼ë˜ë©´?"ê³¼ ê°™ì€ ë™ì ì¸ ë³€í™”(Comparative Statics)ë¥¼ ì¦‰ê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° ì–´ë µìŠµë‹ˆë‹¤.
      </p>
      <p>
        ì´ <strong>[ìˆ˜ìš”Â·ê³µê¸‰ ê·¸ë˜í”„ ìƒì„±ê¸° PRO]</strong>ëŠ” ì´ëŸ¬í•œ ê°ˆì¦ì„ í•´ì†Œí•˜ê¸° ìœ„í•´ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ë“¤ê»˜ì„œëŠ” ë³µì¡í•œ ë“œë¡œì‰ íˆ´ ì—†ì´ë„ ìˆ˜ì‹ë§Œ ì…ë ¥í•˜ë©´ 1ì´ˆ ë§Œì— ë…¼ë¬¸ê¸‰ í’ˆì§ˆì˜ ë²¡í„° ê·¸ë˜í”„ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ <strong>ì‹œí—˜ ì¶œì œìš©(í° ë°°ê²½, íŒíŠ¸ ì œê±°)</strong>ê³¼ <strong>ìˆ˜ì—… ì„¤ëª…ìš©(ì–´ë‘ìš´ ë°°ê²½, ì‰ì—¬ í‘œì‹œ)</strong>ì„ ììœ ë¡­ê²Œ ì˜¤ê°ˆ ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ì—¬, êµë¬´ì‹¤ê³¼ êµì‹¤ ì–‘ìª½ì—ì„œ ì‹¤ì§ˆì ì¸ ë„ì›€ì´ ë˜ê³ ì í•©ë‹ˆë‹¤.
      </p>

      <div style="height:1px; background:rgba(255,255,255,0.1); margin: 20px 0;"></div>

      <h3 style="color:#a78bfa; font-family:'Jua';">2. ì‚¬ìš© ë°©ë²•: 3ë‹¨ê³„ ë§ˆìŠ¤í„°</h3>
      <ul style="padding-left: 20px; margin-bottom: 0;">
        <li><strong>STEP 1. ìˆ˜ì‹ ì„¤ì • (ëª¨ë¸ë§)</strong>
          <br>ê°€ì¥ ë¨¼ì € ìˆ˜ìš”(D)ì™€ ê³µê¸‰(S)ì˜ ì ˆí¸(a)ê³¼ ê¸°ìš¸ê¸°(b)ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. ì‹œì¥ì˜ ìƒí™©ì„ ìˆ˜ì‹ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì¶• ë²”ìœ„(Qmax, Pmax)ë¥¼ ê³ ì •í•˜ë©´ ì—¬ëŸ¬ ê·¸ë˜í”„ë¥¼ ë¹„êµí•  ë•Œ ìŠ¤ì¼€ì¼ì´ ë‹¬ë¼ì§€ëŠ” í˜¼ë€ì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </li>
        <li style="margin-top:10px;"><strong>STEP 2. ì‹œê°í™” ì˜µì…˜ (ìŠ¤íƒ€ì¼ë§)</strong>
          <br>'ë°°ê²½'ì„ [íˆ¬ëª…]ìœ¼ë¡œ ì„¤ì •í•˜ë©´ PPTë‚˜ í•™ìŠµì§€ ìœ„ì— ìì—°ìŠ¤ëŸ½ê²Œ í•©ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹œí—˜ ë¬¸ì œë¥¼ ì¶œì œí•  ë•ŒëŠ” <strong>[ğŸ§ª ì‹œí—˜ìš© ëª¨ë“œ]</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”. ë¶ˆí•„ìš”í•œ ë¼ë²¨ê³¼ íŒíŠ¸ê°€ ì‚¬ë¼ì§€ê³  ë¬¸ì œ í’€ì´ì— í•„ìš”í•œ í•µì‹¬ ì„ ë§Œ ë‚¨ìŠµë‹ˆë‹¤.
        </li>
        <li style="margin-top:10px;"><strong>STEP 3. ì •ì±… ì‹œë®¬ë ˆì´ì…˜ (ì‹¬í™” í•™ìŠµ)</strong>
          <br>ë‹¨ìˆœ ê· í˜•ì„ ë„˜ì–´ ì •ë¶€ì˜ ê°œì…ì„ ì‹¤í—˜í•©ë‹ˆë‹¤. 'ê°€ê²© ìƒí•œì œ'ë‚˜ 'ë‹¨ìœ„ë‹¹ ì„¸ê¸ˆ'ì„ ì„ íƒí•˜ë©´ ê·¸ë˜í”„ê°€ ìë™ìœ¼ë¡œ ë³€í˜•ë˜ë©°, <strong>ìì¤‘ì†ì‹¤(Deadweight Loss)</strong>ê³¼ <strong>ì„¸ìˆ˜</strong>ì˜ ë³€í™”ë¥¼ ëˆˆìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </li>
      </ul>

      <div style="height:1px; background:rgba(255,255,255,0.1); margin: 20px 0;"></div>

      <h3 style="color:#34d399; font-family:'Jua';">3. í•™ìƒì„ ìœ„í•œ êµìœ¡ì  ë°©í–¥ (Guidance)</h3>
      <p>
        ì´ ë„êµ¬ë¥¼ í™œìš©í•  ë•Œ í•™ìƒë“¤ì—ê²Œ ê°•ì¡°í•´ì•¼ í•  í•µì‹¬ì€ <strong>"ê·¸ë˜í”„ëŠ” ë‹¨ìˆœí•œ ê·¸ë¦¼ì´ ì•„ë‹ˆë¼, ìˆ˜ì‹ì˜ ì‹œê°ì  ì–¸ì–´"</strong>ë¼ëŠ” ì ì…ë‹ˆë‹¤.
      </p>
      <ul style="padding-left: 20px;">
        <li><strong>ì§ê´€ê³¼ ë…¼ë¦¬ì˜ ê²°í•©:</strong> í•™ìƒë“¤ì´ "ìˆ˜ìš”ê°€ ëŠ˜ë©´ ê°€ê²©ì´ ì˜¤ë¥¸ë‹¤"ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì•Œë”ë¼ë„, ê·¸ë˜í”„ìƒì—ì„œ ê³¡ì„ ì´ ìš°ì¸¡ìœ¼ë¡œ ì´ë™í•˜ì—¬ ìƒˆë¡œìš´ êµì ì„ í˜•ì„±í•˜ëŠ” ê³¼ì •ì„ ë…¼ë¦¬ì ìœ¼ë¡œ ì¶”ì í•˜ê²Œ í•˜ì‹­ì‹œì˜¤.</li>
        <li><strong>ì‰ì—¬(Surplus)ì˜ ì¬ë°œê²¬:</strong> [ì˜ì—­ ìŒì˜] ê¸°ëŠ¥ì„ ì¼œê³  ì†Œë¹„ì ì‰ì—¬(CS)ì™€ ìƒì‚°ì ì‰ì—¬(PS)ê°€ ì‚¼ê°í˜•ì˜ ë©´ì ìœ¼ë¡œ ê³„ì‚°ë¨ì„ ë³´ì—¬ì£¼ì‹­ì‹œì˜¤. ì´ëŠ” ì ë¶„ ê°œë…ì˜ ê¸°ì´ˆì´ì, ì‹œì¥ íš¨ìœ¨ì„±ì„ ì •ëŸ‰ì ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ì²«ê±¸ìŒì…ë‹ˆë‹¤.</li>
        <li><strong>ì •ì±…ì˜ ì–‘ë©´ì„± íƒêµ¬:</strong> ê°€ê²© í†µì œë‚˜ ì¡°ì„¸ ë¶€ê³¼ê°€ ì˜ë„ì¹˜ ì•Šì€ 'ê±°ë˜ëŸ‰ ê°ì†Œ'ë‚˜ 'ë¹„íš¨ìœ¨(ìì¤‘ì†ì‹¤)'ì„ ì´ˆë˜í•¨ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸ì‹œì¼œ ì£¼ì‹­ì‹œì˜¤. ì´ë¥¼ í†µí•´ í•™ìƒë“¤ì€ ê²½ì œ ì •ì±…ì´ ì„ ì˜ë§Œìœ¼ë¡œ ì™„ì„±ë˜ì§€ ì•Šìœ¼ë©°, ì •ë°€í•œ ì„¤ê³„ê°€ í•„ìš”í•¨ì„ ê¹¨ë‹«ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.</li>
      </ul>
      <p style="background:rgba(255,255,255,0.05); padding:12px; border-radius:8px; border-left:4px solid #34d399; margin-top:15px;">
        ğŸ’¡ <strong>Tip:</strong> í•™ìƒë“¤ì—ê²Œ ì§ì ‘ ì´ í˜ì´ì§€ë¥¼ ì—´ì–´ì£¼ê³ , "ì„¸ê¸ˆì´ 10ë§Œí¼ ë¶€ê³¼ë  ë•Œ, ì†Œë¹„ìì™€ ìƒì‚°ìê°€ ê°ê° ì–¼ë§ˆë§Œí¼ì˜ ë¶€ë‹´ì„ ì§€ëŠ”ì§€(ì¡°ì„¸ì˜ ê·€ì°©) ìˆ˜ì¹˜ë¥¼ ì¡°ì ˆí•˜ë©° ì°¾ì•„ë³´ë¼"ëŠ” íƒêµ¬ ê³¼ì œë¥¼ ì œì‹œí•´ ë³´ì‹­ì‹œì˜¤.
      </p>

      <div style="text-align:center; margin-top:40px; color:rgba(255,255,255,0.4); font-size:12px;">
        Developed for Economic Education Excellence
      </div>
    </div>
  </div>
</div>

<style>
  @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>

<script>
(() => {
  const btnOpen = document.getElementById("btnOpenGuide");
  const btnClose = document.getElementById("btnCloseGuide");
  const modal = document.getElementById("guideModal");

  // ì—´ê¸°
  btnOpen.addEventListener("click", () => {
    modal.style.display = "flex";
    // ì•½ê°„ì˜ ì§€ì—° í›„ opacity ì ìš© (transition íš¨ê³¼ ìœ„í•´)
    setTimeout(() => {
      modal.style.opacity = "1";
    }, 10);
  });

  // ë‹«ê¸° í•¨ìˆ˜
  const closeModal = () => {
    modal.style.opacity = "0";
    setTimeout(() => {
      modal.style.display = "none";
    }, 300);
  };

  btnClose.addEventListener("click", closeModal);

  // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
  });
})();
</script>