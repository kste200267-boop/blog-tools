<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‹°ì²˜ìŠ¤ ê°“ - í•™ê¸‰ ìë¦¬ë°°ì¹˜ ë° ìš´ì˜ ì˜¬ì¸ì› ë„êµ¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            /* í…Œë§ˆ ë³€ìˆ˜ (ê¸°ë³¸ ë¸”ë£¨) */
            --primary: #4A90E2;
            --secondary: #E3F2FD;
            --accent: #FF6B6B;
            --text: #333;
            --bg: #f5f7fa;
            --desk: #ffffff;
            --desk-border: #bbdefb;
            --font-main: 'Noto Sans KR', sans-serif;
            --font-hand: 'Jua', sans-serif;
        }

        /* í…Œë§ˆë³„ ì˜¤ë²„ë¼ì´ë“œ */
        body.theme-pink { --primary: #FF8BA7; --secondary: #FFEEF3; --desk-border: #ffcdd2; }
        body.theme-summer { --primary: #26A69A; --secondary: #E0F2F1; --desk-border: #b2dfdb; }
        body.theme-chalk { 
            --primary: #5D4037; --secondary: #3E4E50; --accent: #FFD54F; 
            --text: #eee; --bg: #2b2b2b; --desk: #3E4E50; --desk-border: #8d6e63;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-main); background: var(--bg); color: var(--text); padding-bottom: 50px; transition: 0.3s; }
        
        /* ë ˆì´ì•„ì›ƒ êµ¬ì¡° */
        .app-container { max-width: 1400px; margin: 0 auto; display: flex; gap: 20px; padding: 20px; }
        .main-content { flex: 1; }
        .sidebar { width: 300px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content; position: sticky; top: 20px; color: #333; }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; color: #333; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .brand { font-family: var(--font-hand); font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        .input-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: var(--font-main); }
        input:focus, textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }
        
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
        button { cursor: pointer; padding: 10px 18px; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 8px; font-family: var(--font-hand); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { filter: brightness(0.9); transform: translateY(-2px); }
        .btn-outline { background: white; border: 2px solid var(--primary); color: var(--primary); }
        .btn-danger { background: #ff5252; color: white; }
        
        /* A4 ìº”ë²„ìŠ¤ (êµì‹¤ í™”ë©´) */
        .classroom-wrapper {
            width: 100%;
            background: #ccc;
            padding: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }
        
        #classroom-canvas {
            width: 297mm; /* A4 ê°€ë¡œ */
            height: 210mm;
            background: white;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 40px;
            display: flex;
            flex-direction: column;
            transform-origin: top center; 
            /* í™”ë©´ì— ë§ê²Œ ìŠ¤ì¼€ì¼ ì¡°ì •ì€ JSë¡œ ì²˜ë¦¬ */
        }

        /* ë°°ê²½ ì´ë¯¸ì§€ ì˜¤ë²„ë ˆì´ */
        .bg-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; background-size: cover; background-position: center; pointer-events: none; }

        /* êµì‹¤ ë‚´ë¶€ ìš”ì†Œ */
        .canvas-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; position: relative; z-index: 1; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .class-info h1 { font-family: var(--font-hand); font-size: 2.5rem; color: var(--primary); }
        .class-info h2 { font-size: 1.2rem; color: #666; }
        
        .teacher-desk { 
            width: 200px; height: 60px; background: var(--primary); color: white; 
            border-radius: 10px; display: flex; justify-content: center; align-items: center; 
            font-family: var(--font-hand); font-size: 1.2rem; margin: 0 auto 30px auto; 
            position: relative; z-index: 1; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .seating-area { flex: 1; display: flex; justify-content: center; gap: 40px; position: relative; z-index: 1; align-items: flex-start; flex-wrap: wrap; align-content: flex-start; }
        
        .seat-group { display: grid; gap: 15px; } /* ë¶„ë‹¨ */

        .seat {
            width: 100px; height: 70px;
            background: var(--desk);
            border: 2px solid var(--desk-border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: grab;
            position: relative;
            transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .seat.dragging { opacity: 0.5; border: 2px dashed var(--primary); }
        .seat:hover { transform: scale(1.05); z-index: 10; }
        
        .seat-num { font-size: 0.8rem; color: #888; position: absolute; top: 5px; left: 8px; }
        .seat-name { font-family: var(--font-hand); font-size: 1.2rem; font-weight: bold; color: var(--text); }
        
        .lock-btn { 
            position: absolute; top: 5px; right: 8px; cursor: pointer; color: #ccc; font-size: 0.9rem; 
        }
        .seat.locked { border-color: var(--accent); background: #fff5f5; }
        .seat.locked .lock-btn { color: var(--accent); }
        
        .memo-box {
            margin-top: auto; border: 2px dashed #ccc; border-radius: 10px; padding: 15px;
            position: relative; z-index: 1; min-height: 80px; background: rgba(255,255,255,0.8);
        }
        .memo-title { font-family: var(--font-hand); color: var(--primary); margin-bottom: 5px; }
        .memo-content { white-space: pre-wrap; font-size: 0.95rem; }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal { background: white; padding: 25px; border-radius: 15px; width: 400px; max-width: 90%; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: popIn 0.3s; color: #333; }
        .modal h3 { font-family: var(--font-hand); margin-bottom: 15px; color: var(--primary); font-size: 1.5rem; }
        .modal-options { display: grid; gap: 10px; margin-bottom: 20px; }
        .option-btn { padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; text-align: left; }
        .option-btn:hover, .option-btn.selected { background: var(--secondary); border-color: var(--primary); color: var(--primary); font-weight: bold; }
        
        /* ê¸°ë¡ ë¦¬ìŠ¤íŠ¸ */
        .history-list { max-height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; }
        .history-item { border-bottom: 1px solid #eee; padding: 5px 0; display: flex; justify-content: space-between; }

        /* í‘¸í„° */
        .footer { text-align: center; margin-top: 30px; font-size: 0.9rem; color: #888; }
        .footer a { color: var(--primary); text-decoration: none; font-weight: bold; }

        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* ì¸ì‡„ ì„¤ì • */
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; padding: 0; }
            .sidebar, .control-panel, .btn-group, .footer, .modal-overlay, .classroom-wrapper { display: none !important; }
            .classroom-wrapper { display: block !important; padding: 0; background: white; }
            #classroom-canvas { 
                width: 100%; height: 100vh; box-shadow: none; margin: 0; padding: 20px; transform: none !important; 
                page-break-after: always;
            }
            /* ì¸ì‡„ ì‹œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ê°•ì œ */
            .seat-name, .class-info h1, .teacher-desk { color: black !important; -webkit-text-fill-color: black; }
            .teacher-desk { background: #eee !important; border: 1px solid #000; }
            .seat { border: 1px solid #000; background: white !important; }
            .seat.locked { background: #eee !important; }
            /* ë§í¬ ìˆ¨ê¹€ */
            a[href]:after { content: none !important; }
            
            @page { size: A4 landscape; margin: 0; }
        }

        /* í—¬í¼ í´ë˜ìŠ¤ */
        .hidden { display: none; }
        .text-sm { font-size: 0.85rem; color: #666; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="main-content">
        <div class="control-panel">
            <div class="panel-header">
                <div class="brand"><i class="fas fa-chalkboard-teacher"></i> í‹°ì²˜ìŠ¤ ê°“</div>
                <select id="themeSelect" onchange="changeTheme(this.value)">
                    <option value="blue">ë¸”ë£¨ í…Œë§ˆ</option>
                    <option value="pink">í•‘í¬ í…Œë§ˆ</option>
                    <option value="summer">ì¸ë¨¸ í…Œë§ˆ</option>
                    <option value="chalk">ì¹ íŒ í…Œë§ˆ</option>
                </select>
            </div>

            <div class="input-group">
                <input type="text" id="schoolName" placeholder="í•™êµëª… (ì˜ˆ: ëŒ€í•œì´ˆë“±í•™êµ)" oninput="updateUI()">
                <div style="display:flex; gap:10px;">
                    <input type="text" id="gradeClass" placeholder="í•™ë…„ ë°˜ (ì˜ˆ: 6í•™ë…„ 1ë°˜)" oninput="updateUI()">
                    <input type="text" id="teacherName" placeholder="ë‹´ì„ ì„±í•¨" oninput="updateUI()">
                </div>
                <input type="text" id="layoutConfig" placeholder="ë¶„ë‹¨ ë°°ì¹˜ (ì˜ˆ: 2, 2, 2)" value="2, 2, 2" onchange="renderSeats()">
            </div>
            
            <textarea id="studentList" rows="3" placeholder="í•™ìƒ ëª…ë‹¨ ì…ë ¥ (ì˜ˆ: ê¹€ì² ìˆ˜(1), ì´ì˜í¬(2), ë°•ë¯¼ìˆ˜...)" onchange="parseStudents()"></textarea>
            <div class="text-sm" style="margin-top: 5px; margin-bottom: 15px;">* "ì´ë¦„(ë²ˆí˜¸)" í˜•ì‹ìœ¼ë¡œ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>

            <div class="input-group" style="align-items: center; background: #f8f9fa; padding: 10px; border-radius: 8px;">
                <label style="font-size: 0.9rem; font-weight: bold;"><i class="fas fa-image"></i> ë°°ê²½ ì´ë¯¸ì§€:</label>
                <input type="file" id="bgUpload" accept="image/*" style="width: auto;">
                <label style="font-size: 0.9rem; margin-left: 10px;">íˆ¬ëª…ë„:</label>
                <input type="range" id="bgOpacity" min="0" max="1" step="0.1" value="0.3" oninput="updateBgOpacity()">
            </div>

            <div class="input-group">
                <textarea id="memoInput" rows="2" placeholder="ì „ë‹¬ì‚¬í•­ ì…ë ¥ (ì˜ˆ: êµê³¼ ì„ ìƒë‹˜ê»˜ - 3ë²ˆ í•™ìƒì€ ì‹œë ¥ì´ ì¢‹ì§€ ì•Šì•„ ì•ìë¦¬ì— ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.)" oninput="updateUI()"></textarea>
            </div>

            <div class="btn-group">
                <button class="btn-primary" onclick="shuffleSeats()"><i class="fas fa-random"></i> ìë¦¬ ì„ê¸°</button>
                <button class="btn-outline" onclick="openModal('pickerModal')"><i class="fas fa-hand-pointer"></i> ë°œí‘œì ë½‘ê¸°</button>
                <button class="btn-outline" onclick="openModal('groupModal')"><i class="fas fa-users"></i> ëª¨ë‘  í¸ì„±</button>
                <button class="btn-outline" onclick="printCanvas()"><i class="fas fa-print"></i> ì¸ì‡„í•˜ê¸°</button>
                <button class="btn-outline" onclick="saveAsImage()"><i class="fas fa-download"></i> ì´ë¯¸ì§€ ì €ì¥</button>
                <button class="btn-danger" style="margin-left: auto;" onclick="resetData()"><i class="fas fa-trash-alt"></i> ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="classroom-wrapper">
            <div id="classroom-canvas">
                <div class="bg-overlay" id="canvasBg"></div>
                
                <div class="canvas-header">
                    <div class="class-info">
                        <h1 id="displayTitle">0í•™ë…„ 0ë°˜</h1>
                        <h2 id="displaySchool">í•™êµëª…</h2>
                    </div>
                    <div style="text-align: right;">
                        <span style="font-size: 1.2rem; font-family: var(--font-hand);" id="displayTeacher">ë‹´ì„: 000 ì„ ìƒë‹˜</span>
                    </div>
                </div>

                <div class="teacher-desk">êµíƒ</div>

                <div class="seating-area" id="seatContainer">
                    </div>

                <div class="memo-box">
                    <div class="memo-title"><i class="fas fa-bullhorn"></i> ì „ë‹¬ì‚¬í•­</div>
                    <div class="memo-content" id="displayMemo">ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
                
                <div class="footer" style="position: absolute; bottom: 10px; width: 100%; left: 0; text-align: center;">
                    Created by <a href="https://www.google.com/search?q=kstephullab.com" target="_blank">í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™</a>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <h3 style="margin-bottom: 15px; font-family: var(--font-hand); color: var(--primary);"><i class="fas fa-lightbulb"></i> ì‚¬ìš© ê¿€íŒ</h3>
        <ul style="padding-left: 20px; line-height: 1.6; font-size: 0.95rem;">
            <li><strong>ìë™ ì €ì¥:</strong> ëª¨ë“  ë‚´ìš©ì€ ì…ë ¥ ì¦‰ì‹œ ì €ì¥ë©ë‹ˆë‹¤.</li>
            <li><strong>ëª…ë‹¨ ì…ë ¥:</strong> 'í™ê¸¸ë™(1)'ì²˜ëŸ¼ ì…ë ¥í•˜ë©´ ì´ë¦„ê³¼ ë²ˆí˜¸ê°€ ìë™ ë¶„ë¦¬ë©ë‹ˆë‹¤.</li>
            <li><strong>ì•Œë°•ê¸°(ê³ ì •):</strong> ìë¦¬ì˜ ìë¬¼ì‡ (<i class="fas fa-lock-open"></i>)ë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ í•™ìƒì€ ì„ê¸°ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</li>
            <li><strong>ë“œë˜ê·¸:</strong> í•™ìƒì„ ëŒì–´ì„œ ë‹¤ë¥¸ ìë¦¬ì™€ ë§êµí™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li><strong>ì¸ì‡„:</strong> ì¸ì‡„ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ A4 ê°€ë¡œ ê½‰ ì°¬ í™”ë©´ìœ¼ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.</li>
        </ul>
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
        <div style="font-size: 0.85rem; color: #888;">
            * ë¸Œë¼ìš°ì € [ì„¤ì •] > [ì¸ì‡„]ì—ì„œ 'ë°°ê²½ ê·¸ë˜í”½' ì˜µì…˜ì„ ì²´í¬í•´ì•¼ ë°°ê²½ìƒ‰ì´ ë‚˜ì˜µë‹ˆë‹¤.
        </div>
    </div>
</div>

<div class="modal-overlay" id="lockModal">
    <div class="modal">
        <h3><i class="fas fa-lock"></i> ìë¦¬ ê³ ì • ì‚¬ìœ </h3>
        <div class="modal-options" id="lockOptions">
            <div class="option-btn" onclick="selectLockReason('ì‹œë ¥ ë³´í˜¸')">ğŸ‘€ ì‹œë ¥ ë³´í˜¸</div>
            <div class="option-btn" onclick="selectLockReason('í‚¤/ì²´ê²© ê³ ë ¤')">ğŸ“ í‚¤/ì²´ê²© ê³ ë ¤</div>
            <div class="option-btn" onclick="selectLockReason('í–‰ë™/í•™ìŠµ ì§€ì›')">ğŸ¤ í–‰ë™/í•™ìŠµ ì§€ì›</div>
            <input type="text" id="customLockReason" placeholder="ì§ì ‘ ì…ë ¥" class="option-btn" style="width: 100%; cursor: text;">
        </div>
        <div class="btn-group" style="justify-content: flex-end;">
            <button class="btn-outline" onclick="closeModal('lockModal')">ì·¨ì†Œ</button>
            <button class="btn-primary" onclick="applyLock()">í™•ì¸</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="pickerModal">
    <div class="modal">
        <h3><i class="fas fa-dice"></i> ë°œí‘œì ë½‘ê¸°</h3>
        <div style="margin-bottom: 15px;">
            <label>ë½‘ì„ ì¸ì›:</label>
            <input type="number" id="pickCount" value="1" min="1" max="10" style="width: 60px;">
        </div>
        <div id="pickerResult" style="padding: 15px; background: var(--secondary); border-radius: 8px; text-align: center; font-size: 1.5rem; font-family: var(--font-hand); min-height: 60px; display: flex; align-items: center; justify-content: center;">
            ë‘êµ¬ë‘êµ¬...
        </div>
        <div class="btn-group" style="margin-top: 15px;">
            <button class="btn-primary" style="width: 100%; justify-content: center;" onclick="runPicker()">ë½‘ê¸°!</button>
        </div>
        
        <div style="margin-top: 20px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <strong style="font-size: 0.9rem;">ê¸°ë¡ (History)</strong>
                <button style="padding: 2px 8px; font-size: 0.8rem;" onclick="clearHistory()">ê¸°ë¡ ì‚­ì œ</button>
            </div>
            <div class="history-list" id="pickerHistory">
                </div>
        </div>
        <button class="btn-outline" style="margin-top: 15px; width: 100%;" onclick="closeModal('pickerModal')">ë‹«ê¸°</button>
    </div>
</div>

<div class="modal-overlay" id="groupModal">
    <div class="modal">
        <h3><i class="fas fa-users"></i> ëœë¤ ëª¨ë‘  í¸ì„±</h3>
        <div style="margin-bottom: 15px;">
            <label>í•œ ëª¨ë‘ ë‹¹ ì¸ì›:</label>
            <input type="number" id="groupSize" value="4" min="2" style="width: 60px;">
        </div>
        <div id="groupResult" style="max-height: 200px; overflow-y: auto; font-size: 0.9rem; white-space: pre-wrap;"></div>
        <div class="btn-group">
            <button class="btn-primary" onclick="makeGroups()">í¸ì„±í•˜ê¸°</button>
            <button class="btn-outline" onclick="closeModal('groupModal')">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    // ìƒíƒœ ê´€ë¦¬ ê°ì²´
    let state = {
        schoolName: '',
        gradeClass: '',
        teacherName: '',
        layoutConfig: '2, 2, 2',
        studentListRaw: '',
        students: [], // {id, name, number, locked, lockReason}
        memo: '',
        theme: 'blue',
        pickerHistory: [],
        bgOpacity: 0.3
    };

    let currentLockIndex = null;
    let draggedIndex = null;

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
    });

    // ë°ì´í„° ë¡œë“œ
    function loadData() {
        const saved = localStorage.getItem('teachersGodData');
        if (saved) {
            state = JSON.parse(saved);
            // UI ë³µì›
            document.getElementById('schoolName').value = state.schoolName;
            document.getElementById('gradeClass').value = state.gradeClass;
            document.getElementById('teacherName').value = state.teacherName;
            document.getElementById('layoutConfig').value = state.layoutConfig;
            document.getElementById('studentList').value = state.studentListRaw;
            document.getElementById('memoInput').value = state.memo;
            document.getElementById('themeSelect').value = state.theme;
            document.getElementById('bgOpacity').value = state.bgOpacity;
            
            // ë°°ê²½ ì´ë¯¸ì§€ ë³µì› (localStorage ìš©ëŸ‰ ì œí•œìœ¼ë¡œ ì¸í•´ base64ê°€ ë„ˆë¬´ í¬ë©´ ì €ì¥ ì•ˆë  ìˆ˜ ìˆìŒ, ì—¬ê¸°ì„œëŠ” ìƒëµí•˜ê³  UIì„¤ì •ë§Œ)
            changeTheme(state.theme);
            updateBgOpacity();
            updateHistoryUI();
        }
        updateUI();
        renderSeats();
    }

    // ë°ì´í„° ì €ì¥
    function saveData() {
        localStorage.setItem('teachersGodData', JSON.stringify(state));
    }

    // UI ì—…ë°ì´íŠ¸ (í…ìŠ¤íŠ¸)
    function updateUI() {
        state.schoolName = document.getElementById('schoolName').value;
        state.gradeClass = document.getElementById('gradeClass').value;
        state.teacherName = document.getElementById('teacherName').value;
        state.memo = document.getElementById('memoInput').value;

        document.getElementById('displaySchool').innerText = state.schoolName || 'í•™êµëª…';
        document.getElementById('displayTitle').innerText = state.gradeClass || '0í•™ë…„ 0ë°˜';
        document.getElementById('displayTeacher').innerText = state.teacherName ? `ë‹´ì„: ${state.teacherName} ì„ ìƒë‹˜` : 'ë‹´ì„: 000 ì„ ìƒë‹˜';
        document.getElementById('displayMemo').innerText = state.memo || 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
        
        saveData();
    }

    // í•™ìƒ ëª…ë‹¨ íŒŒì‹±
    function parseStudents() {
        state.studentListRaw = document.getElementById('studentList').value;
        const rawList = state.studentListRaw.split(',').map(s => s.trim()).filter(s => s);
        
        // ê¸°ì¡´ ì ê¸ˆ ìƒíƒœ ìœ ì§€ë¥¼ ìœ„í•´ ì„ì‹œ ë§µ ìƒì„±
        const lockMap = {};
        state.students.forEach(s => {
            if(s.locked) lockMap[s.name] = s;
        });

        state.students = rawList.map((str, idx) => {
            // ì´ë¦„(ë²ˆí˜¸) ì •ê·œì‹ íŒŒì‹±
            const match = str.match(/(.+)\((\d+)\)/);
            let name = str;
            let num = '';
            
            if (match) {
                name = match[1].trim();
                num = match[2].trim();
            }

            // ê¸°ì¡´ ì ê¸ˆ ì •ë³´ê°€ ìˆìœ¼ë©´ ìœ ì§€
            const prev = lockMap[name];
            return {
                id: idx,
                name: name,
                number: num,
                locked: prev ? prev.locked : false,
                lockReason: prev ? prev.lockReason : ''
            };
        });

        saveData();
        renderSeats();
    }

    // ì¢Œì„ ë Œë”ë§ (í•µì‹¬ ë¡œì§)
    function renderSeats() {
        state.layoutConfig = document.getElementById('layoutConfig').value;
        const container = document.getElementById('seatContainer');
        container.innerHTML = '';

        const config = state.layoutConfig.split(',').map(Number); // [2, 2, 2]
        let studentIdx = 0;

        // ë¶„ë‹¨ ë³„ë¡œ ê·¸ë£¹ ìƒì„±
        config.forEach(colsInGroup => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'seat-group';
            // ë¶„ë‹¨ ë‚´ ê·¸ë¦¬ë“œ ì„¤ì • (ì—´ ê°œìˆ˜)
            groupDiv.style.gridTemplateColumns = `repeat(${colsInGroup}, 1fr)`;

            // í•´ë‹¹ ë¶„ë‹¨ì— ë“¤ì–´ê°ˆ í•™ìƒ ìˆ˜ ê³„ì‚° (í™”ë©´ ê½‰ ì±„ìš°ê¸° ìœ„í•´ ì „ì²´ í•™ìƒì„ ë¶„ë‹¨ ë¹„ìœ¨ë¡œ ë‚˜ëˆ„ê±°ë‚˜ ìˆœì„œëŒ€ë¡œ ë°°ì¹˜)
            // ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí•˜ê²Œ ì „ì²´ í•™ìƒì„ ìˆœì„œëŒ€ë¡œ ë°°ì¹˜í•˜ë˜, ì¤„ë°”ê¿ˆì€ CSS Gridê°€ ì•Œì•„ì„œ ì²˜ë¦¬
            // í•˜ì§€ë§Œ "ì¤„" ê°œë…ì„ ë§ì¶”ê¸° ìœ„í•´, í˜„ì¬ ë‚¨ì€ í•™ìƒë“¤ì„ ë°°ì¹˜.
            // í˜„ì‹¤ì ì¸ êµì‹¤ ë°°ì¹˜ë¥¼ ìœ„í•´: ì „ì²´ í•™ìƒì„ ì•ì—ì„œ ë’¤ë¡œ ì±„ìš°ê¸°ë³´ë‹¤, ì±…ìƒ ë°°ì—´ì„ ë¨¼ì € ë§Œë“¦.
            
            // ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ì„±ì„ ìœ„í•´ ë‹¨ìˆœíˆ 2,2,2ëŠ” ê°€ë¡œì— 3ê°œì˜ ë©ì–´ë¦¬ê°€ ìˆê³  ê° ë©ì–´ë¦¬ê°€ 2ì—´ì´ë¼ëŠ” ëœ»ìœ¼ë¡œ í•´ì„
            // í•™ìƒë“¤ì„ ë°°ì¹˜í•  ë•ŒëŠ” ì¢Œ->ìš°, ì•->ë’¤ ìˆœì„œë¡œ ì±„ì›€.
            
            // ì—¬ê¸°ì„œëŠ” ì‹œê°ì  ë°°ì¹˜ë¥¼ ìœ„í•´ ëª¨ë“  í•™ìƒ ì¹´ë“œë¥¼ ë Œë”ë§í•˜ê³ , 
            // CSS flex wrapê³¼ marginì„ ì´ìš©í•´ ë¶„ë‹¨ì„ ì‹œê°ì ìœ¼ë¡œë§Œ ë¶„ë¦¬í•˜ëŠ” ë°©ì‹ ëŒ€ì‹ 
            // ë¶„ë‹¨ë³„ divë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì— í•™ìƒì„ ë„£ìœ¼ë©´ ì´ë™ì´ ë³µì¡í•´ì§.
            // ë”°ë¼ì„œ **ë‹¨ì¼ ì»¨í…Œì´ë„ˆ**ì— ë„£ë˜, CSS Grid/Flex gapì„ ì´ìš©í•˜ê±°ë‚˜
            // ë¹ˆ 'í†µë¡œ' ìš”ì†Œë¥¼ ì‚½ì…í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©.
            
        });

        // ì‹¬í”Œí•œ ì ‘ê·¼: ì „ì²´ë¥¼ í•˜ë‚˜ì˜ Flex ì»¨í…Œì´ë„ˆë¡œ ì“°ê³ , ë¶„ë‹¨ êµ¬ë¶„ì„ ìœ„í•´ marginì„ ê°€ì§„ divë¡œ ê°ì‹¸ëŠ”ê²Œ ì•„ë‹ˆë¼
        // ë Œë”ë§ ì‹œ "ë¶„ë‹¨" ë‹¨ìœ„ë¡œ ëŠì–´ì„œ ê·¸ë¦¼.
        
        // ì´ í•™ìƒ ìˆ˜ì— ë§ì¶° ë¹ˆ ìë¦¬ê¹Œì§€ í¬í•¨í• ì§€ ì—¬ë¶€ -> í•™ìƒ ìˆ˜ë§Œí¼ë§Œ í‘œì‹œ
        
        // ë¶„ë‹¨ êµ¬ì¡° ì¬ì„¤ê³„: UIìƒ ë“œë˜ê·¸ì•¤ë“œë¡­ì´ ì‰¬ìš°ë ¤ë©´ í‰ë©´ì  êµ¬ì¡°ê°€ ì¢‹ìŒ.
        // ë¶„ë‹¨ ì„¤ì •(2,2,2)ì— ë”°ë¼ ë¶„ë‹¨ Divë“¤ì„ ìƒì„±í•˜ê³  ê·¸ ì•ˆì— í•™ìƒì„ ìˆœì„œëŒ€ë¡œ ë°°ë¶„?
        // ì•„ë‹ˆë©´ í•™ìƒ ë¦¬ìŠ¤íŠ¸ ìˆœì„œëŒ€ë¡œ ê·¸ëƒ¥ ë¿Œë¦¬ë˜, ë¶„ë‹¨ ì‚¬ì´ ê°„ê²©ë§Œ ë„ìš°ê¸°? -> í›„ìê°€ ë§ìŒ.
        
        // ìˆ˜ì •: 2,2,2ë¼ë©´ í•œ ì¤„ì— 6ëª…. 
        // ì‹œê°ì ìœ¼ë¡œ ë¶„ë‹¨ì„ ë‚˜ëˆ„ê¸° ìœ„í•´ containerë¥¼ ì—¬ëŸ¬ê°œ ë‘ì§€ ì•Šê³ ,
        // display: flex; flex-wrap: wrap; í•˜ê³ 
        // ê° ë¶„ë‹¨(Group) divë¥¼ ë§Œë“¤ì–´ì„œ ê·¸ ì•ˆì— í•™ìƒë“¤ì„ ë„£ì.
        
        let currentStudentIndex = 0;
        
        // ë¶„ë‹¨ ê°¯ìˆ˜ë§Œí¼ ë°˜ë³µí•˜ì—¬ ë¶„ë‹¨ ì»¨í…Œì´ë„ˆ ìƒì„±
        // í•˜ì§€ë§Œ ì¤„(Row) ìˆ˜ë¥¼ ì•Œì•„ì•¼ í•¨. í•™ìƒ ìˆ˜ / ì „ì²´ ì—´ ìˆ˜.
        const totalCols = config.reduce((a, b) => a + b, 0);
        const totalStudents = state.students.length;
        const totalRows = Math.ceil(totalStudents / totalCols);

        // ì‹œê°ì  êµ¬í˜„:
        // ê° ë¶„ë‹¨(Column Group)ì„ ì„¸ë¡œë¡œ ê¸´ divë¡œ ë§Œë“¤ê³  ê·¸ ì•ˆì— ê·¸ë¦¬ë“œë¥¼ ë„£ëŠ”ê²Œ ì•„ë‹ˆë¼,
        // ì „ì²´ë¥¼ ê°ì‹¸ëŠ” FlexBox ì•ˆì— "ë¶„ë‹¨ Div"ë“¤ì„ ë°°ì¹˜.
        
        config.forEach((cols) => {
            const groupEl = document.createElement('div');
            groupEl.className = 'seat-group';
            groupEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            // ì´ ë¶„ë‹¨ì— í• ë‹¹ë  í•™ìƒë“¤ì„ ê³„ì‚°í•´ì•¼ í•˜ëŠ”ë°,
            // ë³´í†µ êµì‹¤ì€ "ê°€ë¡œ ì¤„"ì´ ë§ì•„ì•¼ í•˜ë¯€ë¡œ, 
            // 1ë¶„ë‹¨ 1ì—´ 1í–‰, 1ë¶„ë‹¨ 2ì—´ 1í–‰ ... ì‹ì„.
            // ë°ì´í„° êµ¬ì¡°(Array)ëŠ” 1ì°¨ì›ì´ë¯€ë¡œ ì´ë¥¼ ì‹œê°ì  ìœ„ì¹˜ë¡œ ë§¤í•‘í•˜ëŠ”ê²Œ ê¹Œë‹¤ë¡œì›€.
            
            // í•´ê²°ì±…: ê·¸ëƒ¥ 1ì°¨ì› ë°°ì—´ ìˆœì„œëŒ€ë¡œ ë Œë”ë§í•˜ë˜,
            // ë¶„ë‹¨ ì„¤ì •ì€ "ì‹œê°ì  ê·¸ë£¹í•‘"ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì§€ ì•Šê³ 
            // ê·¸ëƒ¥ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ Gridë¡œ í•˜ê³  gapì„ ì¡°ì ˆí•˜ëŠ”ê²Œ ë‚˜ì„ìˆ˜ë„ ìˆìœ¼ë‚˜
            // 2, 2, 2 ì‚¬ì´ì˜ í†µë¡œë¥¼ êµ¬í˜„í•´ì•¼ í•¨.
            
            // ê°€ì¥ ì‰¬ìš´ ë°©ë²•: ë¶„ë‹¨ë³„ë¡œ ìˆ˜ì§ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¦.
            // í•˜ì§€ë§Œ í•™ìƒì€ ê°€ë¡œ(í–‰) ìš°ì„ ìœ¼ë¡œ ì±„ì›Œì§.
            
            // ë”°ë¼ì„œ 1ì°¨ì› ë°°ì—´ì„ ë Œë”ë§ í•  ë•Œ,
            // index % totalCols ë¥¼ í†µí•´ í˜„ì¬ ì–´ëŠ ë¶„ë‹¨ì— ì†í•˜ëŠ”ì§€ ê³„ì‚° ë¶ˆê°€ (ë¶„ë‹¨ í¬ê¸°ê°€ ë‹¤ë¥´ë¯€ë¡œ).
            
            // ì ‘ê·¼ ë³€ê²½: ì „ì²´ í•™ìƒì„ ë Œë”ë§ í•˜ë˜,
            // í•™ìƒ í•˜ë‚˜í•˜ë‚˜ë¥¼ ê·¸ë¦¬ëŠ”ê²Œ ì•„ë‹ˆë¼ "ìë¦¬(Slot)"ë¥¼ ë¨¼ì € ê·¸ë¦¼.
            // 2,2,2 ë©´ í•œ ì¤„ì— 6ê°œì˜ ìŠ¬ë¡¯. í†µë¡œëŠ” margin-rightë¡œ ì²˜ë¦¬.
            
            // ê·¸ëƒ¥ Group Div ë°©ì‹ í¬ê¸°í•˜ê³ , ì „ì²´ ë‹¨ì¼ Gridë¡œ í•˜ë˜
            // nth-childë¥¼ ì´ìš©í•´ marginì„ ì£¼ëŠ”ê±´ ë™ì ì´ì§€ ì•ŠìŒ.
            
            // ìµœì¢… ì ‘ê·¼: Flex ì»¨í…Œì´ë„ˆ ì•ˆì— "ë¶„ë‹¨ ì»¨í…Œì´ë„ˆ"ë“¤ì„ ë°°ì¹˜.
            // í•™ìƒ ë°°ì—´ì„ ì¬ì •ë ¬í•˜ì—¬ ê° ë¶„ë‹¨ì— ë°€ì–´ë„£ì–´ì•¼ í•¨? -> NO. ë“œë˜ê·¸ì•¤ë“œë¡­ ì¸ë±ìŠ¤ê°€ ê¼¬ì„.
            
            // ê²°ë¡ : "ë¶„ë‹¨ ë°°ì¹˜" ì„¤ì •ì€ ë¬´ì‹œí•˜ê³  ë‹¨ìˆœ Gridë¡œ ê°€ê±°ë‚˜, 
            // ë˜ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ 2,2,2ì— ë§ì¶° 3ê°œì˜ í° Divë¥¼ ë§Œë“¤ê³ 
            // í•™ìƒë“¤ì„ ì•ì—ì„œë¶€í„° ì±„ì›Œë„£ëŠ”ë°, "ê°€ë¡œ ìš°ì„ "ì´ ë˜ê²Œ í•˜ë ¤ë©´
            // 1ë²ˆí•™ìƒ: 1ë¶„ë‹¨, 2ë²ˆ: 1ë¶„ë‹¨, 3ë²ˆ: 2ë¶„ë‹¨... ì´ë ‡ê²Œ ê°€ì•¼í•¨.
            // ì´ê²Œ ë³µì¡í•˜ë¯€ë¡œ, í™”ë©´ìƒ ë³´ì—¬ì§€ëŠ”ê±´ ê·¸ëƒ¥
            // [ë¶„ë‹¨1] [ë¶„ë‹¨2] [ë¶„ë‹¨3] í˜•íƒœë¡œ í•˜ë˜
            // í•™ìƒ ë¦¬ìŠ¤íŠ¸ì˜ ìˆœì„œë¥¼ ì„¸ë¡œ ìš°ì„ (Column Major)ì´ ì•„ë‹ˆë¼ ê°€ë¡œ ìš°ì„ (Row Major)ìœ¼ë¡œ ë¶„ë°°.
            
            container.appendChild(groupEl);
        });

        // ë¶„ë‹¨ ì»¨í…Œì´ë„ˆ ë‹¤ì‹œ ì„ íƒ
        const groups = document.querySelectorAll('.seat-group');
        
        // í•™ìƒ ë°°ì¹˜ ë¡œì§ (Row Major)
        // ì´ ì—´ ê°œìˆ˜(totalCols)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í–‰(row)ì„ ë”.
        for (let r = 0; r < totalRows; r++) {
            let colOffset = 0;
            config.forEach((cols, groupIdx) => {
                const groupEl = groups[groupIdx];
                for (let c = 0; c < cols; c++) {
                    // í˜„ì¬ ì²˜ë¦¬ì¤‘ì¸ ì „ì²´ ê·¸ë¦¬ë“œ ìƒì˜ ì¸ë±ìŠ¤
                    const globalIndex = (r * totalCols) + colOffset + c;
                    
                    if (globalIndex < state.students.length) {
                        const student = state.students[globalIndex];
                        const seatEl = createSeatElement(student, globalIndex);
                        groupEl.appendChild(seatEl);
                    } else {
                        // ë¹ˆ ì±…ìƒ (í•™ìƒ ìˆ˜ ë¶€ì¡± ì‹œ)
                        // const emptySeat = document.createElement('div');
                        // emptySeat.className = 'seat';
                        // emptySeat.style.opacity = 0.5;
                        // groupEl.appendChild(emptySeat);
                    }
                }
                colOffset += cols;
            });
        }
    }

    function createSeatElement(student, index) {
        const el = document.createElement('div');
        el.className = `seat ${student.locked ? 'locked' : ''}`;
        el.draggable = true;
        el.dataset.index = index;

        // ë“œë˜ê·¸ ì´ë²¤íŠ¸
        el.addEventListener('dragstart', handleDragStart);
        el.addEventListener('dragover', handleDragOver);
        el.addEventListener('drop', handleDrop);
        el.addEventListener('dragend', handleDragEnd);
        
        // ëª¨ë°”ì¼ í„°ì¹˜ ëŒ€ì‘ (ì‹¬í”Œí•˜ê²Œ í´ë¦­ ìŠ¤ì™‘ì€ êµ¬í˜„ ë³µì¡í•˜ë¯€ë¡œ ìƒëµ, ë°ìŠ¤í¬íƒ‘ ìœ„ì£¼)

        el.innerHTML = `
            <span class="seat-num">${student.number || ''}</span>
            <span class="seat-name">${student.name}</span>
            <i class="fas fa-${student.locked ? 'lock' : 'lock-open'} lock-btn" onclick="toggleLock(${index})"></i>
        `;
        
        if(student.locked && student.lockReason) {
            el.title = `ê³ ì • ì‚¬ìœ : ${student.lockReason}`;
        }

        return el;
    }

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ í•¸ë“¤ëŸ¬
    function handleDragStart(e) {
        draggedIndex = +this.dataset.index;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
    }
    function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        return false;
    }
    function handleDrop(e) {
        e.stopPropagation();
        const targetIndex = +this.dataset.index;
        
        if (draggedIndex !== targetIndex) {
            // ë°ì´í„° êµí™˜
            const temp = state.students[draggedIndex];
            state.students[draggedIndex] = state.students[targetIndex];
            state.students[targetIndex] = temp;
            
            saveData();
            renderSeats();
        }
        return false;
    }
    function handleDragEnd(e) {
        this.classList.remove('dragging');
    }

    // ì ê¸ˆ ê¸°ëŠ¥
    function toggleLock(index) {
        if (state.students[index].locked) {
            state.students[index].locked = false;
            state.students[index].lockReason = '';
            saveData();
            renderSeats();
        } else {
            currentLockIndex = index;
            openModal('lockModal');
        }
    }

    function selectLockReason(reason) {
        document.getElementById('customLockReason').value = reason;
        const opts = document.querySelectorAll('.option-btn');
        opts.forEach(o => o.classList.remove('selected'));
        event.target.classList.add('selected');
    }

    function applyLock() {
        const reason = document.getElementById('customLockReason').value || 'ê¸°íƒ€';
        if (currentLockIndex !== null) {
            state.students[currentLockIndex].locked = true;
            state.students[currentLockIndex].lockReason = reason;
            saveData();
            renderSeats();
        }
        closeModal('lockModal');
        document.getElementById('customLockReason').value = '';
    }

    // ìë¦¬ ì„ê¸° (Fisher-Yates)
    function shuffleSeats() {
        const indicesToShuffle = [];
        state.students.forEach((s, i) => {
            if (!s.locked) indicesToShuffle.push(i);
        });

        // ì…”í”Œ ë¡œì§
        for (let i = indicesToShuffle.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            const idxA = indicesToShuffle[i];
            const idxB = indicesToShuffle[j];
            
            // ë°°ì—´ ë‚´ ê°ì²´ êµí™˜
            [state.students[idxA], state.students[idxB]] = [state.students[idxB], state.students[idxA]];
        }

        saveData();
        renderSeats();
    }

    // ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ
    document.getElementById('bgUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(evt) {
                const bgDiv = document.getElementById('canvasBg');
                bgDiv.style.backgroundImage = `url(${evt.target.result})`;
                // ì‹¤ì œë¡œëŠ” ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥ì´ ìš©ëŸ‰ ë¬¸ì œë¡œ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ
                // ì—¬ê¸°ì„œëŠ” ì„¸ì…˜ ë™ì•ˆë§Œ ìœ ì§€ë˜ë„ë¡ í•¨
            };
            reader.readAsDataURL(file);
        }
    });

    function updateBgOpacity() {
        const val = document.getElementById('bgOpacity').value;
        document.getElementById('canvasBg').style.opacity = val;
        state.bgOpacity = val;
    }

    // ëª¨ë‹¬ ê³µí†µ
    function openModal(id) {
        document.getElementById(id).style.display = 'flex';
    }
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // ë°œí‘œì ë½‘ê¸°
    function runPicker() {
        const count = document.getElementById('pickCount').value;
        const candidates = state.students.map(s => s.name);
        if (candidates.length === 0) return;

        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        const resBox = document.getElementById('pickerResult');
        let counter = 0;
        const interval = setInterval(() => {
            resBox.innerText = candidates[Math.floor(Math.random() * candidates.length)];
            counter++;
            if(counter > 10) {
                clearInterval(interval);
                // ì‹¤ì œ ë½‘ê¸°
                const shuffled = candidates.sort(() => 0.5 - Math.random());
                const picked = shuffled.slice(0, count);
                resBox.innerText = picked.join(', ');
                
                // ê¸°ë¡ ì €ì¥
                const log = `[${new Date().toLocaleTimeString()}] ${picked.join(', ')}`;
                state.pickerHistory.unshift(log);
                updateHistoryUI();
                saveData();
            }
        }, 100);
    }

    function updateHistoryUI() {
        const list = document.getElementById('pickerHistory');
        list.innerHTML = state.pickerHistory.map(h => `<div class="history-item"><span>${h}</span></div>`).join('');
    }
    
    function clearHistory() {
        state.pickerHistory = [];
        updateHistoryUI();
        saveData();
    }

    // ëª¨ë‘  í¸ì„±
    function makeGroups() {
        const size = parseInt(document.getElementById('groupSize').value);
        const names = state.students.map(s => s.name).sort(() => 0.5 - Math.random());
        let resultText = '';
        
        let groupNum = 1;
        for(let i=0; i<names.length; i+=size) {
            const group = names.slice(i, i+size);
            resultText += `[${groupNum}ëª¨ë‘ ] ${group.join(', ')}\n`;
            groupNum++;
        }
        
        document.getElementById('groupResult').innerText = resultText;
    }

    // ìœ í‹¸ë¦¬í‹°
    function changeTheme(theme) {
        document.body.className = `theme-${theme}`;
        state.theme = theme;
        saveData();
    }

    function resetData() {
        if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.removeItem('teachersGodData');
            location.reload();
        }
    }

    // ì´ë¯¸ì§€ ì €ì¥ (html2canvas)
    function saveAsImage() {
        const element = document.getElementById('classroom-canvas');
        // ìŠ¤ì¼€ì¼ ì¡°ì •ì„ ì ì‹œ í•´ì œí•˜ê³  ìº¡ì³í•´ì•¼ ê¹”ë”í•¨
        html2canvas(element, { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `${state.gradeClass}_ìë¦¬ë°°ì¹˜.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    // ìº”ë²„ìŠ¤ ì‚¬ì´ì¦ˆ ì¡°ì • (ë°˜ì‘í˜• ë·°)
    function resizeCanvas() {
        const wrapper = document.querySelector('.classroom-wrapper');
        const canvas = document.getElementById('classroom-canvas');
        const wrapperWidth = wrapper.clientWidth - 40; // padding
        const a4WidthStr = getComputedStyle(canvas).width; // 297mm
        
        // mmë¥¼ pxë¡œ ë³€í™˜ (ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¤ë¥´ì§€ë§Œ ëŒ€ëµ 96DPI ê¸°ì¤€ 1mm = 3.78px)
        // ì—¬ê¸°ì„œëŠ” offsetWidthë¥¼ ì”ë‹ˆë‹¤.
        const baseWidth = 1122; // A4 landscape @ 96dpi approx
        
        const scale = wrapperWidth / baseWidth;
        
        if(scale < 1) {
            canvas.style.transform = `scale(${scale})`;
            wrapper.style.height = `${(794 * scale) + 40}px`; // A4 height approx
        } else {
            canvas.style.transform = 'scale(1)';
            wrapper.style.height = 'auto';
        }
    }
    
    function printCanvas() {
        window.print();
    }

</script>
</body>
</html>