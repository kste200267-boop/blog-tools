<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸš€ í™”ì„± ì´ì£¼ ë„ì‹œ ì„¤ê³„ ì‹œë®¬ë ˆì´ì…˜ | í†µí•©ì‚¬íšŒ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0a1a;
            --bg-secondary: #12122a;
            --bg-card: #1a1a3a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0;
            --accent-time: #ff6b6b;
            --accent-space: #4ecdc4;
            --accent-social: #ffe66d;
            --accent-ethics: #c44dff;
            --mars-surface: #c1440e;
            --mars-dark: #8b2500;
            --neon-glow: 0 0 20px;
            --border-radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .stars {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            background: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 40% 70%, white, transparent),
                radial-gradient(1px 1px at 90% 40%, white, transparent),
                radial-gradient(2px 2px at 60% 20%, white, transparent),
                radial-gradient(1px 1px at 30% 80%, white, transparent);
            animation: twinkle 5s ease-in-out infinite;
        }

        @keyframes twinkle { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ========== í—¤ë” ========== */
        .header {
            text-align: center;
            padding: 30px 25px;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(196, 77, 255, 0.1));
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-family: 'Jua', sans-serif;
            font-size: clamp(1.5rem, 3.5vw, 2.4rem);
            margin-bottom: 8px;
            background: linear-gradient(90deg, var(--accent-space), var(--accent-ethics));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .standards-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            margin-top: 15px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .standards-title {
            font-family: 'Jua', sans-serif;
            font-size: 0.95rem;
            color: var(--accent-space);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .standard-item {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding-left: 10px;
            border-left: 3px solid var(--accent-ethics);
            line-height: 1.5;
        }

        .standard-item:last-child {
            margin-bottom: 0;
        }

        .standard-code {
            color: var(--accent-social);
            font-weight: 700;
        }

        /* ========== ê°€ì´ë“œ ë°•ìŠ¤ ========== */
        .guide-box {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(196, 77, 255, 0.05));
            border: 1px dashed rgba(78, 205, 196, 0.4);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .guide-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .guide-content h3 {
            font-family: 'Jua', sans-serif;
            font-size: 1rem;
            color: var(--accent-space);
            margin-bottom: 5px;
        }

        .guide-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* ========== ì‚¬ìš©ì ì •ë³´ ========== */
        .user-section {
            margin-bottom: 20px;
        }

        .section-label {
            font-family: 'Jua', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            padding-left: 5px;
        }

        .input-group input {
            padding: 12px 15px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-space);
            box-shadow: var(--neon-glow) var(--accent-space);
        }

        .input-group input::placeholder { color: rgba(255, 255, 255, 0.3); }

        /* ========== ë©”ì¸ ë ˆì´ì•„ì›ƒ ========== */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 950px) {
            .main-layout { grid-template-columns: 1fr; }
            .user-info-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* ========== ê±´ë¬¼ íŒ¨ë„ ========== */
        .building-panel {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .panel-title {
            font-family: 'Jua', sans-serif;
            font-size: 1.15rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            padding: 10px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            line-height: 1.5;
        }

        /* ì˜ˆì‚° ë°” */
        .budget-bar-wrapper {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .budget-label { 
            font-size: 0.9rem; 
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .budget-amount {
            font-family: 'Jua', sans-serif;
            font-size: 1.3rem;
            color: var(--accent-space);
            text-shadow: var(--neon-glow) var(--accent-space);
        }

        .budget-bar-bg {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            height: 12px;
            overflow: hidden;
        }

        .budget-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-space), var(--accent-ethics));
            border-radius: 8px;
            transition: width 0.4s ease;
        }

        /* ê´€ì  íƒ­ */
        .perspective-tabs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 10px 6px;
            background: rgba(0,0,0,0.3);
            border: 2px solid transparent;
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'Jua', sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .tab-btn .tab-icon { font-size: 1.2rem; }
        .tab-btn .tab-emoji { font-size: 1.1rem; }

        .tab-btn.time.active { border-color: var(--accent-time); color: var(--accent-time); background: rgba(255, 107, 107, 0.15); }
        .tab-btn.space.active { border-color: var(--accent-space); color: var(--accent-space); background: rgba(78, 205, 196, 0.15); }
        .tab-btn.social.active { border-color: var(--accent-social); color: var(--accent-social); background: rgba(255, 230, 109, 0.15); }
        .tab-btn.ethics.active { border-color: var(--accent-ethics); color: var(--accent-ethics); background: rgba(196, 77, 255, 0.15); }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }

        /* ê±´ë¬¼ ëª©ë¡ */
        .building-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .building-list::-webkit-scrollbar { width: 6px; }
        .building-list::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 3px; }
        .building-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }

        .building-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .building-item:hover:not(.built):not(.disabled) { transform: translateX(5px); }

        .building-item.time:hover:not(.built):not(.disabled) { border-color: var(--accent-time); }
        .building-item.space:hover:not(.built):not(.disabled) { border-color: var(--accent-space); }
        .building-item.social:hover:not(.built):not(.disabled) { border-color: var(--accent-social); }
        .building-item.ethics:hover:not(.built):not(.disabled) { border-color: var(--accent-ethics); }

        .building-item.built { opacity: 0.4; cursor: not-allowed; }
        .building-item.disabled { opacity: 0.3; cursor: not-allowed; }

        .building-icon-wrapper {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .building-item.time .building-icon-wrapper { background: rgba(255, 107, 107, 0.2); color: var(--accent-time); }
        .building-item.space .building-icon-wrapper { background: rgba(78, 205, 196, 0.2); color: var(--accent-space); }
        .building-item.social .building-icon-wrapper { background: rgba(255, 230, 109, 0.2); color: var(--accent-social); }
        .building-item.ethics .building-icon-wrapper { background: rgba(196, 77, 255, 0.2); color: var(--accent-ethics); }

        .building-info { flex: 1; min-width: 0; }
        .building-name { font-family: 'Jua', sans-serif; font-size: 0.95rem; margin-bottom: 3px; }
        .building-desc { font-size: 0.72rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .building-price {
            font-family: 'Jua', sans-serif;
            font-size: 0.95rem;
            padding: 5px 12px;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .building-item.time .building-price { color: var(--accent-time); }
        .building-item.space .building-price { color: var(--accent-space); }
        .building-item.social .building-price { color: var(--accent-social); }
        .building-item.ethics .building-price { color: var(--accent-ethics); }

        /* ========== ì§€ë„ íŒ¨ë„ ========== */
        .map-panel {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .slot-info { 
            font-size: 0.85rem; 
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .slot-info strong { 
            color: var(--accent-space); 
            font-family: 'Jua', sans-serif; 
            font-size: 1.1rem; 
        }

        .map-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            padding: 10px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            line-height: 1.4;
            text-align: center;
        }

        .mars-map {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(255, 150, 100, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(200, 100, 50, 0.2) 0%, transparent 40%),
                linear-gradient(135deg, var(--mars-surface) 0%, var(--mars-dark) 100%);
            border-radius: 50%;
            border: 4px solid rgba(255, 200, 150, 0.3);
            box-shadow: 0 0 60px rgba(193, 68, 14, 0.5), inset 0 0 60px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        .city-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            border: 2px solid rgba(78, 205, 196, 0.4);
        }

        .city-slot {
            width: 58px;
            height: 58px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            color: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .city-slot.filled {
            border-style: solid;
            cursor: default;
            animation: buildIn 0.4s ease;
        }

        @keyframes buildIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .city-slot.filled.time { border-color: var(--accent-time); background: rgba(255, 107, 107, 0.35); }
        .city-slot.filled.space { border-color: var(--accent-space); background: rgba(78, 205, 196, 0.35); }
        .city-slot.filled.social { border-color: var(--accent-social); background: rgba(255, 230, 109, 0.35); }
        .city-slot.filled.ethics { border-color: var(--accent-ethics); background: rgba(196, 77, 255, 0.35); }

        .city-slot .slot-icon { font-size: 1.25rem; margin-bottom: 2px; }

        .city-slot.filled.time .slot-icon { color: var(--accent-time); }
        .city-slot.filled.space .slot-icon { color: var(--accent-space); }
        .city-slot.filled.social .slot-icon { color: var(--accent-social); }
        .city-slot.filled.ethics .slot-icon { color: var(--accent-ethics); }

        .city-slot .slot-name {
            font-size: 0.5rem;
            text-align: center;
            line-height: 1.1;
            color: var(--text-primary);
            max-width: 90%;
            overflow: hidden;
        }

        .city-slot .remove-slot {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 18px;
            height: 18px;
            background: var(--accent-time);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 0.6rem;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .city-slot.filled:hover .remove-slot { opacity: 1; }

        /* íˆ¬ì í˜„í™© */
        .invest-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .invest-item {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .invest-item.time { background: rgba(255, 107, 107, 0.15); border: 1px solid rgba(255, 107, 107, 0.3); }
        .invest-item.space { background: rgba(78, 205, 196, 0.15); border: 1px solid rgba(78, 205, 196, 0.3); }
        .invest-item.social { background: rgba(255, 230, 109, 0.15); border: 1px solid rgba(255, 230, 109, 0.3); }
        .invest-item.ethics { background: rgba(196, 77, 255, 0.15); border: 1px solid rgba(196, 77, 255, 0.3); }

        .invest-label { font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 3px; }
        .invest-value { font-family: 'Jua', sans-serif; font-size: 1rem; }

        .invest-item.time .invest-value { color: var(--accent-time); }
        .invest-item.space .invest-value { color: var(--accent-space); }
        .invest-item.social .invest-value { color: var(--accent-social); }
        .invest-item.ethics .invest-value { color: var(--accent-ethics); }

        /* ========== ì•¡ì…˜ ë²„íŠ¼ ========== */
        .action-section {
            margin-bottom: 25px;
        }

        .action-guide {
            text-align: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 14px 35px;
            border: none;
            border-radius: 12px;
            font-family: 'Jua', sans-serif;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .generate-btn { background: linear-gradient(135deg, var(--accent-space), var(--accent-ethics)); color: white; }
        .reset-btn { background: transparent; border: 2px solid var(--accent-time) !important; color: var(--accent-time); }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); }

        /* í”¼ë“œë°± */
        .feedback {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 25px;
            border-radius: 10px;
            font-family: 'Jua', sans-serif;
            font-size: 1rem;
            z-index: 1000;
            animation: slideUp 0.3s ease;
            max-width: 90%;
            text-align: center;
        }

        @keyframes slideUp {
            0% { transform: translate(-50%, 50px); opacity: 0; }
            100% { transform: translate(-50%, 0); opacity: 1; }
        }

        .feedback.success { background: linear-gradient(135deg, #00c853, #00e676); color: #000; }
        .feedback.warning { background: linear-gradient(135deg, #ff9800, #ffb74d); color: #000; }
        .feedback.error { background: linear-gradient(135deg, #f44336, #e57373); color: white; }

        /* í‘¸í„° */
        .footer {
            text-align: center;
            padding: 15px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .footer a { color: var(--accent-space); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        /* ========== ë³´ê³ ì„œ ëª¨ë‹¬ ========== */
        .report-modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
        }

        .report-modal.active { display: block; }

        .report-wrapper {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .report-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .close-btn { background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; }

        .print-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, var(--accent-space), var(--accent-ethics));
            border: none;
            border-radius: 8px;
            font-family: 'Jua', sans-serif;
            font-size: 1rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .print-btn:hover { transform: scale(1.03); }

        .report-page {
            background: white;
            color: #222;
            padding: 40px 45px;
            margin-bottom: 20px;
            border-radius: 8px;
            position: relative;
        }

        .report-page::after {
            content: attr(data-page);
            position: absolute;
            bottom: 20px;
            right: 40px;
            font-size: 0.8rem;
            color: #aaa;
        }

        .report-header-section {
            text-align: center;
            padding-bottom: 25px;
            border-bottom: 3px solid #222;
            margin-bottom: 25px;
        }

        .report-main-title {
            font-family: 'Jua', sans-serif;
            font-size: 1.7rem;
            color: #111;
            margin-bottom: 5px;
        }

        .report-sub-title {
            font-size: 0.85rem;
            color: #777;
            margin-bottom: 18px;
        }

        .student-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            background: #f7f7f7;
            padding: 15px;
            border-radius: 8px;
        }

        .student-box { text-align: center; }
        .student-label { font-size: 0.75rem; color: #999; margin-bottom: 3px; }
        .student-value { font-family: 'Jua', sans-serif; font-size: 1.1rem; border-bottom: 2px solid #333; padding-bottom: 4px; }

        .section-header {
            font-family: 'Jua', sans-serif;
            font-size: 1.1rem;
            color: #333;
            margin: 25px 0 15px;
            padding: 10px 15px;
            background: #f5f5f5;
            border-left: 4px solid #333;
            border-radius: 0 6px 6px 0;
        }

        .report-map-wrap {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .report-mars {
            width: 260px;
            height: 260px;
            background: linear-gradient(135deg, #d4a373, #bc6c25);
            border-radius: 50%;
            position: relative;
            border: 4px solid #a67c52;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }

        .report-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
        }

        .report-cell {
            width: 42px;
            height: 42px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: white;
        }

        .report-cell.time { background: #e74c3c; }
        .report-cell.space { background: #1abc9c; }
        .report-cell.social { background: #f1c40f; color: #333; }
        .report-cell.ethics { background: #9b59b6; }

        .report-cell-label { font-size: 0.42rem; margin-top: 2px; line-height: 1; }

        .invest-chart { margin: 20px 0; }

        .chart-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .chart-name { width: 90px; font-size: 0.85rem; color: #555; }

        .chart-bar-outer {
            flex: 1;
            height: 24px;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin: 0 12px;
        }

        .chart-bar-inner {
            height: 100%;
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            transition: width 0.5s ease;
        }

        .chart-bar-inner.time { background: #e74c3c; }
        .chart-bar-inner.space { background: #1abc9c; }
        .chart-bar-inner.social { background: #f1c40f; color: #333; }
        .chart-bar-inner.ethics { background: #9b59b6; }

        .chart-amount { width: 60px; text-align: right; font-family: 'Jua', sans-serif; font-size: 0.9rem; color: #333; }

        .building-tags-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .b-tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .b-tag.time { background: #fce4e4; color: #c0392b; border: 1px solid #e74c3c; }
        .b-tag.space { background: #d5f5f0; color: #16a085; border: 1px solid #1abc9c; }
        .b-tag.social { background: #fef9e7; color: #9a7b0a; border: 1px solid #f1c40f; }
        .b-tag.ethics { background: #f4ecf7; color: #7d3c98; border: 1px solid #9b59b6; }

        .balance-score-section {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .balance-title { font-family: 'Jua', sans-serif; font-size: 1.05rem; margin-bottom: 12px; color: #333; }

        .balance-visual {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 18px;
            height: 85px;
            margin-bottom: 12px;
        }

        .balance-bar-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 55px;
        }

        .balance-bar {
            width: 38px;
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
        }

        .balance-bar.time { background: #e74c3c; }
        .balance-bar.space { background: #1abc9c; }
        .balance-bar.social { background: #f1c40f; }
        .balance-bar.ethics { background: #9b59b6; }

        .balance-bar-label { font-size: 0.7rem; color: #777; margin-top: 5px; }

        .balance-grade {
            font-family: 'Jua', sans-serif;
            font-size: 2rem;
            margin: 12px 0 6px;
        }

        .balance-grade.A { color: #27ae60; }
        .balance-grade.B { color: #3498db; }
        .balance-grade.C { color: #f39c12; }
        .balance-grade.D { color: #e74c3c; }

        .balance-desc { font-size: 0.85rem; color: #666; }

        .diagnosis-cards { margin: 12px 0; }

        .d-card {
            padding: 15px 18px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 5px solid;
        }

        .d-card.good { background: #eafaf1; border-color: #27ae60; }
        .d-card.bad { background: #fdedec; border-color: #e74c3c; }

        .d-card-title {
            font-family: 'Jua', sans-serif;
            font-size: 1rem;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .d-card.good .d-card-title { color: #1e8449; }
        .d-card.bad .d-card-title { color: #c0392b; }

        .d-card-text { font-size: 0.85rem; color: #555; line-height: 1.6; }

        .reflection-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .reflection-section p {
            font-size: 0.9rem;
            color: #444;
            line-height: 1.8;
        }

        .reflection-section strong.t { color: #c0392b; }
        .reflection-section strong.s { color: #16a085; }
        .reflection-section strong.c { color: #9a7b0a; }
        .reflection-section strong.e { color: #7d3c98; }

        .report-footer-section {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid #ddd;
            font-size: 0.8rem;
            color: #999;
        }

        @media print {
            body { background: white; }
            .stars, .report-controls { display: none !important; }
            .report-modal { position: static; background: white; overflow: visible; }
            .report-wrapper { max-width: 100%; padding: 0; margin: 0; }
            .report-page { box-shadow: none; margin: 0; padding: 30px 35px; page-break-after: always; }
            .report-page:last-child { page-break-after: avoid; }
        }

        @media (max-width: 600px) {
            .student-grid { grid-template-columns: repeat(2, 1fr); }
            .report-page { padding: 25px; }
            .balance-visual { gap: 12px; }
            .balance-bar-wrap { width: 45px; }
        }
/* ì „ì²´í™”ë©´ ì´íƒˆ ê²½ê³  */
.fs-warning-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.92);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem;animation:fadeIn .3s}
.fs-warning-overlay .warn-icon{font-size:4rem}
.fs-warning-overlay .warn-title{font-size:1.5rem;font-weight:900;color:#fbbf24}
.fs-warning-overlay .warn-msg{font-size:1rem;color:#94a3b8;text-align:center;max-width:320px;line-height:1.6}
.fs-warning-overlay .warn-btn{padding:14px 40px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border:none;border-radius:12px;color:#fff;font-size:1.1rem;font-weight:700;cursor:pointer;transition:transform .2s}
.fs-warning-overlay .warn-btn:hover{transform:scale(1.05)}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.blog-badge{position:fixed;bottom:12px;right:12px;z-index:100;background:rgba(15,23,42,0.85);border:1px solid #334155;border-radius:10px;padding:6px 14px;font-size:0.75rem;color:#94a3b8;text-decoration:none;backdrop-filter:blur(8px);transition:all .3s;display:flex;align-items:center;gap:6px}
.blog-badge:hover{background:rgba(59,130,246,0.2);border-color:#3b82f6;color:#60a5fa}
    </style>
</head>
<body>
    <div class="stars"></div>

    <div class="container">
        <!-- ===== í—¤ë” ===== -->
        <header class="header">
            <h1>ğŸš€ í™”ì„± ì´ì£¼ ë„ì‹œ ì„¤ê³„ ì‹œë®¬ë ˆì´ì…˜</h1>
            <p class="header-subtitle">ì¸ë¥˜ì˜ ìƒˆë¡œìš´ ë³´ê¸ˆìë¦¬, ë‹¹ì‹ ì´ ì´ì±…ì„ìì…ë‹ˆë‹¤! ğŸ‘¨â€ğŸš€ğŸ‘©â€ğŸš€</p>
            
            <div class="standards-box">
                <div class="standards-title">ğŸ“š 2022 ê°œì • êµìœ¡ê³¼ì • ì„±ì·¨ê¸°ì¤€</div>
                <div class="standard-item">
                    <span class="standard-code">[10í†µì‚¬01-01]</span> ì¸ê°„, ì‚¬íšŒ, í™˜ê²½ì„ ë°”ë¼ë³´ëŠ” <strong>ì‹œê°„ì , ê³µê°„ì , ì‚¬íšŒì , ìœ¤ë¦¬ì  ê´€ì </strong>ì˜ ì˜ë¯¸ì™€ íŠ¹ì§•ì„ ì‚¬ë¡€ë¥¼ í†µí•´ íŒŒì•…í•œë‹¤.
                </div>
                <div class="standard-item">
                    <span class="standard-code">[10í†µì‚¬01-02]</span> ì¸ê°„, ì‚¬íšŒ, í™˜ê²½ì˜ íƒêµ¬ì— <strong>í†µí•©ì  ê´€ì </strong>ì´ ìš”ì²­ë˜ëŠ” ì´ìœ ë¥¼ ë„ì¶œí•˜ê³  ì´ë¥¼ íƒêµ¬ì— ì ìš©í•œë‹¤.
                </div>
            </div>
        </header>

        <!-- ===== ë¯¸ì…˜ ê°€ì´ë“œ ===== -->
        <div class="guide-box">
            <span class="guide-icon">ğŸ¯</span>
            <div class="guide-content">
                <h3>ë¯¸ì…˜ ì•ˆë‚´</h3>
                <p>ì—¬ëŸ¬ë¶„ì€ í™”ì„± ì´ì£¼ ë„ì‹œì˜ ì´ì±…ì„ìì…ë‹ˆë‹¤! ğŸ’° <strong>100ì–µ ì›</strong>ì˜ ì˜ˆì‚°ìœ¼ë¡œ <strong>16ê°œ êµ¬ì—­</strong>ì— ë„ì‹œë¥¼ ê±´ì„¤í•˜ì„¸ìš”. ì‹œê°„Â·ê³µê°„Â·ì‚¬íšŒÂ·ìœ¤ë¦¬ <strong>ë„¤ ê°€ì§€ ê´€ì </strong>ì„ ê· í˜• ìˆê²Œ ê³ ë ¤í•´ì•¼ ì§€ì† ê°€ëŠ¥í•œ ë„ì‹œê°€ ì™„ì„±ë©ë‹ˆë‹¤!</p>
            </div>
        </div>

        <!-- ===== ì‚¬ìš©ì ì •ë³´ ===== -->
        <div class="user-section">
            <div class="section-label">âœï¸ ë‚´ ì •ë³´ ì…ë ¥</div>
            <div class="user-info-grid">
                <div class="input-group">
                    <span class="input-label">ğŸ“Œ í•™ë…„ì„ ì…ë ¥í•˜ì„¸ìš”</span>
                    <input type="text" id="userGrade" placeholder="ì˜ˆ: 1" maxlength="1">
                </div>
                <div class="input-group">
                    <span class="input-label">ğŸ“Œ ë°˜ì„ ì…ë ¥í•˜ì„¸ìš”</span>
                    <input type="text" id="userClass" placeholder="ì˜ˆ: 3" maxlength="2">
                </div>
                <div class="input-group">
                    <span class="input-label">ğŸ“Œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span>
                    <input type="text" id="userNumber" placeholder="ì˜ˆ: 15" maxlength="2">
                </div>
                <div class="input-group">
                    <span class="input-label">ğŸ“Œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</span>
                    <input type="text" id="userName" placeholder="ì˜ˆ: í™ê¸¸ë™">
                </div>
            </div>
        </div>

        <!-- ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ ===== -->
        <div class="main-layout">
            <!-- ì™¼ìª½: ê±´ë¬¼ íŒ¨ë„ -->
            <div class="building-panel">
                <div class="panel-header">
                    <h2 class="panel-title">ğŸ—ï¸ ê±´ì„¤ ê°€ëŠ¥ ì‹œì„¤</h2>
                </div>
                
                <div class="panel-desc">
                    ğŸ’¡ <strong>ê° ê´€ì ë³„ 10ê°œì”© ì´ 40ê°œ</strong>ì˜ ì‹œì„¤ ì¤‘ì—ì„œ ì„ íƒí•˜ì„¸ìš”! íƒ­ì„ ëˆŒëŸ¬ ê´€ì ì„ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”. ì‹œì„¤ì„ í´ë¦­í•˜ë©´ ì˜¤ë¥¸ìª½ ì§€ë„ì— ê±´ì„¤ë©ë‹ˆë‹¤.
                </div>

                <!-- ì˜ˆì‚° ë°” -->
                <div class="budget-bar-wrapper">
                    <div class="budget-header">
                        <span class="budget-label">ğŸ’° ì”ì—¬ ì˜ˆì‚°</span>
                        <span class="budget-amount" id="budgetDisplay">100ì–µ ì›</span>
                    </div>
                    <div class="budget-bar-bg">
                        <div class="budget-bar-fill" id="budgetBar" style="width: 100%"></div>
                    </div>
                </div>

                <!-- ê´€ì  íƒ­ -->
                <div class="perspective-tabs">
                    <button class="tab-btn time active" data-perspective="time">
                        <span class="tab-emoji">â°</span>
                        <span>ì‹œê°„ì </span>
                    </button>
                    <button class="tab-btn space" data-perspective="space">
                        <span class="tab-emoji">ğŸŒ</span>
                        <span>ê³µê°„ì </span>
                    </button>
                    <button class="tab-btn social" data-perspective="social">
                        <span class="tab-emoji">ğŸ‘¥</span>
                        <span>ì‚¬íšŒì </span>
                    </button>
                    <button class="tab-btn ethics" data-perspective="ethics">
                        <span class="tab-emoji">âš–ï¸</span>
                        <span>ìœ¤ë¦¬ì </span>
                    </button>
                </div>

                <!-- ê±´ë¬¼ ëª©ë¡ -->
                <div class="building-list" id="buildingList"></div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì§€ë„ íŒ¨ë„ -->
            <div class="map-panel">
                <div class="map-header">
                    <h2 class="panel-title">ğŸ—ºï¸ ë‚˜ì˜ í™”ì„± ë„ì‹œ</h2>
                    <div class="slot-info">ğŸ  <strong id="slotCount">0</strong> / 16 êµ¬ì—­</div>
                </div>

                <div class="map-desc">
                    ğŸ‘† ê±´ì„¤ëœ ì‹œì„¤ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ âŒ ë²„íŠ¼ìœ¼ë¡œ ì² ê±°í•  ìˆ˜ ìˆì–´ìš”!
                </div>

                <div class="mars-map">
                    <div class="city-grid" id="cityGrid"></div>
                </div>

                <div class="invest-summary">
                    <div class="invest-item time">
                        <div class="invest-label">â° ì‹œê°„ì </div>
                        <div class="invest-value" id="timeInvest">0ì–µ</div>
                    </div>
                    <div class="invest-item space">
                        <div class="invest-label">ğŸŒ ê³µê°„ì </div>
                        <div class="invest-value" id="spaceInvest">0ì–µ</div>
                    </div>
                    <div class="invest-item social">
                        <div class="invest-label">ğŸ‘¥ ì‚¬íšŒì </div>
                        <div class="invest-value" id="socialInvest">0ì–µ</div>
                    </div>
                    <div class="invest-item ethics">
                        <div class="invest-label">âš–ï¸ ìœ¤ë¦¬ì </div>
                        <div class="invest-value" id="ethicsInvest">0ì–µ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== ì•¡ì…˜ ë²„íŠ¼ ===== -->
        <div class="action-section">
            <p class="action-guide">ğŸ‰ ë„ì‹œ ê±´ì„¤ì´ ì™„ë£Œë˜ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§„ë‹¨ ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ì„¸ìš”!</p>
            <div class="action-buttons">
                <button class="action-btn generate-btn" id="generateReport">ğŸ“Š CSI ë³´ê³ ì„œ ìƒì„±</button>
                <button class="action-btn reset-btn" id="resetCity">ğŸ”„ ë„ì‹œ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- ===== í‘¸í„° ===== -->
        <footer class="footer">
            <p>ì œì‘: <a href="https://kstephullab.com" target="_blank">í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ (kstephullab.com)</a> ğŸŒŸ</p>
        </footer>
    </div>

    <div class="feedback" id="feedback" style="display: none;"></div>

    <!-- ===== ë³´ê³ ì„œ ëª¨ë‹¬ ===== -->
    <div class="report-modal" id="reportModal">
        <div class="report-wrapper">
            <div class="report-controls">
                <button class="close-btn" id="closeModal">âœ–ï¸</button>
                <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ PDF ì €ì¥ / ì¸ì‡„</button>
            </div>
            <div id="reportPages"></div>
        </div>
    </div>

    <script>
        // ===================== ê±´ë¬¼ ë°ì´í„° (ê´€ì ë³„ 10ê°œì”© ì´ 40ê°œ) =====================
        const buildings = {
            time: [
                { id: 't01', name: 'ğŸ›ï¸ í™”ì„± ì—­ì‚¬ ë°•ë¬¼ê´€', icon: 'fa-landmark', price: 7, desc: 'ì§€êµ¬ ë¬¸ëª…ì˜ ê¸°ì–µì„ ë³´ì¡´í•˜ê³  í™”ì„± ê°œì²™ ì—­ì‚¬ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.' },
                { id: 't02', name: 'â³ íƒ€ì„ìº¡ìŠ ì„¼í„°', icon: 'fa-hourglass-half', price: 5, desc: 'í›„ì†ë“¤ì—ê²Œ ì „í•  ë©”ì‹œì§€ì™€ ìœ ì‚°ì„ ë³´ê´€í•©ë‹ˆë‹¤.' },
                { id: 't03', name: 'ğŸ’¾ ì§€êµ¬ ë³µì› ë°ì´í„° ì„¼í„°', icon: 'fa-database', price: 9, desc: 'ì§€êµ¬ì˜ ëª¨ë“  ìƒíƒœê³„, ë¬¸í™” ë°ì´í„°ë¥¼ ë°±ì—…í•©ë‹ˆë‹¤.' },
                { id: 't04', name: 'ğŸ”® ë¯¸ë˜ ì˜ˆì¸¡ ì—°êµ¬ì†Œ', icon: 'fa-crystal-ball', price: 8, desc: 'AIë¡œ í™”ì„±ì˜ 100ë…„ í›„ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.' },
                { id: 't05', name: 'ğŸ¦´ ê³ ê³ í•™ ì—°êµ¬ì†Œ', icon: 'fa-bone', price: 6, desc: 'í™”ì„±ì˜ ì§€ì§ˆí•™ì  ì—­ì‚¬ì™€ ìƒëª…ì²´ í”ì ì„ íƒêµ¬í•©ë‹ˆë‹¤.' },
                { id: 't06', name: 'ğŸ“¦ ì„¸ëŒ€ ê¸°ë¡ ë³´ê´€ì†Œ', icon: 'fa-archive', price: 4, desc: 'ì´ì£¼ 1ì„¸ëŒ€ë¶€í„° ëª¨ë“  ì„¸ëŒ€ì˜ ì‚¶ì„ ê¸°ë¡í•©ë‹ˆë‹¤.' },
                { id: 't07', name: 'ğŸ¬ ë¬¸í™”ìœ ì‚° ë””ì§€í„¸ ì•„ì¹´ì´ë¸Œ', icon: 'fa-photo-video', price: 6, desc: 'ì§€êµ¬ì˜ ì˜ˆìˆ , ìŒì•…, ë¬¸í•™ì„ ë””ì§€í„¸ë¡œ ë³´ì¡´í•©ë‹ˆë‹¤.' },
                { id: 't08', name: 'ğŸ“… 100ë…„ ê³„íš ìœ„ì›íšŒ', icon: 'fa-calendar-alt', price: 7, desc: 'ì¥ê¸°ì  ê´€ì ì—ì„œ ë„ì‹œ ë°œì „ ë¡œë“œë§µì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.' },
                { id: 't09', name: 'ğŸŒ³ ì§€êµ¬ ê¸°ë… ê³µì›', icon: 'fa-tree', price: 5, desc: 'ê³ í–¥ ì§€êµ¬ë¥¼ ê¸°ì–µí•˜ëŠ” ì¶”ëª¨ì™€ êµìœ¡ì˜ ê³µê°„ì…ë‹ˆë‹¤.' },
                { id: 't10', name: 'ğŸ”­ ì‹œê°„ ì—°êµ¬ ì²œë¬¸ëŒ€', icon: 'fa-telescope', price: 8, desc: 'ìš°ì£¼ì˜ ì‹œê°„ê³¼ í™”ì„±ì˜ ì‹œê°„ ì²´ê³„ë¥¼ ì—°êµ¬í•©ë‹ˆë‹¤.' }
            ],
            space: [
                { id: 's01', name: 'ğŸ’¨ ì‚°ì†Œ ìƒì„± ë”', icon: 'fa-wind', price: 10, desc: 'ê´‘í•©ì„±ê³¼ ì „ê¸°ë¶„í•´ë¡œ ìˆ¨ ì‰´ ê³µê¸°ë¥¼ ë§Œë“­ë‹ˆë‹¤.' },
                { id: 's02', name: 'ğŸ’§ ì§€í•˜ ìˆ˜ë¡œ ì‹œìŠ¤í…œ', icon: 'fa-water', price: 8, desc: 'í™”ì„± ì–¼ìŒì¸µì—ì„œ ë¬¼ì„ ì¶”ì¶œí•´ ê³µê¸‰í•©ë‹ˆë‹¤.' },
                { id: 's03', name: 'ğŸ›¡ï¸ ìê¸°ì¥ ë°©ì–´ë§‰', icon: 'fa-shield-alt', price: 9, desc: 'íƒœì–‘í’ê³¼ ë°©ì‚¬ì„ ìœ¼ë¡œë¶€í„° ë„ì‹œë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤.' },
                { id: 's04', name: 'ğŸŒ± í…Œë¼í¬ë° ì—°êµ¬ì†Œ', icon: 'fa-seedling', price: 8, desc: 'í™”ì„± ëŒ€ê¸°ë¥¼ ì§€êµ¬ì²˜ëŸ¼ ë°”ê¾¸ëŠ” ì—°êµ¬ë¥¼ í•©ë‹ˆë‹¤.' },
                { id: 's05', name: 'ğŸŒ¤ï¸ í™”ì„± ê¸°ìƒ ê´€ì¸¡ì†Œ', icon: 'fa-cloud-sun', price: 5, desc: 'ê¸°ìƒ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.' },
                { id: 's06', name: 'ğŸ  ì§€í•˜ ì£¼ê±° ë‹¨ì§€', icon: 'fa-home', price: 7, desc: 'ë°©ì‚¬ì„ ì„ í”¼í•´ ì•ˆì „í•˜ê²Œ ê±°ì£¼í•  ìˆ˜ ìˆëŠ” ê³µê°„ì…ë‹ˆë‹¤.' },
                { id: 's07', name: 'ğŸ¥¬ ìˆ˜ì§ ë†ì¥ ì˜¨ì‹¤', icon: 'fa-leaf', price: 6, desc: 'ì‹ëŸ‰ ìê¸‰ìì¡±ì„ ìœ„í•œ ì‹¤ë‚´ ë†ì—… ì‹œì„¤ì…ë‹ˆë‹¤.' },
                { id: 's08', name: 'â˜€ï¸ íƒœì–‘ê´‘ ë°œì „ì†Œ', icon: 'fa-solar-panel', price: 7, desc: 'í™”ì„±ì˜ íƒœì–‘ ì—ë„ˆì§€ë¥¼ ì „ê¸°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.' },
                { id: 's09', name: 'ğŸšï¸ ë¨¼ì§€ í­í’ ëŒ€í”¼ì†Œ', icon: 'fa-house-damage', price: 5, desc: 'ê±°ëŒ€ ë¨¼ì§€ í­í’ ì‹œ ì‹œë¯¼ë“¤ì´ ëŒ€í”¼í•˜ëŠ” ì‹œì„¤ì…ë‹ˆë‹¤.' },
                { id: 's10', name: 'ğŸ‘” ìš°ì£¼ë³µ ì œì‘ì†Œ', icon: 'fa-tshirt', price: 6, desc: 'ì•¼ì™¸ í™œë™ì— í•„ìˆ˜ì ì¸ ìš°ì£¼ë³µì„ ìƒì‚°í•©ë‹ˆë‹¤.' }
            ],
            social: [
                { id: 'c01', name: 'âš–ï¸ í™”ì„± í—Œë²• ì¬íŒì†Œ', icon: 'fa-gavel', price: 7, desc: 'í—Œë²•ì„ ìˆ˜í˜¸í•˜ê³  ë²•ì  ë¶„ìŸì„ í•´ê²°í•©ë‹ˆë‹¤.' },
                { id: 'c02', name: 'ğŸ›ï¸ ìì¹˜ ì˜íšŒ', icon: 'fa-university', price: 6, desc: 'ì‹œë¯¼ ì˜ê²¬ì„ ëª¨ì•„ ì •ì±…ì„ ê²°ì •í•©ë‹ˆë‹¤.' },
                { id: 'c03', name: 'ğŸ“ ìš°ì£¼ í•™êµ', icon: 'fa-graduation-cap', price: 7, desc: 'í™”ì„± ì•„ì´ë“¤ì—ê²Œ êµìœ¡ ê¸°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤.' },
                { id: 'c04', name: 'ğŸ“¡ í™”ì„± ë°©ì†¡êµ­', icon: 'fa-broadcast-tower', price: 4, desc: 'ë‰´ìŠ¤ì™€ ì •ë³´ë¡œ ì‹œë¯¼ ì‚¬íšŒë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.' },
                { id: 'c05', name: 'ğŸ‘® í™”ì„± ê²½ì°°ì„œ', icon: 'fa-shield-halved', price: 6, desc: 'ë„ì‹œì˜ ì¹˜ì•ˆì„ ìœ ì§€í•˜ê³  ì‹œë¯¼ì„ ë³´í˜¸í•©ë‹ˆë‹¤.' },
                { id: 'c06', name: 'ğŸš’ í™”ì„± ì†Œë°©ì„œ', icon: 'fa-fire-extinguisher', price: 5, desc: 'í™”ì¬ì™€ ì¬ë‚œì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•©ë‹ˆë‹¤.' },
                { id: 'c07', name: 'ğŸ¥ ì¢…í•© ë³‘ì›', icon: 'fa-hospital', price: 8, desc: 'ì‹œë¯¼ì˜ ê±´ê°•ì„ ì±…ì„ì§€ëŠ” ì˜ë£Œ ì‹œì„¤ì…ë‹ˆë‹¤.' },
                { id: 'c08', name: 'ğŸ“š í™”ì„± ë„ì„œê´€', icon: 'fa-book-open', price: 5, desc: 'ì§€ì‹ê³¼ ì •ë³´ì— ììœ ë¡­ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
                { id: 'c09', name: 'ğŸ­ ì‹œë¯¼ ë¬¸í™”ì„¼í„°', icon: 'fa-theater-masks', price: 6, desc: 'ì˜ˆìˆ ê³¼ ë¬¸í™” í™œë™ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹° ê³µê°„ì…ë‹ˆë‹¤.' },
                { id: 'c10', name: 'âš½ ì²´ìœ¡ ê²½ê¸°ì¥', icon: 'fa-futbol', price: 7, desc: 'ê±´ê°•í•œ ì—¬ê°€ì™€ ìŠ¤í¬ì¸  í™œë™ì„ ìœ„í•œ ì‹œì„¤ì…ë‹ˆë‹¤.' }
            ],
            ethics: [
                { id: 'e01', name: 'â¤ï¸ ì´ì£¼ë¯¼ ë³µì§€ ì„¼í„°', icon: 'fa-heart', price: 5, desc: 'ì´ì£¼ë¯¼ ì ì‘ì„ ë•ê³  ì‹¬ë¦¬ ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.' },
                { id: 'e02', name: 'ğŸ› ì™¸ê³„ ìƒíƒœê³„ ë³´í˜¸ì†Œ', icon: 'fa-bug', price: 8, desc: 'í™”ì„± ìƒëª…ì²´ ë°œê²¬ ì‹œ ë³´í˜¸í•©ë‹ˆë‹¤.' },
                { id: 'e03', name: 'âš–ï¸ ê³µì • ë°°ë¶„ ì„¼í„°', icon: 'fa-balance-scale-left', price: 4, desc: 'ì‹ëŸ‰, ë¬¼, ì‚°ì†Œë¥¼ ê³µì •í•˜ê²Œ ë°°ë¶„í•©ë‹ˆë‹¤.' },
                { id: 'e04', name: 'ğŸ’• ì„¸ëŒ€ ê°„ ì •ì˜ ìœ„ì›íšŒ', icon: 'fa-hand-holding-heart', price: 6, desc: 'ë¯¸ë˜ ì„¸ëŒ€ì˜ ê¶Œë¦¬ë¥¼ ëŒ€ë³€í•©ë‹ˆë‹¤.' },
                { id: 'e05', name: 'ğŸŒ ë‹¤ë¬¸í™” êµë¥˜ê´€', icon: 'fa-globe-americas', price: 5, desc: 'ë‹¤ì–‘í•œ ë¬¸í™”ì  ë°°ê²½ì˜ ì´ì£¼ë¯¼ í™”í•©ì„ ë•ìŠµë‹ˆë‹¤.' },
                { id: 'e06', name: 'â™¿ ì¥ì• ì¸ ì§€ì›ì„¼í„°', icon: 'fa-wheelchair', price: 6, desc: 'ì¥ì•  ì‹œë¯¼ë“¤ì˜ ìë¦½ê³¼ ì‚¬íšŒì°¸ì—¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.' },
                { id: 'e07', name: 'ğŸ‘ï¸ í™˜ê²½ ê°ì‹œë‹¨', icon: 'fa-eye', price: 5, desc: 'ìì› ë‚¨ìš©ê³¼ í™˜ê²½ íŒŒê´´ë¥¼ ê°ì‹œí•©ë‹ˆë‹¤.' },
                { id: 'e08', name: 'ğŸ›¡ï¸ ì¸ê¶Œ ì˜´ë¶€ì¦ˆë§¨', icon: 'fa-user-shield', price: 6, desc: 'ì‹œë¯¼ì˜ ê¸°ë³¸ê¶Œ ì¹¨í•´ë¥¼ ì¡°ì‚¬í•˜ê³  êµ¬ì œí•©ë‹ˆë‹¤.' },
                { id: 'e09', name: 'ğŸ¤ ë…¸ì¸ ëŒë´„ ì„¼í„°', icon: 'fa-hands-helping', price: 5, desc: 'ì–´ë¥´ì‹ ë“¤ì˜ ê±´ê°•ê³¼ ë³µì§€ë¥¼ ì±…ì„ì§‘ë‹ˆë‹¤.' },
                { id: 'e10', name: 'ğŸ¤² ë¶„ìŸ ì¡°ì • ì„¼í„°', icon: 'fa-handshake', price: 7, desc: 'ì‹œë¯¼ ê°„ ê°ˆë“±ì„ í‰í™”ì ìœ¼ë¡œ í•´ê²°í•©ë‹ˆë‹¤.' }
            ]
        };

        const MAX_SLOTS = 16;
        let budget = 100;
        let citySlots = new Array(MAX_SLOTS).fill(null);
        let currentPerspective = 'time';

        const feedbackMessages = {
            build: {
                time: ["â° ì—­ì‚¬ë¥¼ ê¸°ì–µí•˜ëŠ” í˜„ëª…í•œ ì„ íƒ!", "ğŸ“œ ê³¼ê±°ì™€ ë¯¸ë˜ë¥¼ ì‡ëŠ” ê²°ì •ì´ì—ìš”!"],
                space: ["ğŸ›¡ï¸ ìƒì¡´ ì¸í”„ë¼ í™•ë³´! ì‹¤ìš©ì ì´ì—ìš”!", "ğŸŒ± í™˜ê²½ ê·¹ë³µì˜ ì²«ê±¸ìŒ!"],
                social: ["ğŸ›ï¸ ì‚¬íšŒ ì œë„ì˜ ê¸°ë°˜ì„ ë‹¦ì•˜ì–´ìš”!", "âš–ï¸ ì§ˆì„œ ìˆëŠ” ê³µë™ì²´ë¥¼ ë§Œë“¤ì–´ê°€ë„¤ìš”!"],
                ethics: ["ğŸ’œ ì •ì˜ë¡­ê³  ë”°ëœ»í•œ ì„ íƒì´ì—ìš”!", "ğŸ¤ ì•½ìë¥¼ ë°°ë ¤í•˜ëŠ” í¬ìš©ì ì¸ ë„ì‹œ!"]
            },
            noMoney: ["ğŸ’¸ ì˜ˆì‚°ì´ ë¶€ì¡±í•´ìš”! ë‹¤ë¥¸ ê±´ë¬¼ì„ ì² ê±°í•´ë³¼ê¹Œìš”?", "ğŸ¦ ëˆì´ ì—†ì–´ìš”... ì² ê±°ë¡œ ì˜ˆì‚°ì„ í™•ë³´í•˜ì„¸ìš”!"],
            noSlot: ["ğŸš§ ê³µê°„ì´ ê°€ë“ ì°¼ì–´ìš”! (16êµ¬ì—­ ì™„ë£Œ)", "ğŸ—ºï¸ ë” ì´ìƒ ê±´ì„¤í•  ê³³ì´ ì—†ì–´ìš”!"],
            remove: ["ğŸ”¨ ì² ê±° ì™„ë£Œ! ì˜ˆì‚°ì´ ëŒì•„ì™”ì–´ìš”!", "â™»ï¸ ìì› íšŒìˆ˜ ì™„ë£Œ!"],
            reset: ["ğŸŒ‹ ë„ì‹œê°€ ì´ˆê¸°í™”ë˜ì—ˆì–´ìš”! ìƒˆ ì¶œë°œ!"]
        };

        const buildingListDiv = document.getElementById('buildingList');
        const cityGridDiv = document.getElementById('cityGrid');
        const budgetDisplay = document.getElementById('budgetDisplay');
        const budgetBar = document.getElementById('budgetBar');
        const feedbackDiv = document.getElementById('feedback');
        const reportModal = document.getElementById('reportModal');
        const reportPages = document.getElementById('reportPages');

        function init() {
            renderCityGrid();
            renderBuildings();
            updateStats();

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPerspective = btn.dataset.perspective;
                    renderBuildings();
                });
            });

            document.getElementById('generateReport').addEventListener('click', generateReport);
            document.getElementById('resetCity').addEventListener('click', resetCity);
            document.getElementById('closeModal').addEventListener('click', () => reportModal.classList.remove('active'));
        }

        function renderCityGrid() {
            cityGridDiv.innerHTML = '';
            for (let i = 0; i < MAX_SLOTS; i++) {
                const slot = document.createElement('div');
                slot.className = 'city-slot';
                slot.dataset.index = i;

                if (citySlots[i]) {
                    const b = citySlots[i];
                    slot.classList.add('filled', b.perspective);
                    slot.innerHTML = `
                        <i class="fas ${b.icon} slot-icon"></i>
                        <span class="slot-name">${b.name.replace(/^.+\s/, '').slice(0, 5)}</span>
                        <button class="remove-slot" onclick="removeBuilding(${i})"><i class="fas fa-times"></i></button>
                    `;
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = `<i class="fas fa-plus" style="opacity: 0.3;"></i>`;
                }

                cityGridDiv.appendChild(slot);
            }
        }

        function renderBuildings() {
            const list = buildings[currentPerspective];
            buildingListDiv.innerHTML = list.map(b => {
                const isBuilt = citySlots.some(s => s && s.id === b.id);
                const canAfford = budget >= b.price;
                const hasSlot = citySlots.some(s => s === null);
                const disabled = !canAfford || !hasSlot;
                const displayName = b.name.replace(/^(.+?)\s/, '$1 ');

                return `
                    <div class="building-item ${currentPerspective} ${isBuilt ? 'built' : ''} ${disabled && !isBuilt ? 'disabled' : ''}"
                         onclick="${!isBuilt && !disabled ? `buildBuilding('${b.id}')` : ''}">
                        <div class="building-icon-wrapper"><i class="fas ${b.icon}"></i></div>
                        <div class="building-info">
                            <div class="building-name">${displayName}</div>
                            <div class="building-desc">${b.desc}</div>
                        </div>
                        <div class="building-price">${b.price}ì–µ</div>
                    </div>
                `;
            }).join('');
        }

        function buildBuilding(buildingId) {
            // ì²« ê±´ì„¤ ì‹œ ì „ì²´í™”ë©´ ì§„ì…
            if(!document.fullscreenElement && !missionComplete){
              document.documentElement.requestFullscreen().catch(()=>{});
            }
            let building = null, perspective = null;
            for (const [key, list] of Object.entries(buildings)) {
                const found = list.find(b => b.id === buildingId);
                if (found) { building = found; perspective = key; break; }
            }
            if (!building) return;

            const emptyIndex = citySlots.findIndex(s => s === null);
            if (emptyIndex === -1) {
                showFeedback(feedbackMessages.noSlot[Math.floor(Math.random() * feedbackMessages.noSlot.length)], 'warning');
                return;
            }

            if (budget < building.price) {
                showFeedback(feedbackMessages.noMoney[Math.floor(Math.random() * feedbackMessages.noMoney.length)], 'warning');
                return;
            }

            budget -= building.price;
            citySlots[emptyIndex] = { ...building, perspective };

            showFeedback(feedbackMessages.build[perspective][Math.floor(Math.random() * feedbackMessages.build[perspective].length)], 'success');
            updateStats();
            renderCityGrid();
            renderBuildings();
        }

        function removeBuilding(index) {
            if (citySlots[index]) {
                budget += citySlots[index].price;
                citySlots[index] = null;
                showFeedback(feedbackMessages.remove[Math.floor(Math.random() * feedbackMessages.remove.length)], 'warning');
                updateStats();
                renderCityGrid();
                renderBuildings();
            }
        }

        function updateStats() {
            budgetDisplay.textContent = `${budget}ì–µ ì›`;
            budgetBar.style.width = `${budget}%`;

            const stats = { time: 0, space: 0, social: 0, ethics: 0 };
            let count = 0;
            citySlots.forEach(s => {
                if (s) { stats[s.perspective] += s.price; count++; }
            });

            document.getElementById('slotCount').textContent = count;
            document.getElementById('timeInvest').textContent = `${stats.time}ì–µ`;
            document.getElementById('spaceInvest').textContent = `${stats.space}ì–µ`;
            document.getElementById('socialInvest').textContent = `${stats.social}ì–µ`;
            document.getElementById('ethicsInvest').textContent = `${stats.ethics}ì–µ`;
        }

        function showFeedback(message, type) {
            feedbackDiv.textContent = message;
            feedbackDiv.className = `feedback ${type}`;
            feedbackDiv.style.display = 'block';
            setTimeout(() => feedbackDiv.style.display = 'none', 2500);
        }

        function resetCity() {
            if (citySlots.every(s => s === null)) return;
            if (confirm('ğŸ”„ ì •ë§ ë„ì‹œë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? ëª¨ë“  ê±´ë¬¼ì´ ì² ê±°ë©ë‹ˆë‹¤!')) {
                budget = 100;
                citySlots = new Array(MAX_SLOTS).fill(null);
                showFeedback(feedbackMessages.reset[0], 'warning');
                updateStats();
                renderCityGrid();
                renderBuildings();
            }
        }

        function generateReport() {
            const grade = document.getElementById('userGrade').value || '-';
            const cls = document.getElementById('userClass').value || '-';
            const num = document.getElementById('userNumber').value || '-';
            const name = document.getElementById('userName').value || 'ìµëª…';

            const builtBuildings = citySlots.filter(s => s !== null);
            if (builtBuildings.length === 0) {
                showFeedback('ğŸš« ê±´ì„¤ëœ ê±´ë¬¼ì´ ì—†ì–´ìš”! ë¨¼ì € ë„ì‹œë¥¼ ê±´ì„¤í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const stats = { time: 0, space: 0, social: 0, ethics: 0 };
            const counts = { time: 0, space: 0, social: 0, ethics: 0 };
            const names = { time: 'ì‹œê°„ì ', space: 'ê³µê°„ì ', social: 'ì‚¬íšŒì ', ethics: 'ìœ¤ë¦¬ì ' };
            const emojis = { time: 'â°', space: 'ğŸŒ', social: 'ğŸ‘¥', ethics: 'âš–ï¸' };

            builtBuildings.forEach(b => {
                stats[b.perspective] += b.price;
                counts[b.perspective]++;
            });

            const totalSpent = 100 - budget;
            const maxStat = Math.max(...Object.values(stats), 1);

            // ê· í˜• ì ìˆ˜ ê³„ì‚°
            const values = Object.values(stats);
            const avg = totalSpent / 4;
            const variance = values.reduce((sum, v) => sum + Math.pow(v - avg, 2), 0) / 4;
            const stdDev = Math.sqrt(variance);
            const maxStdDev = totalSpent / 2;
            const balanceScore = Math.max(0, 100 - (stdDev / maxStdDev) * 100);

            let balanceGrade, balanceDesc;
            if (balanceScore >= 80) {
                balanceGrade = 'A';
                balanceDesc = 'ğŸ‰ ë„¤ ê°€ì§€ ê´€ì ì„ ê· í˜• ìˆê²Œ ê³ ë ¤í•œ í†µí•©ì  ë„ì‹œì…ë‹ˆë‹¤!';
            } else if (balanceScore >= 60) {
                balanceGrade = 'B';
                balanceDesc = 'ğŸ‘ ëŒ€ì²´ë¡œ ê· í˜• ì¡í˜”ì§€ë§Œ, ì¼ë¶€ ê´€ì ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.';
            } else if (balanceScore >= 40) {
                balanceGrade = 'C';
                balanceDesc = 'âš ï¸ íŠ¹ì • ê´€ì ì— í¸ì¤‘ë˜ì–´ ìˆì–´ìš”. ë‹¤ì–‘ì„±ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.';
            } else {
                balanceGrade = 'D';
                balanceDesc = 'ğŸ˜¢ ê´€ì ì˜ ê· í˜•ì´ ë§ì´ ë¶€ì¡±í•´ìš”. ë‹¤ë¥¸ ê´€ì ë„ í•„ìš”í•©ë‹ˆë‹¤!';
            }

            const sorted = Object.entries(stats).sort((a, b) => b[1] - a[1]);
            const zeroList = sorted.filter(s => s[1] === 0);
            const nonZeroList = sorted.filter(s => s[1] > 0);

            // ì¥ì  2ê°œ
            const strengths = [];
            if (nonZeroList.length > 0) {
                const top = nonZeroList[0][0];
                const topPct = Math.round((stats[top] / totalSpent) * 100);
                const strengthTexts = {
                    time: `â° ì‹œê°„ì  ê´€ì ì— ${topPct}%ë¥¼ íˆ¬ìí–ˆìŠµë‹ˆë‹¤. ì—­ì‚¬ë¥¼ ê¸°ì–µí•˜ê³  ë¯¸ë˜ë¥¼ ì¤€ë¹„í•˜ëŠ” ì§€í˜œë¡œìš´ ë„ì‹œì…ë‹ˆë‹¤.`,
                    space: `ğŸŒ ê³µê°„ì  ê´€ì ì— ${topPct}%ë¥¼ íˆ¬ìí–ˆìŠµë‹ˆë‹¤. í™”ì„± í™˜ê²½ì„ ê·¹ë³µí•˜ê³  ì‹œë¯¼ì˜ ìƒì¡´ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.`,
                    social: `ğŸ‘¥ ì‚¬íšŒì  ê´€ì ì— ${topPct}%ë¥¼ íˆ¬ìí–ˆìŠµë‹ˆë‹¤. ë²•, êµìœ¡, ì§ˆì„œê°€ ì˜ ê°–ì¶°ì§„ ì•ˆì •ì ì¸ ë„ì‹œì…ë‹ˆë‹¤.`,
                    ethics: `âš–ï¸ ìœ¤ë¦¬ì  ê´€ì ì— ${topPct}%ë¥¼ íˆ¬ìí–ˆìŠµë‹ˆë‹¤. ê³µì •í•œ ë¶„ë°°ì™€ ì•½ì ë³´í˜¸ë¥¼ ì¤‘ì‹œí•˜ëŠ” ì •ì˜ë¡œìš´ ë„ì‹œì…ë‹ˆë‹¤.`
                };
                strengths.push({ title: `${emojis[top]} ${names[top]} ê´€ì  ìš°ìˆ˜ (${topPct}%)`, text: strengthTexts[top] });
            }

            if (nonZeroList.length >= 3) {
                strengths.push({ title: `ğŸ¯ ë‹¤ì–‘í•œ ê´€ì  ê³ ë ¤ (${nonZeroList.length}ê°œ ì˜ì—­)`, text: `${nonZeroList.length}ê°œì˜ ê´€ì ì— íˆ¬ìí•˜ì—¬ í•œìª½ì— ì¹˜ìš°ì¹˜ì§€ ì•Šì€ í†µí•©ì  ì‚¬ê³ ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.` });
            } else if (builtBuildings.length >= 12) {
                strengths.push({ title: `ğŸ™ï¸ í’ë¶€í•œ ì¸í”„ë¼ (${builtBuildings.length}ê°œ ì‹œì„¤)`, text: `${builtBuildings.length}ê°œì˜ ì‹œì„¤ì„ ê±´ì„¤í•˜ì—¬ ë„ì‹œ ê¸°ëŠ¥ì´ í’ë¶€í•©ë‹ˆë‹¤.` });
            } else if (budget <= 10) {
                strengths.push({ title: `ğŸ’° ì˜ˆì‚°ì˜ íš¨ìœ¨ì  ì‚¬ìš©`, text: `ì£¼ì–´ì§„ ì˜ˆì‚°ì„ ìµœëŒ€í•œ í™œìš©í•˜ì—¬ ë„ì‹œë¥¼ ê±´ì„¤í–ˆìŠµë‹ˆë‹¤.` });
            } else {
                strengths.push({ title: `ğŸ¯ ëª…í™•í•œ ìš°ì„ ìˆœìœ„ ì„¤ì •`, text: `íŠ¹ì • ê°€ì¹˜ì— ì§‘ì¤‘ íˆ¬ìí•˜ì—¬ ë„ì‹œì˜ ì •ì²´ì„±ì´ ëª…í™•í•©ë‹ˆë‹¤.` });
            }

            // ì•½ì  2ê°œ
            const weaknesses = [];
            if (zeroList.length > 0) {
                const missing = zeroList[0][0];
                const weakTexts = {
                    time: 'â° ì‹œê°„ì  ê´€ì ì— ì „í˜€ íˆ¬ìí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì—­ì‚¬ë¥¼ ìŠìœ¼ë©´ ê°™ì€ ì‹¤ìˆ˜ë¥¼ ë°˜ë³µí•  ìˆ˜ ìˆì–´ìš”!',
                    space: 'ğŸŒ ê³µê°„ì  ê´€ì ì— ì „í˜€ íˆ¬ìí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‚°ì†Œ, ë¬¼, ë°©ì‚¬ì„  ì°¨í ì—†ì´ í™”ì„±ì—ì„œ ìƒì¡´ì´ ì–´ë µìŠµë‹ˆë‹¤!',
                    social: 'ğŸ‘¥ ì‚¬íšŒì  ê´€ì ì— ì „í˜€ íˆ¬ìí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë²•ê³¼ ì§ˆì„œ ì—†ì´ ì‚¬íšŒëŠ” í˜¼ë€ì— ë¹ ì§ˆ ìˆ˜ ìˆì–´ìš”!',
                    ethics: 'âš–ï¸ ìœ¤ë¦¬ì  ê´€ì ì— ì „í˜€ íˆ¬ìí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê³µì •í•œ ë¶„ë°° ì—†ì´ ì‚¬íšŒì  ë¶ˆë§Œì´ í­ë°œí•  ìˆ˜ ìˆì–´ìš”!'
                };
                weaknesses.push({ title: `ğŸš¨ ${names[missing]} ê´€ì  ì™„ì „ ë¶€ì¬`, text: weakTexts[missing] });
            } else {
                const lowest = sorted[sorted.length - 1][0];
                const lowPct = Math.round((stats[lowest] / totalSpent) * 100);
                weaknesses.push({ title: `ğŸ“‰ ${names[lowest]} ê´€ì  ë¶€ì¡± (${lowPct}%)`, text: `${emojis[lowest]} ${names[lowest]} ê´€ì ì— ëŒ€í•œ íˆ¬ìê°€ ìƒëŒ€ì ìœ¼ë¡œ ë¶€ì¡±í•©ë‹ˆë‹¤. ì´ ì˜ì—­ì˜ ë³´ì™„ì´ í•„ìš”í•©ë‹ˆë‹¤.` });
            }

            if (nonZeroList.length > 0 && (stats[nonZeroList[0][0]] / totalSpent) > 0.5) {
                const topP = nonZeroList[0][0];
                const topPct = Math.round((stats[topP] / totalSpent) * 100);
                weaknesses.push({ title: `âš ï¸ ${names[topP]} ê´€ì  ê³¼ì‰ í¸ì¤‘ (${topPct}%)`, text: `í•˜ë‚˜ì˜ ê´€ì ì— ì ˆë°˜ ì´ìƒì˜ ì˜ˆì‚°ì´ ì§‘ì¤‘ë˜ì–´ ë‹¤ë¥¸ ê´€ì ì´ ìƒëŒ€ì ìœ¼ë¡œ ì†Œí™€í•´ì¡ŒìŠµë‹ˆë‹¤.` });
            } else if (zeroList.length >= 2) {
                const second = zeroList[1][0];
                weaknesses.push({ title: `ğŸš¨ ${names[second]} ê´€ì ë„ ë¶€ì¬`, text: `${emojis[second]} ${names[second]} ê´€ì ì—ë„ íˆ¬ìê°€ ì—†ìŠµë‹ˆë‹¤. ë‘ ê°œ ì´ìƒì˜ ê´€ì ì´ ë¹„ì–´ìˆì–´ ë„ì‹œì˜ ì§€ì†ê°€ëŠ¥ì„±ì´ ìš°ë ¤ë©ë‹ˆë‹¤.` });
            } else if (budget >= 20) {
                weaknesses.push({ title: `ğŸ’¸ ë¯¸ì‚¬ìš© ì˜ˆì‚° ${budget}ì–µ ì›`, text: `ì „ì²´ ì˜ˆì‚°ì˜ ${budget}%ê°€ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë” ë§ì€ ì‹œì„¤ë¡œ ë„ì‹œë¥¼ ë°œì „ì‹œí‚¬ ìˆ˜ ìˆì—ˆì–´ìš”!` });
            } else if (builtBuildings.length < 10) {
                weaknesses.push({ title: `ğŸšï¸ ì‹œì„¤ ìˆ˜ ë¶€ì¡± (${builtBuildings.length}ê°œ)`, text: `ê±´ì„¤ëœ ì‹œì„¤ì´ ì ì–´ ë„ì‹œ ê¸°ëŠ¥ì´ ì œí•œì ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì‹œì„¤ì´ í•„ìš”í•©ë‹ˆë‹¤.` });
            } else {
                weaknesses.push({ title: `ğŸ”— í†µí•©ì  ì‹œë„ˆì§€ ë¶€ì¡±`, text: `ê° ê´€ì  ê°„ì˜ ì—°ê³„ê°€ ì•½í•©ë‹ˆë‹¤. ì‹œê°„-ê³µê°„-ì‚¬íšŒ-ìœ¤ë¦¬ê°€ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.` });
            }

            const today = new Date();
            const dateStr = `${today.getFullYear()}.${String(today.getMonth() + 1).padStart(2, '0')}.${String(today.getDate()).padStart(2, '0')}`;

            const minimap = citySlots.map(s => {
                if (s) {
                    const shortName = s.name.replace(/^.+\s/, '').slice(0, 3);
                    return `<div class="report-cell ${s.perspective}"><i class="fas ${s.icon}"></i><span class="report-cell-label">${shortName}</span></div>`;
                }
                return `<div class="report-cell"></div>`;
            }).join('');

            const tags = builtBuildings.map(b => {
                const displayName = b.name.replace(/^(.+?)\s/, '');
                return `<span class="b-tag ${b.perspective}"><i class="fas ${b.icon}"></i> ${displayName}</span>`;
            }).join('');

            const maxHeight = 65;
            const barHeights = {
                time: totalSpent > 0 ? Math.max(5, (stats.time / totalSpent) * maxHeight) : 5,
                space: totalSpent > 0 ? Math.max(5, (stats.space / totalSpent) * maxHeight) : 5,
                social: totalSpent > 0 ? Math.max(5, (stats.social / totalSpent) * maxHeight) : 5,
                ethics: totalSpent > 0 ? Math.max(5, (stats.ethics / totalSpent) * maxHeight) : 5
            };

            const page1 = `
                <div class="report-page" data-page="1 / 2">
                    <div class="report-header-section">
                        <h1 class="report-main-title">ğŸ”¬ CSI í™”ì„± ë„ì‹œ ì§„ë‹¨ ë³´ê³ ì„œ</h1>
                        <p class="report-sub-title">Comprehensive Social Integration Diagnosis</p>
                        <div class="student-grid">
                            <div class="student-box"><div class="student-label">ğŸ“š í•™ë…„</div><div class="student-value">${grade}</div></div>
                            <div class="student-box"><div class="student-label">ğŸ« ë°˜</div><div class="student-value">${cls}</div></div>
                            <div class="student-box"><div class="student-label">ğŸ”¢ ë²ˆí˜¸</div><div class="student-value">${num}</div></div>
                            <div class="student-box"><div class="student-label">âœï¸ ì´ë¦„</div><div class="student-value">${name}</div></div>
                        </div>
                    </div>

                    <div class="section-header">ğŸ—ºï¸ ë‚˜ì˜ í™”ì„± ë„ì‹œ (${builtBuildings.length}ê°œ ì‹œì„¤ / 16êµ¬ì—­)</div>
                    <div class="report-map-wrap">
                        <div class="report-mars">
                            <div class="report-grid">${minimap}</div>
                        </div>
                    </div>

                    <div class="section-header">ğŸ“Š ê´€ì ë³„ íˆ¬ì í˜„í™© (ì´ ${totalSpent}ì–µ ì› ì‚¬ìš©)</div>
                    <div class="invest-chart">
                        <div class="chart-item">
                            <span class="chart-name">â° ì‹œê°„ì </span>
                            <div class="chart-bar-outer"><div class="chart-bar-inner time" style="width: ${maxStat > 0 ? (stats.time / maxStat) * 100 : 0}%">${stats.time > 0 ? stats.time + 'ì–µ' : ''}</div></div>
                            <span class="chart-amount">${stats.time}ì–µ ì›</span>
                        </div>
                        <div class="chart-item">
                            <span class="chart-name">ğŸŒ ê³µê°„ì </span>
                            <div class="chart-bar-outer"><div class="chart-bar-inner space" style="width: ${maxStat > 0 ? (stats.space / maxStat) * 100 : 0}%">${stats.space > 0 ? stats.space + 'ì–µ' : ''}</div></div>
                            <span class="chart-amount">${stats.space}ì–µ ì›</span>
                        </div>
                        <div class="chart-item">
                            <span class="chart-name">ğŸ‘¥ ì‚¬íšŒì </span>
                            <div class="chart-bar-outer"><div class="chart-bar-inner social" style="width: ${maxStat > 0 ? (stats.social / maxStat) * 100 : 0}%">${stats.social > 0 ? stats.social + 'ì–µ' : ''}</div></div>
                            <span class="chart-amount">${stats.social}ì–µ ì›</span>
                        </div>
                        <div class="chart-item">
                            <span class="chart-name">âš–ï¸ ìœ¤ë¦¬ì </span>
                            <div class="chart-bar-outer"><div class="chart-bar-inner ethics" style="width: ${maxStat > 0 ? (stats.ethics / maxStat) * 100 : 0}%">${stats.ethics > 0 ? stats.ethics + 'ì–µ' : ''}</div></div>
                            <span class="chart-amount">${stats.ethics}ì–µ ì›</span>
                        </div>
                    </div>

                    <div class="balance-score-section">
                        <div class="balance-title">âš–ï¸ í†µí•©ì  ê´€ì  ê· í˜• ì ìˆ˜</div>
                        <div class="balance-visual">
                            <div class="balance-bar-wrap"><div class="balance-bar time" style="height: ${barHeights.time}px"></div><span class="balance-bar-label">ì‹œê°„</span></div>
                            <div class="balance-bar-wrap"><div class="balance-bar space" style="height: ${barHeights.space}px"></div><span class="balance-bar-label">ê³µê°„</span></div>
                            <div class="balance-bar-wrap"><div class="balance-bar social" style="height: ${barHeights.social}px"></div><span class="balance-bar-label">ì‚¬íšŒ</span></div>
                            <div class="balance-bar-wrap"><div class="balance-bar ethics" style="height: ${barHeights.ethics}px"></div><span class="balance-bar-label">ìœ¤ë¦¬</span></div>
                        </div>
                        <div class="balance-grade ${balanceGrade}">${balanceGrade}ë“±ê¸‰</div>
                        <div class="balance-desc">${balanceDesc}</div>
                    </div>

                    <div class="section-header">ğŸ—ï¸ ê±´ì„¤ ì™„ë£Œ ì‹œì„¤</div>
                    <div class="building-tags-wrap">${tags}</div>
                </div>
            `;

            const page2 = `
                <div class="report-page" data-page="2 / 2">
                    <div class="section-header" style="border-color: #27ae60; background: #eafaf1;">âœ… ë„ì‹œì˜ ì¥ì  (2ê°€ì§€)</div>
                    <div class="diagnosis-cards">
                        ${strengths.map(s => `
                            <div class="d-card good">
                                <div class="d-card-title"><i class="fas fa-check-circle"></i> ${s.title}</div>
                                <p class="d-card-text">${s.text}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="section-header" style="border-color: #e74c3c; background: #fdedec;">âš ï¸ ì¹˜ëª…ì  ì•½ì  (2ê°€ì§€)</div>
                    <div class="diagnosis-cards">
                        ${weaknesses.map(w => `
                            <div class="d-card bad">
                                <div class="d-card-title"><i class="fas fa-exclamation-triangle"></i> ${w.title}</div>
                                <p class="d-card-text">${w.text}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="section-header" style="border-color: #9b59b6; background: #f5eef8;">ğŸ’¡ í†µí•©ì  ê´€ì ì—ì„œì˜ ì„±ì°°</div>
                    <div class="reflection-section">
                        <p>
                            í™”ì„± ë„ì‹œ ì„¤ê³„ëŠ” ë‹¨ìˆœíˆ ê±´ë¬¼ì„ ì§“ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. 
                            <strong class="t">â° ì‹œê°„ì  ê´€ì </strong>ì—ì„œ ê³¼ê±°ì˜ êµí›ˆì„ ê¸°ì–µí•˜ê³  ë¯¸ë˜ë¥¼ ì¤€ë¹„í•˜ë©°, 
                            <strong class="s">ğŸŒ ê³µê°„ì  ê´€ì </strong>ì—ì„œ í™”ì„±ì´ë¼ëŠ” ìƒˆë¡œìš´ í™˜ê²½ì— ì ì‘í•˜ê³ , 
                            <strong class="c">ğŸ‘¥ ì‚¬íšŒì  ê´€ì </strong>ì—ì„œ ì§ˆì„œ ìˆëŠ” ê³µë™ì²´ë¥¼ ë§Œë“¤ë©°, 
                            <strong class="e">âš–ï¸ ìœ¤ë¦¬ì  ê´€ì </strong>ì—ì„œ ëª¨ë“  êµ¬ì„±ì›ì´ ì¡´ì—„í•˜ê²Œ ì‚´ ìˆ˜ ìˆëŠ” ì •ì˜ë¡œìš´ ì‚¬íšŒë¥¼ ì¶”êµ¬í•´ì•¼ í•©ë‹ˆë‹¤.
                        </p>
                        <p style="margin-top: 12px;">
                            <strong>ğŸ¤” ë‚˜ì˜ ë„ì‹œì—ëŠ” ì–´ë–¤ ê°€ì¹˜ê´€ì´ ë‹´ê²¨ ìˆë‚˜ìš”?</strong> ë¶€ì¡±í•œ ê´€ì ì„ ë³´ì™„í•œë‹¤ë©´ ì–´ë–¤ ë„ì‹œê°€ ë ê¹Œìš”? ğŸš€
                        </p>
                    </div>

                    <div class="report-footer-section">
                        <p>ğŸ“… ì‘ì„±ì¼: ${dateStr}</p>
                        <p>ğŸ“š 2022 ê°œì • êµìœ¡ê³¼ì • [10í†µì‚¬01-01], [10í†µì‚¬01-02]</p>
                        <p style="margin-top: 5px;">ğŸŒŸ ì œì‘: í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™ (kstephullab.com)</p>
                    </div>
                </div>
            `;

            reportPages.innerHTML = page1 + page2;
            // ë¯¸ì…˜ ì™„ë£Œ â†’ ì „ì²´í™”ë©´ í•´ì œ
            missionComplete=true;
            if(document.fullscreenElement)document.exitFullscreen().catch(()=>{});
            reportModal.classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', init);

        // ===== ì „ì²´í™”ë©´ ê°€ë“œ =====
        let missionComplete = false;
        let isReEntering = false;
        function reEnterFullscreen(){
          isReEntering = true;
          document.getElementById('fs-warning').style.display = 'none';
          document.documentElement.requestFullscreen().catch(()=>{isReEntering=false;});
        }
        document.addEventListener('fullscreenchange', () => {
          if(!document.fullscreenElement && !missionComplete && !isReEntering){
            document.getElementById('fs-warning').style.display = 'flex';
          }
          if(document.fullscreenElement){
            isReEntering = false;
            document.getElementById('fs-warning').style.display = 'none';
          }
        });
    </script>
<!-- ì „ì²´í™”ë©´ ì´íƒˆ ê²½ê³  -->
<div class="fs-warning-overlay" id="fs-warning" style="display:none">
  <div class="warn-icon">âš ï¸</div>
  <div class="warn-title">ë¯¸ì…˜ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤!</div>
  <div class="warn-msg">ì „ì²´í™”ë©´ì„ ìœ ì§€í•´ì•¼ ë¯¸ì…˜ì„ ê³„ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ì „ì²´í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì„¸ìš”.</div>
  <button class="warn-btn" onclick="reEnterFullscreen()">ğŸ”’ ì „ì²´í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>
<a href="https://ssam-ssong.blogspot.com" target="_blank" class="blog-badge">âœï¸ í’€ì–´ì“°ëŠ” ì‚¬íšŒí•™</a>
</body>
</html>
